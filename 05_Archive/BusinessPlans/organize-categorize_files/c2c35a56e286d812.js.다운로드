(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,542518,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"errorOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},450363,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(s,{default:function(){return x},useLinkStatus:function(){return v}});let a=e.r(744066),n=e.r(628925),i=a._(e.r(140578)),l=e.r(331981),r=e.r(354412),o=e.r(132717),c=e.r(850901),d=e.r(683951);e.r(818061);let u=e.r(841919),m=e.r(863197),h=e.r(656480);e.r(542518);let p=e.r(72622);function f(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}function x(e){var t;let s,a,l,[x,v]=(0,i.useOptimistic)(u.IDLE_LINK_STATUS),j=(0,i.useRef)(null),{href:y,as:b,children:w,prefetch:k=null,passHref:N,replace:C,shallow:S,scroll:I,onClick:T,onMouseEnter:M,onTouchStart:P,legacyBehavior:E=!1,onNavigate:z,ref:D,unstable_dynamicOnHover:R,...A}=e;s=w,E&&("string"==typeof s||"number"==typeof s)&&(s=(0,n.jsx)("a",{children:s}));let L=i.default.useContext(r.AppRouterContext),F=!1!==k,_=!1!==k?null===(t=k)||"auto"===t?p.FetchStrategy.PPR:p.FetchStrategy.Full:p.FetchStrategy.PPR,{href:B,as:G}=i.default.useMemo(()=>{let e=f(y);return{href:e,as:b?f(b):e}},[y,b]);E&&(a=i.default.Children.only(s));let W=E?a&&"object"==typeof a&&a.ref:D,U=i.default.useCallback(e=>(null!==L&&(j.current=(0,u.mountLinkInstance)(e,B,L,_,F,v)),()=>{j.current&&((0,u.unmountLinkForCurrentNavigation)(j.current),j.current=null),(0,u.unmountPrefetchableInstance)(e)}),[F,B,L,_,v]),O={ref:(0,o.useMergedRef)(U,W),onClick(e){E||"function"!=typeof T||T(e),E&&a.props&&"function"==typeof a.props.onClick&&a.props.onClick(e),L&&(e.defaultPrevented||function(e,t,s,a,n,l,r){let{nodeName:o}=e.currentTarget;if(!("A"===o.toUpperCase()&&function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||e.currentTarget.hasAttribute("download"))){if(!(0,m.isLocalURL)(t)){n&&(e.preventDefault(),location.replace(t));return}if(e.preventDefault(),r){let e=!1;if(r({preventDefault:()=>{e=!0}}),e)return}i.default.startTransition(()=>{(0,h.dispatchNavigateAction)(s||t,n?"replace":"push",null==l||l,a.current)})}}(e,B,G,j,C,I,z))},onMouseEnter(e){E||"function"!=typeof M||M(e),E&&a.props&&"function"==typeof a.props.onMouseEnter&&a.props.onMouseEnter(e),L&&F&&(0,u.onNavigationIntent)(e.currentTarget,!0===R)},onTouchStart:function(e){E||"function"!=typeof P||P(e),E&&a.props&&"function"==typeof a.props.onTouchStart&&a.props.onTouchStart(e),L&&F&&(0,u.onNavigationIntent)(e.currentTarget,!0===R)}};return(0,c.isAbsoluteUrl)(G)?O.href=G:E&&!N&&("a"!==a.type||"href"in a.props)||(O.href=(0,d.addBasePath)(G)),l=E?i.default.cloneElement(a,O):(0,n.jsx)("a",{...A,...O,children:s}),(0,n.jsx)(g.Provider,{value:x,children:l})}let g=(0,i.createContext)(u.IDLE_LINK_STATUS),v=()=>(0,i.useContext)(g);("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},115551,e=>{"use strict";e.s(["default",()=>lf],115551);var t=e.i(628925),s=e.i(533568),a=e.i(246429),n=e.i(10134),i=e.i(90495),l=e.i(140578);let r=e=>{let t=l.useRef(e);return l.useEffect(()=>{t.current=e}),t},o=(e,t)=>void 0!==t[e],c={};e.i(431627);let d=(e,t)=>{let s,a,n=t||u;return function(){return s&&n(arguments,s)?a:a=e.apply(null,s=arguments)}},u=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],m=class{constructor(){let e,t;this.set=void 0,this.get=void 0,this.get=s=>s===e?t:void 0,this.set=(s,a)=>{e=s,t=a}}},h=e=>{try{return new e}catch(t){let e={};return{set(t,s){e[t]=s},get:t=>e[t]}}},p=(e,t)=>{let s,{g:a,s:n}=(e=>{let t,s,a,n,i=e.length,l=h(e[0]),r=1===i;return i<3?{g:e=>void 0===(t=l.get(e[0]))||r?t:t.get(e[1]),s:(a,n)=>(r?l.set(a[0],n):void 0===(t=l.get(a[0]))?((s=h(e[1])).set(a[1],n),l.set(a[0],s)):t.set(a[1],n),n)}:{g:e=>{for(a=0,n=l;a<i;a++)if(void 0===(n=n.get(e[a])))return;return n},s:(t,r)=>{for(a=0,n=l;a<i-1;a++)void 0===(s=n.get(t[a]))&&(s=h(e[a+1]),n.set(t[a],s)),n=s;return n.set(t[i-1],r),r}}})(e);return function(){return void 0===(s=a(arguments))?n(arguments,t.apply(null,arguments)):s}},f=new WeakMap;function x(){let e=l.useState(g)[1];return l.useRef(()=>e({})).current}let g={},v=l.createElement;function j(e){let t,{positioner:s,resizeObserver:a,items:n,as:i="div",id:o,className:c,style:d,role:u="grid",tabIndex:m=0,containerRef:h,itemAs:p="div",itemStyle:f,itemHeightEstimate:g=300,itemKey:j=C,overscanBy:k=2,scrollTop:T,isScrolling:M,height:P,render:E,onRender:z}=e,D=0,R=x(),A=I(s,a),L=n.length,{columnWidth:F,columnCount:_,range:B,estimateHeight:G,size:W,shortestColumn:U}=s,O=W(),q=U(),V=[],H="list"===u?"listitem":"grid"===u?"gridcell":void 0,K=r(z),Q=T+(k*=P),Y=q<Q&&O<L;if(B(Math.max(0,T-k/2),Q,(e,s,a)=>{let i=n[e],l=j(i,e),r={top:a,left:s,width:F,writingMode:"horizontal-tb",position:"absolute"};V.push(v(p,{key:l,ref:A(e),role:H,style:"object"==typeof f&&null!==f?Object.assign({},r,f):r},b(E,e,i,F))),void 0===t?(D=e,t=e):(D=Math.min(D,e),t=Math.max(t,e))}),Y){let e=Math.min(L-O,Math.ceil((T+k-q)/g*_)),t=O,s=S(F);for(;t<O+e;t++){let e=n[t],a=j(e,t);V.push(v(p,{key:a,ref:A(t),role:H,style:"object"==typeof f?Object.assign({},s,f):s},b(E,t,e,F)))}}l.useEffect(()=>{"function"==typeof K.current&&void 0!==t&&K.current(D,t,n),y="1"},[D,t,n,K]),l.useEffect(()=>{Y&&R()},[Y,s]);let X=w(M,G(L,g));return v(i,{ref:h,key:y,id:o,role:u,className:c,tabIndex:m,style:"object"==typeof d?N(X,d):X,children:V})}let y="0",b=p([m,{},WeakMap,m],(e,t,s,a)=>v(e,{index:t,data:s,width:a})),w=d((e,t)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(t),maxHeight:Math.ceil(t),willChange:e?"contents":void 0,pointerEvents:e?"none":void 0})),k=(e,t)=>e[0]===t[0]&&e[1]===t[1],N=d((e,t)=>Object.assign({},e,t),k);function C(e,t){return t}let S=d(e=>({width:e,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(e,t)=>e[0]===t[0]),I=d((e,t)=>s=>a=>{null!==a&&(t&&(t.observe(a),f.set(a,s)),void 0===e.get(s)&&e.set(s,a.offsetHeight))},k),T=function(e){var t=[],s=null,a=function(){for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];t=n,s||(s=requestAnimationFrame(function(){s=null,e.apply(void 0,t)}))};return a.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},a};function M(e){let t=E(e,x());function s(){return t.disconnect()}return l.useEffect(()=>s,[t]),t}function P(e){e.cancel()}let E=p([WeakMap],(e,t)=>{let s=[],a=T(()=>{s.length>0&&(e.update(s),t(s)),s.length=0}),n=t=>{let n=t.offsetHeight;if(n>0){let a=f.get(t);if(void 0!==a){let t=e.get(a);void 0!==t&&n!==t.height&&s.push(a,n)}}a()},i=new Map,l=new ResizeObserver(e=>{let t=0;for(;t<e.length;t++){let s=e[t],a=f.get(s.target);if(void 0===a)continue;let l=i.get(a);l||(l=T(n),i.set(a,l)),l(s.target)}}),r=l.disconnect.bind(l);return l.disconnect=()=>{r(),i.forEach(P)},l});var z=e.i(874249),D=e.i(486492);e.i(968648);var R=e.i(873329);let A=l.default["undefined"!=typeof document&&void 0!==document.createElement?"useLayoutEffect":"useEffect"],L=function(e,t,s,a){let n=l.useRef(s),i=l.useRef(a);l.useEffect(()=>{n.current=s,i.current=a}),l.useEffect(()=>{let s=e&&"current"in e?e.current:e;if(!s)return;let a=0;function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];a||n.current.apply(this,t)}s.addEventListener(t,l);let r=i.current;return()=>{a=1,s.removeEventListener(t,l),r&&r()}},[e,t])};function F(e){let t=()=>{let{current:t}=e;if(t){let e=getComputedStyle(t),s=parseFloat;return{width:t.clientWidth-s(e.paddingTop)-s(e.paddingBottom),height:t.clientHeight-s(e.paddingLeft)-s(e.paddingRight)}}return{width:0,height:0}},[s,a]=l.useState(t),n=()=>a(t());return L("undefined"!=typeof window?window:null,"resize",n),L("undefined"!=typeof window?window:null,"orientationchange",n),A(()=>{a(t())},[]),s}let _="undefined",B=typeof window!==_?window:{},G=typeof performance!==_?performance:Date,W=()=>G.now(),U="AnimationFrame",O="cancel"+U,q="request"+U,V=B[q]&&B[q].bind(B),H=B[O]&&B[O].bind(B);if(!V||!H){let e=0;V=t=>{let s=W(),a=Math.max(e+1e3/60,s);return setTimeout(()=>{t(e=a)},a-s)},H=function(e){return clearTimeout(e)}}let K="undefined"!=typeof performance?performance:Date;function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{offset:s=0,fps:a=12}=t,n=e&&"current"in e?e.current:e,i=()=>n?"scrollTop"in n?n.scrollTop:n.pageYOffset||n.scrollY:0,[o,c]=function(e,t,s){let a=l.useState(e);return[a[0],function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=r(e),n=1e3/t,i=l.useRef(0),o=l.useRef(),c=()=>o.current&&clearTimeout(o.current),d=[t,s,a];function u(){i.current=0,c()}return l.useEffect(()=>u,d),l.useCallback(function(){let e=arguments,t=K.now(),l=()=>{i.current=t,c(),a.current.apply(null,e)},r=i.current;if(s&&0===r)return l();if(t-r>n){if(r>0)return l();i.current=t}c(),o.current=setTimeout(()=>{l(),i.current=0},n)},d)}(a[1],t,void 0)]}(i,a),[d,u]=l.useState(!1);function m(){u(!1)}return A(()=>{if(n){let e,t=!1,s=()=>e&&void H(e.v||-1),l=()=>{t||(c(i()),u(!0),s(),e=((e,t)=>{let s=W(),a={},n=()=>{W()-s>=t?e.call(null):a.v=V(n)};return a.v=V(n),a})(m,1e3/a))};return n.addEventListener("scroll",l),()=>{n.removeEventListener("scroll",l),s(),t=!0}}},[n,a]),{scrollTop:Math.max(0,o-s),isScrolling:d}}var Y=e.i(572498),X=e.i(443696);e.i(685846);var $=e.i(688893),$=$;e.i(883805);var Z=e.i(122710),J=e.i(383293),ee=e.i(211959),et=e.i(468755),es=e.i(81795);function ea(e){let{post:s,index:a,numImages:n,sizePx:i,isHovered:r}=e,[o]=(0,l.useState)(!0);return(0,t.jsx)("div",{className:(0,ee.cn)("absolute top-0 left-0 w-[".concat(i,"px] h-[").concat(i,"px]"),"transition-transform duration-[".concat(r?200:300,"ms] ease-out")),style:{transform:"rotate(".concat(o?(-(3*n)+12*a)*(r?1.5:1):0,"deg) translateX(").concat(r?7*(a-1):3*(a-1),"px) scale(").concat(r?1.1:1,")")},children:(0,t.jsx)("img",{src:s.blobSrc||s.mediaUrl,alt:s.id,className:(0,ee.cn)("w-full h-full object-cover rounded-xl",a===n-1&&"border-2  border-inner border-white")})})}function en(e){let{sizePx:s=100}=e,a=(0,z.useMediaStore)(e=>e.fetchListMediaPosts),n=(0,z.useMediaStore)(e=>e.globalVideoProgress),i=(0,z.useMediaStore)(e=>e.favoritesList).slice(0,3).reverse(),r=i.length,[o,c]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{a({source:"MEDIA_POST_SOURCE_LIKED"}).catch((0,D.createLogError)("imagine-fav-pile"))},[a]),(0,t.jsxs)("div",{className:"relative w-[".concat(s,"px] h-[").concat(s,"px]"),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[i.map((e,a)=>(0,t.jsx)(ea,{post:e,index:a,numImages:r,sizePx:s,isHovered:o},e.id)),n.numberOfVideosInProgress>0&&n.progress<100&&(0,t.jsx)(ei,{sizePx:s,progress:n.progress,numInProgress:n.numberOfVideosInProgress})]})}function ei(e){let{sizePx:s=100,progress:a=0,numInProgress:n=0}=e,{resolvedTheme:i}=(0,es.useTheme)(),l="dark"===i;return(0,t.jsxs)("div",{className:"absolute top-2 right-0",children:[(0,t.jsx)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(et.RadialProgress,{progressPercentage:a,size:.55*s,trackClassName:(0,ee.cn)(l?"stroke-white/20":"stroke-black/10"),progressClassName:(0,ee.cn)(l?"stroke-white":"stroke-black/70"),thickness:3,offsetDegrees:0})}),(0,t.jsx)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(el,{sizePx:s,count:n})})]})}function el(e){let{sizePx:s=100,count:a=0}=e;return(0,t.jsxs)("div",{className:"w-[${sizePx * 0.4}px] h-[${sizePx * 0.4}px]",children:[(0,t.jsx)("svg",{width:.4*s,height:.4*s,children:(0,t.jsx)("circle",{cx:.2*s,cy:.2*s,r:.2*s,fill:"#5D7BE2"})}),(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center absolute top-0 left-0 ",children:(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:a})})]})}var er=e.i(724499),eo=e.i(543526),ec=e.i(72290),ed=e.i(235289),eu=e.i(420986),em=e.i(122088),eh=e.i(328788),ep=e.i(50636),ef=e.i(470753);let ex=(0,l.memo)(function(e){let{setQuery:s,showFavorites:a,navigateOnQuery:n=!0,disableInput:i=!1,placeholderText:r}=e,{t:o}=(0,R.useTranslation)("imagine"),{ENABLE_COMPACT_QUERY_BAR:c}=(0,ep.useFeatureFlags)(),{push:d}=(0,er.useRouting)(),u=(0,eo.useAssetStore)(e=>e.fetchGetAsset),m=(0,ec.useEnvironment)(),h=(0,ef.useSettingsStore)(e=>e.userSettings.preferences.disableVideoGenerationOnUpload),p=(0,eu.useGenImagineVideoFromMediaUrl)({disableVideoGeneration:h}),[f,x]=(0,l.useState)(!1),g=(0,l.useCallback)(async e=>{var t;if((null==(t=e.fileAttachmentIds)?void 0:t.length)&&"string"==typeof e.fileAttachmentIds[0]){let t=await u({assetId:e.fileAttachmentIds[0]}),s="".concat(m.ASSET_SERVER_URL,"/").concat(t.key);await p(s)}else n&&d({page:"imagine"}),s(e.query||"");return!0},[n,s,u,p,d,m]),v=(0,l.useCallback)(()=>{x(!0)},[]);(0,l.useEffect)(()=>{f&&z.useMediaStore.getState().connectWebSocket()},[f]);let j=(0,em.useMobileUa)(),y=(0,eh.useMobileSize)()?"w-0":"w-gutter";return(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-row items-center gap-2 justify-center",j&&"mb-5"),children:[(0,t.jsx)("div",{className:y}),a&&(0,t.jsx)(X.ButtonWithTooltip,{className:"h-full",tooltipContent:o("imagine-favorites-button-label","Favorites"),variant:"none",size:"md",shape:"rectangle",onClick:()=>d({page:"imagine-favorites"}),children:(0,t.jsx)(en,{sizePx:50})}),(0,t.jsx)(J.QueryBar,{disabled:i,onChange:v,textAreaClassName:c?"min-h-14 py-4 my-0 mb-0":"",className:(0,ee.cn)(ed.QUERY_BAR_MAX_WIDTH_CLASS,i&&"opacity-15 pointer-events-none"),expandable:!1,onFrontPage:!1,restrictedModel:!0,placeholder:i?"":null!=r?r:o("imagine-query-bar-placeholder","Type to imagine"),onQuery:g}),(0,t.jsx)("div",{className:y})]})});var eg=e.i(689280),ev=e.i(572848),ej=e.i(296451),ey=e.i(62912),eb=e.i(410289),ew=e.i(259473),ek=e.i(258591),eN=e.i(228337);function eC(e,t){(0,D.logEventGlobal)(e,void 0,{location:"imagine-grid-card",...t})}function eS(e){var s,a,n;let{data:i,width:r}=e,{t:o}=(0,R.useTranslation)("imagine"),{push:c,route:d}=(0,er.useRouting)(),{ASSET_SERVER_URL:u}=(0,ec.useEnvironment)(),m=(0,l.useRef)(null),h=(0,z.useMediaStore)(e=>e.byId[i.id||""]||e.favoritesById[i.id||""])||i,p=(0,z.useMediaStore)(e=>e.setImageDimensions),f=(0,z.useMediaStore)(e=>{var t;return(null!=(t=e.videoByMediaId[h.id])?t:[]).findLast(e=>(null==e?void 0:e.progress)===100)}),x=(null==(s=i.mimeType)?void 0:s.startsWith("video"))&&(null==(a=i.originalPost)?void 0:a.mediaUrl)||i.blobSrc||i.mediaUrl,g=r/(i.width||832),[v,j]=(0,l.useState)(x?[x]:[]),[y,b]=(0,l.useState)(null),[w,k]=(0,l.useState)({}),[N,C]=(0,l.useState)(!1),S=(null==f?void 0:f.videoUrl)||(null==f?void 0:f.mediaUrl),[I,T]=(0,l.useState)(!1),M=(0,l.useMemo)(()=>eN.default.debounce(T,200),[]),P=(0,l.useMemo)(()=>S&&I?(0,ew.getCachedAssetUrl)(u,S):null,[S,I,u]),E=h.moderated,D=(0,l.useMemo)(()=>{var e;return N&&!E&&(!!P||!i.isGenerated||i.isGenerated&&(null!=(e=i.progress)?e:0)>=100)},[i.isGenerated,i.progress,P,N,E]);(0,l.useEffect)(()=>{let e=m.current;if(!e||!S)return;let t=new IntersectionObserver(e=>M(e.some(e=>e.isIntersecting)),{root:null,rootMargin:"0px",threshold:.1});return t.observe(e),()=>{e&&t.unobserve(e),t.disconnect(),M.cancel()}},[m,S]),(0,l.useEffect)(()=>{x&&j(e=>e.includes(x)?e:[...e,x])},[x]),(0,l.useEffect)(()=>{y&&j(e=>{let t=e.indexOf(y);return e.length>1&&-1!==t?e.slice(t):e})},[y,j]);let A=(0,z.useMediaStore)(e=>e.smoothedVideoProgress[h.id]||e.smoothedVideoProgress[h.mediaPostId||""]),L=g*(i.height||1248);i.width&&i.height&&(L=r/(i.width/i.height));let F=(null==(n=h.userInteractionStatus)?void 0:n.likeStatus)===!0,_="number"==typeof A,B=_&&A<100,G=!!S||!!B,W=!!(_&&(B||!P));return(0,t.jsxs)("div",{ref:m,className:(0,ee.cn)("relative group/media-post-masonry-card",N&&"hover:scale-[1.02] transition-transform duration-300 pointer-events-auto"),onClick:()=>{var e,t;if(!i.isGenerated||!((null!=(e=i.progress)?e:0)<100))eC("image_feed_image_selected",{source:{"imagine-feed":"feed","imagine-post":"rabbithole","imagine-favorites":"favorites"}[d.page]||"unknown",model_name:null!=(t=i.modelName)?t:""}),c({page:"imagine-post",postId:i.id})},children:[(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,ee.cn)(!N&&"hidden"),children:[v.map((e,s)=>(0,t.jsx)("img",{className:(0,ee.cn)("opacity-".concat(w[e]||0," transition-opacity duration-500 ease-out rounded-2xl"),s>0&&"absolute top-0 left-0"),style:{width:r,height:L},onLoad:t=>{let s=t.target;p(i.id,s.width,s.height),C(!0),k(t=>({...t,[e]:1})),setTimeout(()=>{b(e)},500)},src:e,alt:"Generated image"},e)),N&&P&&(0,t.jsx)("video",{src:P,muted:!0,autoPlay:!0,controls:!1,loop:!0,playsInline:!0,poster:v[v.length-1]||void 0,style:{width:r,height:L},className:(0,ee.cn)("absolute top-0 left-0 col-start-1 row-start-1  object-cover rounded-2xl","pointer-events-none"),children:o("video-unsupported.label","Your browser does not support the video tag.")}),W&&(0,t.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-100 h-100",children:[(0,t.jsx)("svg",{className:"size-12 text-black/35 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)("circle",{cx:"50%",cy:"50%",r:"50%",fill:"#5D7BE2",strokeWidth:"0"})}),(0,t.jsx)(et.RadialProgress,{progressPercentage:null!=A?A:0,size:60,thickness:7,trackClassName:"stroke-black/15",progressClassName:"stroke-white/90"}),(0,t.jsx)(ey.Play,{fill:"currentColor",strokeWidth:0,className:"animate-pulse size-6 text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})]},"progress")]}),(0,t.jsx)(eb.Skeleton,{pulse:!!B,className:(0,ee.cn)("rounded-2xl",N&&"hidden"),style:{width:r,height:L}})]}),(0,t.jsx)("div",{className:D?"":"invisible",children:(0,t.jsx)(eI,{hasVideo:G,isLiked:F,postId:i.id})})]})}let eI=(0,l.memo)(e=>{let{hasVideo:s,isLiked:a,postId:n}=e,i=(0,z.useMediaStore)(e=>e.like),l=(0,z.useMediaStore)(e=>e.unlike),r=(0,z.useMediaStore)(e=>e.generateVideoForImage),{t:o}=(0,R.useTranslation)("imagine");return(0,t.jsx)("div",{className:(0,ee.cn)("absolute bottom-2 right-2","flex flex-row gap-2"),onClick:ek.handleIsolateClick,children:s?(0,t.jsx)(X.ButtonWithTooltipOptimized,{tooltipContent:a?o("image-unlike-button.label","Unsave"):o("image-like-button.label","Save image"),className:(0,ee.cn)("bg-black/25 hover:bg-white/10 border border-white/15 border-opacity-10","group-hover/media-post-masonry-card:opacity-100","opacity-0"),shape:"circle",size:"md",variant:"none",onClick:()=>a?l(n):i(n),children:(0,t.jsx)(ej.HeartIcon,{className:(0,ee.cn)("size-4","text-white"),fill:a?"currentColor":"none",stroke:a?"none":"currentColor"})}):(0,t.jsx)(X.ButtonWithTooltipOptimized,{tooltipContent:o("image-make-video-button.label","Make video"),className:"bg-black/25 hover:bg-white/10 border border-white/15 border-opacity-10",shape:"circle",size:"md",variant:"none",onClick:()=>{eC("image_feed_video_generation_started",{location:"imagine-grid-card",mode:"normal",source:"feed_video_button"}),r(n,"normal","imagine-grid-card").catch(e=>{let t,s="Unknown",a="Unknown",n="Unknown";e instanceof Error?(t=e.message,s=e.name,a=e.cause?String(e.cause):"",n=e.stack?e.stack:""):t="string"==typeof e?e:String(e),eC("image_feed_video_generation_error",{location:"imagine-grid-card",mode:"normal",message:t,error:s,cause:a,stack:n}),(0,D.logError)("imagine-grid-card",e)})},children:(0,t.jsx)(ey.Play,{fill:"currentColor",strokeWidth:0,className:"size-4 text-white"})})})}),eT=[],eM={low:0,max:0,high:0,C:2,P:void 0,R:void 0,L:void 0,list:void 0};function eP(e){let t=e.high;e.L===eM&&e.R===eM?e.max=t:e.L===eM?e.max=Math.max(e.R.max,t):e.R===eM?e.max=Math.max(e.L.max,t):e.max=Math.max(Math.max(e.L.max,e.R.max),t)}function eE(e){let t=e;for(;t.P!==eM;)eP(t.P),t=t.P}function ez(e,t){if(t.R===eM)return;let s=t.R;t.R=s.L,s.L!==eM&&(s.L.P=t),s.P=t.P,t.P===eM?e.root=s:t===t.P.L?t.P.L=s:t.P.R=s,s.L=t,t.P=s,eP(t),eP(s)}function eD(e,t){if(t.L===eM)return;let s=t.L;t.L=s.R,s.R!==eM&&(s.R.P=t),s.P=t.P,t.P===eM?e.root=s:t===t.P.R?t.P.R=s:t.P.L=s,s.R=t,t.P=s,eP(t),eP(s)}function eR(e,t,s){t.P===eM?e.root=s:t===t.P.L?t.P.L=s:t.P.R=s,s.P=t.P}eM.P=eM,eM.L=eM,eM.R=eM;let eA=function(e,t,s,a){void 0===s&&(s=0),void 0===a&&(a=s);let n=function(){let e={root:eM,size:0},t={};return{insert(s,a,n){let i,l=e.root,r=eM;for(;l!==eM&&s!==(r=l).low;)l=s<l.low?l.L:l.R;if(s===r.low&&r!==eM){if(!function(e,t,s){let a,n=e.list;for(;n;){if(n.index===s)return!1;if(t>n.high)break;a=n,n=n.next}return a||(e.list={index:s,high:t,next:n}),a&&(a.next={index:s,high:t,next:a.next}),!0}(r,a,n))return;r.high=Math.max(r.high,a),eP(r),eE(r),t[n]=r,e.size++;return}let o={low:s,high:a,max:a,C:0,P:r,L:eM,R:eM,list:{index:n,high:a,next:null}};r===eM?e.root=o:(o.low<r.low?r.L=o:r.R=o,eE(o));for(var c=o;0===c.P.C;)c.P===c.P.P.L?0===(i=c.P.P.R).C?(c.P.C=1,i.C=1,c.P.P.C=0,c=c.P.P):(c===c.P.R&&ez(e,c=c.P),c.P.C=1,c.P.P.C=0,eD(e,c.P.P)):0===(i=c.P.P.L).C?(c.P.C=1,i.C=1,c.P.P.C=0,c=c.P.P):(c===c.P.L&&eD(e,c=c.P),c.P.C=1,c.P.P.C=0,ez(e,c.P.P));e.root.C=1,t[n]=o,e.size++},remove(s){let a,n=t[s];if(void 0===n)return;delete t[s];let i=function(e,t){let s=e.list;if(s.index===t)return null===s.next?0:(e.list=s.next,1);let a=s;for(s=s.next;null!==s;){if(s.index===t)return a.next=s.next,1;a=s,s=s.next}}(n,s);if(void 0===i)return;if(1===i){n.high=n.list.high,eP(n),eE(n),e.size--;return}let l=n,r=l.C;n.L===eM?(a=n.R,eR(e,n,n.R)):n.R===eM?(a=n.L,eR(e,n,n.L)):(r=(l=function(e){for(;e.L!==eM;)e=e.L;return e}(n.R)).C,a=l.R,l.P===n?a.P=l:(eR(e,l,l.R),l.R=n.R,l.R.P=l),eR(e,n,l),l.L=n.L,l.L.P=l,l.C=n.C),eP(a),eE(a),1===r&&function(e,t){let s;for(;t!==eM&&1===t.C;)t===t.P.L?(0===(s=t.P.R).C&&(s.C=1,t.P.C=0,ez(e,t.P),s=t.P.R),1===s.L.C&&1===s.R.C?(s.C=0,t=t.P):(1===s.R.C&&(s.L.C=1,s.C=0,eD(e,s),s=t.P.R),s.C=t.P.C,t.P.C=1,s.R.C=1,ez(e,t.P),t=e.root)):(0===(s=t.P.L).C&&(s.C=1,t.P.C=0,eD(e,t.P),s=t.P.L),1===s.R.C&&1===s.L.C?(s.C=0,t=t.P):(1===s.L.C&&(s.R.C=1,s.C=0,ez(e,s),s=t.P.L),s.C=t.P.C,t.P.C=1,s.L.C=1,eD(e,t.P),t=e.root));t.C=1}(e,a),e.size--},search(t,s,a){let n=[e.root];for(;0!==n.length;){let e=n.pop();if(e!==eM&&!(t>e.max)&&(e.L!==eM&&n.push(e.L),e.R!==eM&&n.push(e.R),e.low<=s&&e.high>=t)){let s=e.list;for(;null!==s;)s.high>=t&&a(s.index,e.low),s=s.next}}},get size(){return e.size}}}(),i=Array(e),l=[],r=Array(e);for(let t=0;t<e;t++)i[t]=0,r[t]=[];return{columnCount:e,columnWidth:t,set:function(e,o){void 0===o&&(o=0);let c=0;for(let e=1;e<i.length;e++)i[e]<i[c]&&(c=e);let d=i[c]||0;i[c]=d+o+a,r[c].push(e),l[e]={left:c*(t+s),top:d,height:o,column:c},n.insert(d,d+o,e)},get:e=>l[e],update:t=>{let s=Array(e),o=0,c=0;for(;o<t.length-1;o++){let e=t[o],a=l[e];a.height=t[++o],n.remove(e),n.insert(a.top,a.top+a.height,e),s[a.column]=void 0===s[a.column]?e:Math.min(e,s[a.column])}for(o=0;o<s.length;o++){if(void 0===s[o])continue;let e=r[o],t=eL(e,s[o]),d=l[r[o][t]];for(i[o]=d.top+d.height+a,c=t+1;c<e.length;c++){let t=e[c],s=l[t];s.top=i[o],i[o]=s.top+s.height+a,n.remove(t),n.insert(s.top,s.top+s.height,t)}}},range:(e,t,s)=>n.search(e,t,(e,t)=>s(e,l[e].left,t)),estimateHeight:(t,s)=>{let a=Math.max(0,Math.max.apply(null,i));return t===n.size?a:a+Math.ceil((t-n.size)/e)*s},shortestColumn:()=>i.length>1?Math.min.apply(null,i):i[0]||0,size:()=>n.size,all:()=>l}},eL=(e,t)=>{let s=0,a=e.length-1;for(;s<=a;){let n=s+a>>>1,i=e[n];if(i===t)return n;i<=t?s=n+1:a=n-1}return -1},eF=function(e,t,s,a,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=8),a=a||Math.min(Math.floor((e+s)/(t+s)),n||1/0)||1;let l=Math.floor((e-s*(a-1))/a);return void 0!==i&&l>i&&(l=i),[l,a]},e_=[];var eB=e.i(221045),eG=e.i(735806),eW=e.i(763578),eU=e.i(633918),eO=e.i(164877);let eq=[];function eV(){let e=(0,z.useMediaStore)(e=>e.videoGenModerated),s=(0,z.useMediaStore)(e=>e.requestRateLimited),a=(0,z.useMediaStore)(e=>e.requestRejected),{t:n}=(0,R.useTranslation)("imagine");(0,l.useEffect)(()=>{if(e){let e=n("Content Moderated","Content Moderated. Try a different idea.");eB.toast.error((0,t.jsx)(eH,{text:e,upsell:!1}))}if(s){let e=n("Imagine Request Rate Limited","Image limit reached"),s=n("Imagine Request Rate Limited CTA","Upgrade to unlock more");eB.toast.error((0,t.jsx)(eH,{text:e,secondaryText:s,upsell:!0}),{duration:2e4})}if(a){let e=n("Imagine Request Rejected","Request Rejected.");eB.toast.error((0,t.jsx)(eH,{text:e,upsell:!1}))}},[e,n,s,a])}function eH(e){let{text:s,secondaryText:a,upsell:n}=e,i=(0,eG.useUpsellStore)(eU.prop("setIsUpselling")),{t:l}=(0,R.useTranslation)("base");return(0,t.jsxs)("div",{className:"flex items-center gap-3 font-semibold",children:[(0,t.jsx)(eO.AlertTriangle,{className:"h-5 w-5 flex-shrink-0"}),(0,t.jsxs)("span",{children:[s,a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-secondary font-medium",children:a})]})]}),n&&(0,t.jsx)(eW.Button,{variant:"primary",className:"font-medium ms-4",onClick:()=>{i(!0)},children:l("Upgrade","Upgrade")})]})}var eK=e.i(399696),eQ=e.i(560831);function eY(e){let{prompt:t,scrollContainerRef:s,postId:a,freezeLoading:n,width:i,height:r,isInitial:o,positionerConfig:c,imageModelName:d,fetchMoreUsingOriginalPrompt:u=!1}=e,{masonryRender:m}=function(e){var t,s;let{prompt:a,scrollContainerRef:n,postId:i,freezeLoading:r,width:o,height:c,isInitial:d,positionerConfig:u,imageModelName:m,fetchMoreUsingOriginalPrompt:h=!1}=e,p=(0,l.useRef)(0),f=(0,l.useRef)(null),{items:x,maybeLoadMore:g}=function(e){var t,s;let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,d=(0,z.useMediaStore)(e=>e.switchContext),u=(0,z.useMediaStore)(e=>e.fetchImageGen),m=(0,z.useMediaStore)(e=>e.fetchImageGenMore),h=e+(n?"-".concat(n):""),p=(0,z.useMediaStore)(e=>e.firstFetchStatus[h]),f=null!=(s=(0,z.useMediaStore)(e=>e.byPrompt[h]))?s:eq,x=(0,l.useRef)(!1),g=(0,l.useRef)(a);g.current=a;let v=f&&(null==(t=f[0])?void 0:t.blobSrc)?f[0]:null,j=(0,l.useMemo)(()=>{var t,s,a,n,i;return c?null!=(a=null!=(s=null!=(t=null==v?void 0:v.originalPrompt)?t:null==v?void 0:v.prompt)?s:e)?a:"":null!=(i=null!=(n=null==v?void 0:v.prompt)?n:e)?i:""},[v,e,c]),y=(0,l.useCallback)((e,t)=>g.current||!t,[g]),b=(0,l.useCallback)(async()=>{j&&a&&await m(j,h,y,o)},[m,j,a,h,y,o]),w=function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=(0,l.useRef)(!1),n=(0,l.useRef)(!1),i=(0,l.useRef)(0),r=(0,l.useRef)(2),o=(0,l.useRef)(0),c=(0,l.useRef)(0);(0,l.useEffect)(()=>(n.current=!0,()=>{n.current=!1}),[]),o.current=Math.max(t,o.current);let d=(0,l.useCallback)(async(t,l)=>{if(l>-1&&(c.current=l),!a.current&&s){for(a.current=!0;n.current&&c.current+2>=o.current;){if(i.current>=r.current){await new Promise(e=>setTimeout(e,100));continue}o.current+=4,e().then(()=>{i.current--}).catch(e=>{i.current--,(0,D.logError)("useInfiniteImagineLoader:fetchMoreFn",e)}),i.current++}a.current=!1}},[e,s]);return(0,l.useEffect)(()=>{s&&n.current&&c.current+2>=o.current&&d(-1,-1).catch(e=>{(0,D.logError)("useInfiniteImagineLoader:fetcher",e)})},[s,d,n,c,o]),d}(b,f.length,"complete"===p);return(0,l.useEffect)(()=>{!x.current&&(x.current=!0,a&&("complete"===p?j&&d(j):e&&!p&&u(e,!!i,h,y,o).then(()=>{}).catch(e=>{(0,D.logError)("useImageGenQuery:fetchImageGen",e)})))},[e,a,n,h,i,y,p,j,o]),{items:(0,l.useMemo)(()=>{let e=f;if(a){e=f;let t=r?f.length%r:0,s=r;t&&r&&(s=r-t),e=[...f,...Array(s).fill(null).map((e,t)=>({id:"placeholder-".concat(t),progress:0,mediaUrl:""}))]}else if(e=f.filter(e=>100===e.progress),r){let t=e.length%r;e.length=e.length-t}return e},[f,a,r]),fetchMore:b,maybeLoadMore:w,fullPrompt:j}}(a,!r,i,d,p.current,m,h);(0,l.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()},100)},[n]);let v=(0,l.useRef)(1),{offset:y}=function(e,t){void 0===t&&(t=eT);let[s,a]=l.useState({offset:0,width:0});return A(()=>{let{current:t}=e;if(null!==t){let e=0,n=t;do e+=n.offsetTop||0,n=n.offsetParent;while(n)(e!==s.offset||t.offsetWidth!==s.width)&&a({offset:e,width:t.offsetWidth})}},t),s}(f,[Math.random()]),{scrollTop:b,isScrolling:w}=Q(n,{offset:y-100});w&&(v.current=2);let k=e0("imagine-masonry-section-".concat(i),x.length,{width:o,...eX,...u},[]);p.current=k.columnCount;let N=(c||832)-Math.max(0,null!=(s=null==(t=f.current)?void 0:t.getBoundingClientRect().top)?s:0),C=M(k);return{masonryRender:j({className:(0,ee.cn)("max-w-[646px] mx-auto min-h-[90vh]",r?"min-h-10":"min-h-[100vh]"),positioner:k,resizeObserver:C,scrollTop:b,isScrolling:w,height:N,overscanBy:v.current,itemHeightEstimate:650,containerRef:f,items:x,render:eS,onRender:r?void 0:g,role:"list"})}}({prompt:t,scrollContainerRef:s,postId:a,freezeLoading:n,width:i,height:r,isInitial:o,positionerConfig:c,imageModelName:d,fetchMoreUsingOriginalPrompt:u});return m}let eX={columnGutter:8,maxColumnCount:2};function e$(e){let{promptKey:s,prompt:a,widthStyle:n="full",initExpanded:i=!1,isEditable:r=!0,onEdit:o=()=>{},maxWidth:c}=e,d=(0,z.useMediaStore)(e=>e.getSelectionPromptByPromptKey(null!=s?s:"")),{t:u}=(0,R.useTranslation)("imagine"),[m,h]=(0,l.useState)(i),[p,f]=(0,l.useState)(a),x=(0,l.useRef)(null),[g,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{f(d||a)},[d,a]);let j=(0,l.useCallback)(()=>{p&&o&&o(p),h(!1)},[o,p]),y=x.current;return((0,l.useEffect)(()=>{if(!g)return;let e=e=>{if("Escape"===e.key){e.stopPropagation(),e.preventDefault();return}"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),j())};return y&&y.addEventListener("keydown",e),()=>{y&&y.removeEventListener("keydown",e)}},[g,y,j]),a)?(0,t.jsx)("div",{onClick:()=>{m||(h(!0),setTimeout(()=>{var e,t,s;null==(e=x.current)||e.focus();let a=null!=(s=null==p?void 0:p.length)?s:0;null==(t=x.current)||t.setSelectionRange(a,a)},200))},className:(0,ee.cn)("border-border-l2 border bg-surface-l1 rounded-full px-4 py-2 ",!m&&"fit"===n&&"w-fit",!m&&"truncate rounded-full",m&&"rounded-3xl",m&&r&&"pe-2"),style:{maxWidth:null!=c?c:"100%"},children:m&&r?(0,t.jsxs)("div",{className:"relative w-full flex items-center justify-center",children:[(0,t.jsx)(eK.default,{ref:x,onFocus:()=>v(!0),onBlur:()=>v(!1),style:{resize:"none"},value:p,onChange:e=>f(e.target.value),rows:1,maxRows:4,"aria-required":"true","aria-label":u("image-prompt-textarea.placeholder","Image prompt"),className:(0,ee.cn)("w-full pe-8 bg-transparent  text-md font-medium placeholder:text-muted-foreground focus-visible:outline-none")}),(0,t.jsx)(X.Button,{variant:"primary",size:"xs",shape:"circle",onClick:j,className:"absolute right-0 bottom-0","aria-label":u("image-prompt-textarea.submit","Submit"),children:(0,t.jsx)(eQ.ArrowUpIcon,{className:"w-4 h-4"})})]}):null!=p?p:"Nothing"}):null}let eZ=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e||!t)return;let a=t.scrollTop,n=performance.now(),i=1/60,l=r=>{let o=(r-n)/1e3;n=r;let c=(e=>{let t=0;do t+=e.offsetTop||0,e=e.offsetParent;while(e)return t})(e)-s,d=1-Math.pow(.9,o/i);t.scrollTop=a+=(c-a)*d,Math.abs(a-c)>2&&requestAnimationFrame(l)};requestAnimationFrame(l)},eJ=(e,t)=>{(0,l.useEffect)(()=>{let s=e.current,a=()=>{var e;let a=null!=(e=null==s?void 0:s.scrollTop)?e:0;z.useScrollStore.setState(e=>({...e,scrollPositionByPageId:{...e.scrollPositionByPageId,[t]:a}}))};if(s){let e=z.useScrollStore.getState().getScrollPosition(t);e&&(s.scrollTop=e),s.addEventListener("scroll",a)}return()=>{s&&s.removeEventListener("scroll",a)}},[e,t])},e0=(e,t,s,a)=>{let{width:n,columnWidth:i=200,columnGutter:r=0,rowGutter:o,columnCount:c,maxColumnCount:d,maxColumnWidth:u}=s,[m,h]=e1(n,i,r,c,d,u),p=[e,n,m,h,r,o,...a].join("-"),f=(0,l.useRef)(p),x=z.useScrollStore.getState().getPositioner(p,t);return x||(x=function(){let e=eA(h,m,r,o);return z.useScrollStore.getState().setPositioner(p,e,t),f.current&&f.current!==p&&z.useScrollStore.getState().setPositioner(f.current,void 0,t),f.current=p,e}()),x},e1=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;a=a||Math.min(Math.floor((e+s)/(t+s)),n||1/0)||1;let l=Math.floor((e-s*(a-1))/a);return void 0!==i&&l>i&&(l=i),1===a&&(l=e),[l,a]};var e2=e.i(511765),e5=e.i(298438),e4=e.i(76756),e3=e.i(745322);function e8(e,t){(0,D.logEventGlobal)(e,void 0,{location:"imagine-feed",...t})}function e6(e){let{variant:s="default"}=e,a=(0,z.useMediaStore)(e=>e.homeGenPrompts),n=(0,z.useMediaStore)(e=>e.pushHomeGenPrompt),r=(0,z.useMediaStore)(e=>e.resetImageGen),o=(0,z.useMediaStore)(e=>e.clearHomeGenPrompts),{user:c}=(0,ev.useSession)(),d="default"===s&&a.length>0,u=(0,l.useCallback)(e=>{d||r(),n(e)},[d,n,r]),m=a.length>0&&"default"===s?"query":s;return((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&("favorites"===m&&window.history.back(),"query"===m&&(r(),o()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,r,m]),(0,l.useEffect)(()=>{"favorites"===m?e8("image_feed_gallery_opened"):"default"===m&&e8("image_feed_opened")},[m]),eV(),c)?(0,t.jsx)(e9,{variant:m,querys:a,setQuery:u},m):(0,t.jsx)(i.default,{})}function e9(e){let{variant:s,querys:a,setQuery:n}=e,{t:i}=(0,R.useTranslation)("base"),{data:{enableFileUploads:r,enableImageUploads:o}={}}=(0,e3.useFeatureControls)(),{resolvedTheme:c}=(0,es.useTheme)(),d=(0,l.useRef)(null),u=(0,l.useRef)(null),m=(0,Y.useScrollGradient)({ref:u,size:"dark"===c?.15:.11}),{width:h,height:p}=F(u),f=(0,z.useMediaStore)(e=>e.clearHomeGenPrompts),x=Math.min(h,"query"===s?1070:2290);eJ(u,h>0?"imagine-page"+s:"");let{user:g}=(0,ev.useSession)(),v=(0,l.useMemo)(()=>{let e="";return"favorites"===s&&(e=i("imagine-favorites-title","Favorites")),e&&(e=" / "+e),e},[s,i]),j=(0,eh.useMobileSize)();return(0,t.jsxs)("div",{className:"px-3 w-full relative",ref:d,children:[(0,t.jsx)(e4.CommandMenu,{}),r&&o&&(0,t.jsx)(eg.DropPrompt,{conversationId:void 0,containerRef:d,user:g,imageAttachmentsOnly:!0}),j&&(0,t.jsx)("div",{className:"-mx-3",children:(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0,disableBackgroundGradient:!0})}),(0,t.jsxs)("div",{tabIndex:-1,className:"flex flex-col w-full h-dvh overflow-scroll items-center",ref:e=>{u.current=e},style:{outline:"none",scrollbarWidth:"none",...m},children:[(0,t.jsxs)("div",{className:(0,ee.cn)("py-3 flex items-center gap-3 h-[4rem] w-full top-0",j&&"mt-14 px-2"),children:["favorites"===s||"query"===s?(0,t.jsx)(X.Button,{variant:"secondary",shape:"circle",size:"md","aria-label":i("imagine-back-button.label","Back"),onClick:"query"===s?f:()=>{window.history.back()},children:(0,t.jsx)($.default,{className:"size-4"})}):null,(0,t.jsxs)("h1",{className:"text-lg font-semibold",children:[(0,t.jsx)("span",{className:"text-primary",children:i("imagine-title","Imagine")}),v&&(0,t.jsx)("span",{className:"text-secondary",children:v})]})]}),h>0&&(0,t.jsx)("div",{style:{maxWidth:"".concat(x,"px")},className:"w-full",children:"query"===s?(0,t.jsx)(tt,{queries:a,scrollContainerRef:u,postId:"home-grid",width:x,height:p}):(0,t.jsx)(te,{containerRef:u,variant:s,width:x,height:p})})]}),(0,t.jsx)("div",{className:"absolute left-0 bottom-0 w-full p-3",children:(0,t.jsx)(ex,{setQuery:n,showFavorites:"favorites"!==s})})]})}function e7(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{width:e,columnWidth:250,maxColumnWidth:t?350:450,columnGutter:10,maxColumnCount:t?3:5}}function te(e){let{containerRef:t,variant:s,width:a,height:n}=e,[i,d]=(0,e2.useLocalStorage)("visited-imagine2",!1),u="favorites"===s?Z.GrokApiMediaPostSource.MediaPostSourceLiked:Z.GrokApiMediaPostSource.MediaPostSourcePublic,m=(0,z.useMediaStore)(e=>e.fetchListMediaPosts),h=function(e,t){void 0===t&&(t=c);let{isItemLoaded:s,minimumBatchSize:a=16,threshold:n=16,totalItems:i=9e9}=t,d=r(e),u=r(s);return l.useCallback((e,t,s)=>{let l=function(e,t,s,a,n,i){void 0===e&&(e=o),void 0===t&&(t=16),void 0===a&&(a=9e9);let l=[],r,c,d=n;for(;d<=i;d++)e(d,s)?void 0!==r&&void 0!==c&&(l.push(r,c),r=c=void 0):(c=d,void 0===r&&(r=d));if(void 0!==r&&void 0!==c){let n=Math.min(Math.max(c,r+t-1),a-1);for(d=c+1;d<=n;d++)if(e(d,s))break;else c=d;l.push(r,c)}if(l.length){let a=l[0],n=l[1];for(;n-a+1<t&&a>0;){let t=a-1;if(e(t,s))break;l[0]=a=t}}return l}(u.current,a,s,i,Math.max(0,e-n),Math.min(i-1,(t||0)+n));for(let e=0;e<l.length-1;++e)d.current(l[e],l[++e],s)},[i,a,n,d,u])}(()=>m({source:u}),{});(0,l.useEffect)(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize")),d(!0)},100),p.length||m({source:u}).catch((0,D.createLogError)("imagine-page"))},[]),(0,l.useEffect)(()=>{setTimeout(()=>{t.current&&t.current.focus()},100)},[t]);let p=(0,z.useMediaStore)(e=>"favorites"===s?e.favoritesList:e.list),f=e0("imagine-page-".concat(s),p.length,e7(a),[a]),x=M(f),{scrollTop:g,isScrolling:v}=Q(t);return j({positioner:f,resizeObserver:x,scrollTop:g,isScrolling:v,height:n||832,itemHeightEstimate:832,items:p,render:eS,onRender:h,overscanBy:"query"===s?1:2,itemKey:e=>e.id,role:"list"})}function tt(e){let{queries:s,scrollContainerRef:a,postId:n,width:i,height:r}=e,o=(0,l.useRef)(s.length),c=(0,z.useMediaStore)(e=>e.pushHomeGenPrompt),d=(0,z.useMediaStore)(e=>e.switchContext);return(0,l.useEffect)(()=>{s.length<=1||o.current===s.length||setTimeout(()=>{let e="imagine-masonry-section-".concat(s.length-1),t=document.getElementById(e);t&&eZ(t,a.current,80)},350)},[s.length,a,o]),(0,t.jsx)("div",{children:s.map((e,l)=>{let o=n+"-"+l,u=e+"-".concat(o);return(0,t.jsxs)("div",{id:"imagine-masonry-section-".concat(l),className:"flex flex-col gap-3 mb-1",children:[(0,t.jsx)(e$,{promptKey:u,prompt:e,widthStyle:"fit",onEdit:e=>{c(e),d(e)}}),(0,t.jsx)(eY,{prompt:e,scrollContainerRef:a,postId:o,width:i,height:r,positionerConfig:e7(i,!0),freezeLoading:l<s.length-1,fetchMoreUsingOriginalPrompt:!0})]},"imagine-masonry-section-".concat(l))})})}var ts=e.i(867846),$=$,ta=e.i(390864),tn=e.i(352910),ti=e.i(417508),tl=e.i(813637),tr=e.i(514731),to=e.i(510965);let tc=(0,to.default)("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);var td=e.i(130351),tu=e.i(510712);let tm=(0,to.default)("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var th=e.i(748430),tp=e.i(739984),tf=e.i(934290),tx=e.i(879085),tg=e.i(157695),tv=e.i(969736),tj=e.i(221891),ty=e.i(398304),tb=e.i(394786),tw=e.i(798784),tk=e.i(80981),tk=tk;let tN=(0,to.default)("VolumeOff",[["path",{d:"M16 9a5 5 0 0 1 .95 2.293",key:"1fgyg8"}],["path",{d:"M19.364 5.636a9 9 0 0 1 1.889 9.96",key:"l3zxae"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"m7 7-.587.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298V11",key:"1gbwow"}],["path",{d:"M9.828 4.172A.686.686 0 0 1 11 4.657v.686",key:"s2je0y"}]]),tC=(0,to.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var tS=e.i(77391),tI=e.i(203857);function tT(e){let{videoRef:s,setInhibitFullPanelMute:a,show:n=!0}=e,i=(0,l.useRef)(0),[r,o]=(0,l.useState)(0),[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(!1),h=(0,l.useRef)(null),[p,f]=(0,l.useState)(!1),x=(0,tI.useDebouncedValue)(n,300),g=(0,l.useRef)({}),v=s.current;(0,l.useEffect)(()=>{if(!v||!x&&!n)return;let e=!0,t=()=>{if(e){let e=v.currentTime/v.duration;e!==i.current&&(i.current=e,o(e)),requestAnimationFrame(t)}};return t(),()=>{e=!1}},[v,s,n,x]);let j=(0,l.useCallback)(e=>{var t,s;let a=null!=(s=null==(t=h.current)?void 0:t.getBoundingClientRect())?s:{left:0,width:0};return Math.max(0,Math.min(1,(e.clientX-a.left)/a.width))},[h]),y=(0,l.useMemo)(()=>(0,eN.throttle)(e=>{v&&(v.currentTime=e*(v.duration-.05))},48),[v]),b=(0,l.useCallback)(e=>{var t,s;e.stopPropagation(),e.preventDefault(),d(!0),a(!0),y(j(e.nativeEvent));let n=!(null==v?void 0:v.paused),i=()=>{null==v||v.removeEventListener("loadeddata",i),y(j(e.nativeEvent))};m(n),g.current[null!=(t=null==v?void 0:v.src)?t:""]||(g.current[null!=(s=null==v?void 0:v.src)?s:""]=!0,null==v||v.addEventListener("loadeddata",i),null==v||v.load()),n&&(null==v||v.pause())},[y,j,v,a,d,m]);return(0,l.useEffect)(()=>{if(!c)return;let e=e=>{e.stopPropagation(),e.preventDefault(),e.stopPropagation(),e.preventDefault(),d(!1),setTimeout(()=>{a(!1)},10),u&&(null==v||v.play().catch(e=>{(0,D.logError)("imagine-post-page:handleMouseUp",e)}))},t=e=>{e.stopPropagation(),e.preventDefault(),e.stopPropagation(),e.preventDefault(),c&&y(j(e))};return document.addEventListener("mouseup",e),document.addEventListener("mousemove",t),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",t)}},[c,b,j,y,v,a,u]),(0,t.jsx)("div",{className:"flex flex-col justify-center items-center w-full h-8 px-2",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:(0,t.jsx)("div",{ref:h,onMouseDown:b,onClick:e=>{e.stopPropagation(),e.preventDefault()},className:(0,ee.cn)("w-full bg-[#555]/50 z-10  rounded-full overflow-hidden transition-all duration-300 cursor-pointer",n||c?"opacity-100":"opacity-0",p||c?"h-3":"h-1"),children:(0,t.jsx)("div",{className:"w-full h-full bg-[#fff]/90",style:{width:"".concat(100*r,"%")}})})})}function tM(e){let{value:s,onValueChange:a,className:n,activeQuality:i}=e,{t:l}=(0,R.useTranslation)("imagine"),r=(0,eh.useMobileSize)(),o=(0,tI.useDebouncedValue)(i,500);return(0,t.jsxs)("div",{className:(0,ee.cn)("flex p-0  rounded-full  bg-[#555]/75",{"gap-0":r},n),"aria-label":"Text alignment",onClick:e=>{e.stopPropagation(),a("video"===s?"image":"video")},children:[(0,t.jsxs)(X.Button,{shape:"circle",size:"md",variant:"video"===s?"secondary":"tertiary",className:(0,ee.cn)("text-white border-0 relative","video"===s?"bg-white/15  hover:bg-white/15":"bg-transparent hover:bg-white/10 text-white/50 hover:text-white"),onClick:e=>{e.stopPropagation(),a("video")},children:["hd"===o?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full pt-0.5",children:[(0,t.jsx)(td.Film,{className:"size-[15px]"}),(0,t.jsx)("div",{className:" text-[10px] font-bold text-white",children:"HD"})]}):(0,t.jsx)(td.Film,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,ee.cn)("font-semibold sr-only","video"===s?"text-primary":"text-secondary"),children:l("imagine-post-tab.video","Video")})]}),(0,t.jsxs)(X.Button,{shape:"circle",size:"md",variant:"image"===s?"secondary":"tertiary",className:(0,ee.cn)(" text-white border-0","image"===s?"bg-white/15  hover:bg-white/15":"bg-transparent hover:bg-white/10 text-white/50 hover:text-white"),onClick:()=>a("image"),children:[(0,t.jsx)(tC,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,ee.cn)("font-semibold sr-only","image"===s?"text-primary":"text-secondary"),children:l("imagine-post-tab.image","Image")})]})]})}let tP=l.default.memo(function(e){let s,a,{mediaId:n,imageWidth:i,imageHeight:r,imageSrc:o,videoSrc:c,hdVideoSrc:d,audioSrc:u,className:m,videoPlayingRef:h,videoPlayingCb:p,firstTimeInteracted:f=!1,upscalingInProgress:x=!1}=e,{t:g}=(0,R.useTranslation)("imagine"),[v,j]=(0,l.useState)(!1),[y,b]=(0,l.useState)(!1),[w,k]=(0,l.useState)(c||d?"video":"image"),N=(0,l.useRef)(null),[C,S]=(0,l.useState)(!1),[I,T]=(0,e2.useLocalStorage)("imagine-mute-preference",!1,!1),[M,P]=(0,l.useState)(!1),E=(0,l.useMemo)(()=>eN.default.debounce(P,500),[]),[A,L]=(0,l.useState)(!f),_=(0,l.useRef)(null),B=(0,em.useMobileUa)(),G=c||d,{sdRef:W,hdRef:U,start:O,activeQuality:q}=function(e,t){let s=(0,l.useRef)(null),a=(0,l.useRef)(null),[n,i]=(0,l.useState)(null),r=(0,l.useRef)(!1),o=(0,l.useRef)(!1),c=(0,l.useRef)([]),[d,u]=(0,l.useState)(void 0),[m,h]=(0,l.useState)(void 0),p=(0,l.useRef)(null),f=(0,l.useRef)(null),x=!!(e||t),g=(0,l.useCallback)(()=>{c.current.forEach(e=>e()),c.current=[]},[]),v=(0,l.useCallback)(()=>{let e=a.current;if(r.current||!s.current||!e)return;r.current=!0,e.load();let t=setTimeout(()=>{var t,a,n,l;if(!s.current)return;let r=null!=(t=s.current.currentTime)?t:0,o=null!=(a=s.current.muted)&&a;if(e.currentTime=r+.1,e.currentTime,e.muted=o,!o){let t;e.volume=0;let a=(n=s.current,l=()=>{let e=setTimeout(()=>{s.current&&(s.current.pause(),s.current.volume=1)},10);c.current.push(()=>clearTimeout(e))},t=setInterval(()=>{n.volume=Math.max(0,n.volume-.033),e.volume=Math.min(1,e.volume+.033),(0===n.volume||1===e.volume)&&(clearInterval(t),l())},10),()=>{clearInterval(t)});c.current.push(()=>{s.current&&(s.current.volume=1),a()})}i("hd")},100);c.current.push(()=>clearTimeout(t))},[]),j=(0,l.useCallback)(()=>{let n=a.current;if(!n||!e||!t)return;f.current&&clearInterval(f.current);let i=setInterval(()=>{(()=>{if(r.current||!n.buffered.length||!s.current)return;let e=n.buffered.end(0),t=n.duration,a=1==n.networkState,l=s.current.currentTime>.25;if((e>=t||a&&e+.2>=t)&&l){let e=setTimeout(()=>{v()},250);c.current.push(()=>clearTimeout(e)),clearInterval(i)}})()},100);f.current=i,c.current.push(()=>{f.current&&clearInterval(f.current),f.current=null})},[e,t,v]),y=(0,l.useCallback)(()=>{let n=s.current;if(n&&e){if(n.src!==e&&(n.src=e,n.play().catch(e=>console.error("Play failed:",e))),n.preload="auto",t&&a.current&&!o.current){p.current&&n.removeEventListener("playing",p.current);let e=()=>{if(o.current||!a.current)return;let e=a.current;o.current=!0,j(),e.muted=!0,e.preload="auto",e.src=t,e.play().catch(e=>console.error("HD play failed:",e))};n.addEventListener("playing",e,{once:!0}),p.current=e}i("sd")}},[e,t,j]),b=(0,l.useCallback)(()=>{let s=a.current;s&&t&&e&&"sd"===n&&!o.current&&requestAnimationFrame(()=>{if(o.current)return;o.current=!0,j(),s.muted=!0,s.src=t,s.load(),s.preload="auto";let e=e=>console.error("HD video error:",e);s.addEventListener("error",e),c.current.push(()=>s.removeEventListener("error",e))})},[t,e,n,j]),w=(0,l.useCallback)(()=>{let e=a.current;e&&t&&(e.src!==t&&(e.muted=!0,e.src=t,e.load()),e.preload="auto",e.paused&&e.readyState<1&&e.addEventListener("loadedmetadata",()=>{e.play().catch(e=>console.error("Play failed:",e))},{once:!0}),i("hd"))},[t]),k=(0,l.useCallback)(()=>{x&&(e?y():w())},[x,e,y,w]),N=(0,l.useCallback)(()=>{g(),s.current&&(p.current&&(s.current.removeEventListener("playing",p.current),p.current=null),s.current.pause()),a.current&&(a.current.pause(),a.current.muted=!1),i(null),r.current=!1,o.current=!1},[g,i]);return(0,l.useEffect)(()=>{let s=t!==m;e!==d?(N(),u(e),h(t),requestAnimationFrame(()=>{x&&k()})):s&&e&&(h(t),b())},[e,t]),(0,l.useEffect)(()=>()=>N(),[N]),{sdRef:s,hdRef:a,activeQuality:n,start:k,destroy:N,isReady:x}}(null!=c?c:void 0,null!=d?d:void 0),V=(0,tI.useDebouncedValue)(q,100);(0,l.useEffect)(()=>{let e=_.current;if(!e)return;let t=new IntersectionObserver(e=>E(e.some(e=>e.isIntersecting)),{root:null,rootMargin:"0px",threshold:.1});return t.observe(e),()=>{e&&t.unobserve(e),t.disconnect(),E.cancel()}},[_]);let H=I||!M||!A||"image"===w;(0,l.useEffect)(()=>{let e="sd"===q?W.current:U.current,t=(c||d)&&e,s=u&&N.current;t&&(t.muted=H),s&&(s.muted=H),!H&&s&&t&&(s.play(),s.currentTime=t.currentTime)},[H,A,c,d,u,q,W,U]),(0,l.useEffect)(()=>{h&&(h.current="video"===w),p&&p("video"===w)},[p,h,w]),(0,l.useEffect)(()=>{G&&(k("video"),O())},[G]),(0,l.useEffect)(()=>{let e="sd"===q?W.current:U.current;e&&("image"===w?e.pause():"video"===w&&e.src&&e.play().catch(e=>{(0,D.logError)("imagine-post-page:handlePlay",e)}))},[w,q,W,U]),(0,l.useEffect)(()=>{let e="sd"===q?W.current:U.current,t=N.current;if(!e)return;let s=()=>{S(!1),t&&(null==t||t.play(),t.currentTime=e.currentTime)},a=()=>{null==t||t.pause(),S(!0)},n=()=>{t&&(t.currentTime=e.currentTime)},i=()=>{t&&(t.pause(),t.currentTime=0)},l=()=>{t&&(t.currentTime=e.currentTime)};return e.addEventListener("play",s),e.addEventListener("pause",a),e.addEventListener("seeking",n),e.addEventListener("ended",i),null==t||t.addEventListener("play",l),()=>{e.removeEventListener("play",s),e.removeEventListener("pause",a),e.removeEventListener("seeking",n),e.removeEventListener("ended",i),null==t||t.removeEventListener("play",l)}},[c,u,S,q,W,U,N]);let K=(0,l.useCallback)(e=>{e.stopPropagation(),A?T(!I):(L(!0),T(!1))},[I,T,L,A]),Q=I||!A,Y=(0,z.useMediaStore)(e=>e.setImageDimensions),$=(0,l.useCallback)(e=>{let t=e.target;Y(n,t.width,t.height)},[Y,n]),Z=(0,l.useMemo)(()=>(null!=i?i:832)/(null!=r?r:1248),[i,r]),J=window.innerHeight-160,{width:et}=F(_);return Z>et/J?(s=et,a=et/Z):(a=J,s=J*Z),(0,t.jsx)("div",{className:"w-full",ref:_,children:(0,t.jsxs)("div",{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),onClick:v?void 0:K,className:(0,ee.cn)("relative mx-auto rounded-2xl overflow-hidden",m),style:{width:s,height:a},children:[(0,t.jsxs)("div",{className:"grid",children:[(0,t.jsx)("img",{onLoad:$,src:o,className:(0,ee.cn)("col-start-1 row-start-1 w-full h-full object-cover","image"!==w&&"invisible pointer-events-none"),alt:g("generic-image-alt","Generated image")}),G&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("video",{id:"sd-video",ref:W,playsInline:!0,autoPlay:!0,controls:!1,loop:!0,poster:o,style:{visibility:("sd"===q||"sd"===V)&&"video"===w?"visible":"hidden"},className:(0,ee.cn)("col-start-1 row-start-1 w-full h-full object-cover","video"!==w&&"invisible pointer-events-none"),children:g("video-unsupported.label","Your browser does not support the video tag.")}),(0,t.jsx)("video",{id:"hd-video",ref:U,playsInline:!0,autoPlay:!0,controls:!1,loop:!0,poster:o,style:{visibility:"hd"===q&&"video"===w?"visible":"hidden"},className:(0,ee.cn)("col-start-1 row-start-1  w-full h-full object-cover","video"!==w&&"invisible pointer-events-none"),children:g("video-unsupported.label","Your browser does not support the video tag.")})]})]}),G&&u&&(0,t.jsx)("audio",{ref:N,src:u,muted:!0,loop:!0,className:"hidden",children:g("audio-unsupported.label","Your browser does not support the audio tag.")}),(0,t.jsx)("div",{className:"absolute bottom-12 left-0 flex flex-row justify-between items-center w-full p-3 gap-3",children:x&&(0,t.jsxs)("div",{className:"flex flex-row justify-center items-center gap-2 bg-[#555]/75 rounded-full p-2 px-2.5 animate-pulse-lg",children:[(0,t.jsx)(tc,{size:18}),(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:g("upscaling.label","Upscaling")})]})}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 flex flex-row justify-between items-center w-full p-3 gap-3",children:[(0,t.jsx)(tM,{value:w,onValueChange:k,className:(0,ee.cn)({hidden:!G}),activeQuality:q}),(0,t.jsx)(tT,{videoRef:"sd"===q?W:U,setInhibitFullPanelMute:j,show:y&&"video"===w&&!B}),(0,t.jsx)("div",{className:(0,ee.cn)(" transition-opacity duration-300",(y||B)&&"video"===w?"opacity-100":"opacity-0"),children:C?(0,t.jsx)(X.Button,{shape:"circle",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0","aria-label":g("video-play-button.label","Play"),onClick:e=>{e.stopPropagation(),e.preventDefault();let t="sd"===q?W.current:U.current;null==t||t.play().catch(e=>{(0,D.logError)("imagine-post-page:handlePlay",e)})},children:(0,t.jsx)(ey.Play,{className:"size-[20px]",fill:"currentColor",strokeWidth:0})}):(0,t.jsx)(X.Button,{shape:"circle",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0","aria-label":g("video-pause-button.label","Pause"),onClick:e=>{e.stopPropagation(),e.preventDefault();let t="sd"===q?W.current:U.current;null==t||t.pause()},children:(0,t.jsx)(tS.Pause,{className:"size-[20px]",fill:"currentColor",strokeWidth:0})})}),(0,t.jsx)("div",{children:(0,t.jsxs)(X.Button,{shape:A?"circle":"pill",size:"md",variant:"secondary",className:(0,ee.cn)("text-white bg-[#555]/75   hover:bg-[#555]/100 border-0","video"!==w&&"hidden",!A&&" gap-4"),onClick:K,children:[Q?(0,t.jsx)(tN,{className:"size-[20px]"}):(0,t.jsx)(tk.default,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,ee.cn)("font-semibold text-md",A&&"sr-only"),children:Q?g("video-unmute-button.label","Unmute"):g("video-mute-button.label","Mute")})]})})]})]})})});var tE=e.i(10404),tz=e.i(545452),tD=e.i(416872);let tR=[""];function tA(e,t){(0,D.logEventGlobal)(e,void 0,{location:"imagine-rabbithole",...t})}let tL="linear-gradient(to bottom, black 85%, transparent 100%)",tF={maskImage:tL,WebkitMaskImage:tL,maskComposite:"add"},t_=!1,tB=!1;function tG(e,t){let s,a="Unknown",n="Unknown",i="Unknown";e instanceof Error?(s=e.message,a=e.name,n=e.cause?String(e.cause):"",i=e.stack?e.stack:""):s="string"==typeof e?e:String(e),tA("image_feed_video_generation_error",{location:"imagine-post-page",message:s,mode:t.mode_name,error:a,cause:n,stack:i})}function tW(){let e=(0,ep.useFeatureFlags)(),{route:s}=(0,er.useRouting)(),a="imagine-post"===s.page?s.postId:(0,ty.never)("only for imagine post page"),n=(0,z.useMediaStore)(e=>e.postPageSections[a])||tR,r=(0,z.useMediaStore)(e=>e.pushPostPageSection),o=(0,em.useMobileUa)(),c=(0,z.useMediaStore)(e=>!!(e.byId[a]||e.favoritesById[a])),[d,u]=(0,l.useState)(!1);return(c||function(){function e(e){("Space"===e.key||"Enter"===e.key)&&t()}function t(){setTimeout(()=>{t_=!1},500),document.removeEventListener("click",t,!0),document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("mousedown",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("dblclick",t,!0),document.removeEventListener("keydown",e,!0),document.removeEventListener("keyup",e,!0)}tB||(tB=!0,document.addEventListener("click",t,!0),document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("dblclick",t,!0),document.addEventListener("keydown",e,!0),document.addEventListener("keyup",e,!0),t_=!0)}(),!o||c||e.DISABLE_IMAGINE_SHARE_APP_REDIRECT)?(0,t.jsxs)("div",{className:"w-full relative",children:[(0,t.jsx)(tU,{queries:n,setDisableQueryBarInput:u}),(0,t.jsx)("div",{className:"absolute left-0 bottom-0 w-full p-3",children:(0,t.jsx)(ex,{setQuery:e=>r(a,e),showFavorites:!0,navigateOnQuery:!1,disableInput:d})})]},a):(0,t.jsx)(i.default,{})}function tU(e){var s,a,n,i,r,o,c,d,u,m,h,p,f,x,g,v,j,y,b,w,k,N,C;let{queries:S,setDisableQueryBarInput:I}=e,T=(0,ep.useFeatureFlags)().ENABLE_IMAGINE_VIDEO_BUTTON_V2,{user:M}=(0,ev.useSession)(),{ASSET_SERVER_URL:P}=(0,ec.useEnvironment)(),{t:E}=(0,R.useTranslation)("imagine"),{route:D,push:A}=(0,er.useRouting)(),L="postId"in D?D.postId:"",_=(0,z.useMediaStore)(e=>e.pushPostPageSection),B=(0,z.useMediaStore)(e=>e.switchContext),[G,W]=(0,l.useState)(0),[U,O]=(0,l.useState)(!1),q=(0,l.useRef)(t_);eV();let V=(0,z.useMediaStore)(e=>e.fetchMediaPost),{isErrored:H,isLoading:K}=(0,tg.usePromise)(V(L)),Q=(0,z.useMediaStore)(e=>e.byId[L]||e.favoritesById[L]),[Y,Z]=(0,tz.useLocalStorage)("hasExpandedImagineVideoOptions_v00",!1),J=(0,z.useMediaStore)(e=>{var t;return(null!=(t=e.videoByMediaId[L])?t:[]).filter(e=>(null==e?void 0:e.progress)===100).length}),et=(0,z.useMediaStore)(e=>{var t;let s=(null!=(t=e.videoByMediaId[L])?t:[]).filter(e=>(null==e?void 0:e.progress)===100),a=Math.max(0,Math.min(s.length-G-1,s.length-1));return s[a]});(null==Q||null==(s=Q.mimeType)?void 0:s.includes("video"))&&(et=Q);let es=(0,l.useCallback)(()=>{q.current?A({page:"imagine"}):window.history.back()},[A,q]);(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&es()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[es]);let ea=(null==et?void 0:et.videoUrl)||(null==(a=et)?void 0:a.mediaUrl),en=(null==et?void 0:et.hdMediaUrl)||(null==(n=et)?void 0:n.hdMediaUrl),ei=null==et?void 0:et.upscalingInProgress,el=null==et||null==(i=et.audioUrls)?void 0:i[0];(el===ea||el===en)&&(el=void 0);let eo=null!=(x=null==et?void 0:et.id)?x:null==et?void 0:et.videoId,ed=(0,l.useRef)(!1),eu=(0,l.useRef)(null),em=(0,l.useRef)(null),{width:ef}=F(em),{height:ex}=F(eu),eg=(0,l.useRef)(S.length),ej=(0,eh.useMobileSize)(),ey=(0,eh.useMobileSize)(640);eJ(eu,ef>0?L:""),(0,l.useEffect)(()=>{if(S.length<=1||eg.current===S.length)return;let e=setTimeout(()=>{let e="imagine-masonry-section-".concat(S.length-1),t=document.getElementById(e);t&&eZ(t,eu.current,80)},350);return()=>clearTimeout(e)},[eg,S.length]),(0,l.useEffect)(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100)},[A,Q]);let eb=(null==Q||null==(r=Q.mimeType)?void 0:r.includes("video"))&&(null==Q||null==(o=Q.originalPost)?void 0:o.mediaUrl),ek=eb?null==Q||null==(c=Q.originalPost)?void 0:c.mediaUrl:null!=(g=null==Q?void 0:Q.blobSrc)?g:null==Q?void 0:Q.mediaUrl,eN=eb?null==Q||null==(d=Q.originalPost)?void 0:d.mediaUrl:null==Q?void 0:Q.mediaUrl,eC=eb&&null!=(v=null==Q||null==(u=Q.originalPost)?void 0:u.prompt)?v:null==Q?void 0:Q.prompt,eS=null!=(y=null!=(j=null==Q||null==(m=Q.originalPost)?void 0:m.modelName)?j:null==Q?void 0:Q.modelName)?y:"",eI=null==Q?void 0:Q.moderated,eT=M&&!eI,eM=null!=(w=null!=(b=null==Q||null==(h=Q.originalPost)?void 0:h.modelName)?b:null==Q?void 0:Q.modelName)?w:"",eP=null!=(N=null!=(k=null==Q||null==(p=Q.originalPost)?void 0:p.mode)?k:null==Q?void 0:Q.mode)?N:"",eE=null==et?void 0:et.originalPrompt,[ez,eD]=(0,l.useState)(!1);(0,l.useEffect)(()=>{I(!M||!eC)},[M,eC,I]);let eR=null!=(C=null==Q||null==(f=Q.originalPost)?void 0:f.id)?C:"",eA=null!=L?L:"";return((0,l.useEffect)(()=>{new URL(window.location.href).searchParams.get("source")&&t_&&tA("image_feed_shared_media_opened",{originalPostId:eR,postID:eA})},[eR,eA]),K&&!Q)?"":Q?(0,t.jsxs)("main",{tabIndex:-1,className:"w-full h-dvh relative overflow-y-auto",style:{outline:"none",scrollbarWidth:"none",...tF},ref:eu,children:[M&&(0,t.jsx)("div",{className:"h-0 sticky top-0 z-10 flex flex-row",children:(0,t.jsx)(X.Button,{variant:"secondary",shape:"circle",size:"md","aria-label":E("imagine-back-button.label","Back"),onClick:es,className:"sticky top-0 !bg-surface-l1 z-10 mt-2 mx-2",children:(0,t.jsx)($.default,{className:"size-4"})})}),(0,t.jsxs)("article",{className:(0,ee.cn)("max-w-[646px] my-4  mx-auto flex flex-col gap-4",ej&&"my-0"),ref:em,children:[(0,t.jsxs)("div",{className:"relative flex flex-row gap-2 justify-center items-center",onMouseEnter:()=>eD(!0),onMouseLeave:()=>eD(!1),children:[(0,t.jsx)(X.Button,{"aria-label":E("previous-video.label","Previous video"),variant:"tertiary",shape:"square",size:"md",onClick:()=>W(e=>e+1),className:(0,ee.cn)("z-10 opacity-50 h-1/4",ej?"absolute left-1":"absolute -left-12",!(U&&G<5&&G<J-1)&&"invisible",ez&&"opacity-100"),children:(0,t.jsx)(tn.ChevronLeft,{className:"size-8"})}),(0,t.jsx)(tP,{firstTimeInteracted:t_,mediaId:Q.id,imageWidth:Q.width,imageHeight:Q.height,imageSrc:ek||"",videoSrc:(0,ew.getCachedAssetUrl)(P,ea),audioSrc:(0,ew.getCachedAssetUrl)(P,el),hdVideoSrc:(0,ew.getCachedAssetUrl)(P,en),videoPlayingRef:ed,videoPlayingCb:O,upscalingInProgress:null!=ei&&ei}),(0,t.jsx)(X.Button,{"aria-label":E("next-video.label","Next video"),variant:"tertiary",shape:"square",size:"md",onClick:()=>W(e=>e-1),className:(0,ee.cn)("z-10 opacity-50 h-1/4",ej?"absolute right-1":"absolute -right-12",!(U&&G>0)&&"invisible",ez&&"opacity-100"),children:(0,t.jsx)(ti.ChevronRight,{className:"size-8"})})]}),M&&(0,t.jsxs)("div",{className:(0,ee.cn)("flex justify-between gap-5",ey&&"gap-2"),children:[(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex flex-row border border-border-l2 rounded-full p-1 h-13 bg-surface-l1",children:[(0,t.jsx)(tH,{post:Q}),(0,t.jsx)(tV,{post:Q,videoPlayingRef:ed,imageSrc:eN||"",videoUrl:ea,hdVideoUrl:en,modelName:eM,mode:eP,videoId:eo}),(0,t.jsx)(tK,{post:Q,videoPlayingRef:ed,videoId:eo,mode:eP}),(0,t.jsx)(tZ,{hdVideoUrl:en,post:Q,imageUrl:eN||"",videoUrl:ea,modelName:eM,videoModelName:eM,videoPlayingRef:ed,lastGeneratedVideo:et})]})}),(0,t.jsxs)("div",{className:"flex justify-end relative w-full",children:[eT&&(T?(0,t.jsx)(tq,{post:Q,isModelGenerated:!!eC,originalPrompt:eE,onVideoGenerationStart:()=>W(0)}):(0,t.jsx)(t$,{post:Q,setHasExpandedVideoOptions:Z,isModelGenerated:!!eC,originalPrompt:eE})),eT&&!Y&&(0,t.jsx)(tE.NotificationBlip,{variant:"reg",className:"absolute right-2 top-2 "})]})]}),M&&eC&&ef>0&&(0,t.jsx)(t.Fragment,{children:S.map((e,s)=>{let a=L+s,n=e+(a?"-".concat(a):"");return(0,t.jsxs)("div",{id:"imagine-masonry-section-".concat(s),className:"flex flex-col gap-4",children:[(0,t.jsx)(e$,{promptKey:n,prompt:e||eC,widthStyle:0===s?"full":"fit",onEdit:e=>{B(e),_(L,e)}}),(0,t.jsx)(eY,{isInitial:0===s,width:ef,height:ex,prompt:e||(null!=eC?eC:""),scrollContainerRef:eu,postId:a,freezeLoading:s<S.length-1,imageModelName:eS})]},"imagine-masonry-section-".concat(s))})}),!M&&(0,t.jsxs)("div",{className:"flex flex-col  mb-10  pb-10",children:[eC&&(0,t.jsx)(e$,{prompt:eC,widthStyle:"full"}),(0,t.jsx)("div",{className:"w-full flex flex-col items-center justify-center  -mt-4",children:(0,t.jsx)(tD.ImagineBanner,{persistentBanner:!0})})]})]})]}):""}let tO=tw.z.object({display_name:tw.z.string(),mode_name:tw.z.string(),is_mature:tw.z.boolean().optional(),custom_mode:tw.z.boolean().optional(),speech_mode:tw.z.boolean().optional()});function tq(e){let{post:s,isModelGenerated:a,originalPrompt:n,onVideoGenerationStart:i}=e,r=(0,l.useRef)(""),[o,c]=(0,l.useState)(null!=n?n:"");(0,l.useEffect)(()=>{n&&c(n)},[n]);let{replace:d}=(0,er.useRouting)(),u=(0,z.useMediaStore)(e=>(0,tb.default)(e.videoByMediaId[s.id])),m=(0,z.useMediaStore)(e=>e.fetchMediaPost),h=(0,z.useMediaStore)(e=>e.generateVideoForImage),p=(0,ef.useSettingsStore)(e=>e.setShowAgeVerification),f=(0,ef.useSettingsStore)(e=>e.setAgeVerificationCallback),x=(0,ef.useSettingsStore)(e=>e.ageVerificationCallback),{stage:g}=(0,ts.useAgeVerificationStage)(),v=(0,z.useMediaStore)(e=>e.smoothedVideoProgress[s.id]||e.smoothedVideoProgress[s.mediaPostId||""]),j=(0,l.useCallback)(e=>{var t;let a=null!=(t=r.current)?t:"";c(e=>a.trim().length>0?a:e);let n=()=>{var t,n,l;let r=e.speech_mode?"speech":e.custom_mode?"custom":"",o="speech"===r?a:void 0,c="custom"===r?a:void 0;tA("image_feed_video_generation_started",{location:"imagine-post-page",mode:e.mode_name,source:"lightbox"});let u=null==(t=s.originalPost)?void 0:t.id;if(u)return void m(u).then(t=>{var s,a;null==i||i(),h(null!=(a=null==(s=t.originalPost)?void 0:s.id)?a:t.id,e.mode_name,"imagine-post-page",o,c).catch(t=>{tG(t,e),(0,D.logError)("imagine-post-page",t)}),d({page:"imagine-post",postId:t.id})}).catch(e=>{tA("image_feed_video_generation_error",{location:"imagine-post-page",message:"failed to fetch original post"}),(0,D.logError)("imagine-post-page",e)});null==i||i(),h(null!=(l=null==(n=s.originalPost)?void 0:n.id)?l:s.id,e.mode_name,"imagine-post-page",o,c).catch(t=>{tG(t,e),(0,D.logError)("imagine-post-page",t)})};if(!e.is_mature||"pass"===g)return void n();let l=()=>{n(),x===l&&f(void 0)};f(l),p(!0)},[s,m,h,p,f,x,r,g,d,c,i]),y="number"==typeof(null==u?void 0:u.progress)&&u.progress<100?Math.round(null!=v?v:0):100;return(0,t.jsx)(tY,{videoProgress:y,lastPrompt:o,runVideoGeneration:(e,t)=>{e.custom_mode&&(r.current=t,c(t)),j(e)},isModelGenerated:a})}function tV(e){let{post:s,videoPlayingRef:a,videoUrl:n,hdVideoUrl:i,modelName:l,mode:r,videoId:o,imageSrc:c}=e,{t:d}=(0,R.useTranslation)("imagine"),{ASSET_SERVER_URL:u}=(0,ec.useEnvironment)();return(0,t.jsxs)(X.ButtonWithTooltip,{shape:"circle",size:"sm",variant:"tertiary",tooltipContent:d("download-button.tooltip","Download"),onClick:()=>{tA("image_feed_image_saved",{post_id:s.id,video_id:o,model_name:l,mode:r});let e=a.current?i||n:c,t=(0,ew.getCachedAssetUrl)(u,e),d=a.current?"grok-video-".concat(s.id,".mp4"):"grok-image-".concat(s.id,".png");(0,tv.downloadImage)(t,d,!1).catch(e=>{(0,D.logError)("imagine-post-page:downloadImage",e)})},children:[(0,t.jsx)(tl.Download,{className:"size-4"}),(0,t.jsx)("span",{className:"sr-only",children:d("image-download-button.label","Download image")})]})}function tH(e){var s;let{post:a}=e,{t:n}=(0,R.useTranslation)("imagine"),i=(0,z.useMediaStore)(e=>e.like),l=(0,z.useMediaStore)(e=>e.unlike),r=(null==(s=a.userInteractionStatus)?void 0:s.likeStatus)===!0;return(0,t.jsxs)(X.ButtonWithTooltip,{shape:"circle",size:"sm",variant:"tertiary",tooltipContent:n("save-to-favorites.tooltip","Save to favorites"),onClick:async()=>{var e,t;r?await l(a.id):await i(a.id),r||tA("image_feed_image_liked",{image_url:a.mediaUrl,post_id:null!=(e=a.itemId)?e:a.id,model_name:null!=(t=a.modelName)?t:""})},children:[(0,t.jsx)(ej.HeartIcon,{className:(0,ee.cn)("size-4",r&&"text-red-400 dark:text-red-500"),fill:r?"currentColor":"none",stroke:r?"none":"currentColor"}),(0,t.jsx)("span",{className:"sr-only",children:r?n("image-unlike-button.label","Unsave"):n("image-like-button.label","Save image")})]})}function tK(e){let{post:s,videoPlayingRef:a,videoId:n,mode:i}=e,{t:l}=(0,R.useTranslation)("imagine"),r=(0,eh.useMobileSize)(),{route:o}=(0,er.useRouting)(),c=(0,z.useMediaStore)(e=>e.resolveMediaPostForMaybeGenerated),d=(0,z.useMediaStore)(e=>e.createShareLink),u=async()=>{var e,t,r,u;let m,h=(0,er.getCanonicalUrl)(o,window.location.origin),p=await c(s);if(m=a.current&&n?null!=(e=await d(n,"post-page"))?e:"":p?null!=(t=await d(p.id,"post-page"))?t:"":h,window.location.hostname.includes("localhost")){let e=new URL(m);m="http://localhost:26000"+e.pathname+e.search}(0,tj.copyAndToast)(m,l("image-share-copy-link-success","Public link copied")),tA("image_feed_media_shared",{type:"copy_link",media:a.current?"video":"image",post_id:null!=(r=null==p?void 0:p.id)?r:s.id,post_link:m,model_name:null!=(u=s.modelName)?u:"",mode:i})};return(0,t.jsxs)(X.ButtonWithTooltip,{shape:r?"circle":"pill",size:"sm",variant:"tertiary",onClick:u,tooltipContent:l("image-share-button.public-warning","Anyone with the link can view this"),className:"px-1.5",children:[(0,t.jsx)(tm,{className:"size-4"}),(0,t.jsx)("span",{className:(0,ee.cn)("font-medium",r&&"sr-only"),children:l("image-share-button.label","Share")})]})}function tQ(e){let{isModelGenerated:t}=e,s=(0,ep.useFeatureFlags)(),{stage:a}=(0,ts.useAgeVerificationStage)();return(0,l.useMemo)(()=>{let e=[];for(let n of s.MEDIA_GEN_VIDEO_CONFIG.get("media_gen_video_prompt_available_modes",[])){if(n.model_generated_only&&!t)continue;let s=tO.safeParse(n);s.success&&("nopass"!==a||!s.data.is_mature)&&e.push(s.data)}return e},[s.MEDIA_GEN_VIDEO_CONFIG,a,t])}function tY(e){let{videoProgress:s,lastPrompt:a,runVideoGeneration:n,isModelGenerated:i}=e,[r,o]=(0,l.useState)(!1),c=(0,l.useRef)(null),d=c.current,u=(0,l.useCallback)(()=>{if(d){let e=d.getBoundingClientRect();e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)||setTimeout(()=>{d.scrollIntoView({behavior:"instant",block:"end"})},50)}},[d]);return(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("div",{className:(0,ee.cn)("flex w-full h-full border border-border-l2 rounded-full overflow-hidden items-center bg-surface-l1",r&&"rounded-3xl"),children:(0,t.jsx)(tX,{scrollTextareaIntoView:u,lastPrompt:a,videoProgress:s,isMultiline:r,setIsMultiline:o,runVideoGeneration:n,isModelGenerated:i})}),(0,t.jsx)("div",{ref:c,className:"absolute left-0 -bottom-24 bg-red-500 w-10 h-10 z-10 invisible"})]})}function tX(e){let{lastPrompt:s,videoProgress:a,isMultiline:n,setIsMultiline:i,runVideoGeneration:r,scrollTextareaIntoView:o,isModelGenerated:c}=e,{t:d}=(0,R.useTranslation)("imagine"),u=tQ({isModelGenerated:c}).filter(e=>"custom"!==e.mode_name),m=(0,l.useCallback)(e=>{r(e,""),p(null),w("")},[r]),[h,p]=(0,l.useState)(s),f=(0,l.useRef)(null),x=f.current,g=d("video-prompt.placeholder","Type to customize video..."),v=d("video-prompt.placeholder-small-mobile","Customize video..."),[j,y]=(0,l.useState)(0),[b,w]=(0,l.useState)(s);(0,l.useEffect)(()=>{s&&w(s)},[s]);let[k,N]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),I=!!b,T=h&&h.trim()==b.trim()&&a<100;(0,l.useEffect)(()=>{I||y(e=>e+1)},[I,y]);let M=()=>{let e=b.trim();e?(r({mode_name:"custom",display_name:"Custom",custom_mode:!0},e),p(e)):(r({mode_name:"normal",display_name:"Normal"},""),p(null))},[P,E]=(0,l.useState)(!1),z=(0,l.useCallback)((e,t)=>{let s=Math.floor((e-15)/t.rowHeight),a=s>=4;a!==P&&E(a),i(s>1),s>1&&o()},[P,E,4,i,o]);(0,l.useEffect)(()=>{C&&(S(!1),M())},[C]),(0,l.useEffect)(()=>{f.current&&(f.current.style.setProperty("border-bottom",P?"5px solid transparent":"0px solid transparent"),f.current.style.setProperty("border-top",P?"1px solid transparent":"0px solid transparent"))},[P,f]),(0,l.useEffect)(()=>{if(!k)return;let e=e=>{if("Escape"===e.key){e.stopPropagation(),e.preventDefault();return}"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),S(!0))};return x&&x.addEventListener("keydown",e),()=>{x&&x.removeEventListener("keydown",e)}},[k,x,S]);let D=(0,eh.useMobileSize)(640),A=b.trim().length<17&&!D;return(0,t.jsxs)("div",{className:(0,ee.cn)("relative flex gap-1 flex-row px-1 w-full items-center bg-surface-l1",n&&"items-end"),children:[(0,t.jsx)(eK.default,{style:{resize:"none"},onFocus:()=>N(!0),onBlur:()=>N(!1),value:b,onChange:e=>w(e.target.value),ref:f,rows:1,maxRows:4,"aria-required":"true","aria-label":d("video-prompt.placeholder","Make a video"),placeholder:D?v:g,onHeightChange:z,className:(0,ee.cn)("w-full px-3 pe-16 bg-transparent py-2 text-md font-medium placeholder:text-muted-foreground focus-visible:outline-none",T&&"animate-pulse-lg")},"textarea-editor-".concat(j)),(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-row  items-center absolute right-0 px-1.5  justify-end h-7",n&&"mb-2"),children:[(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.ButtonWithTooltip,{shape:"pill",size:"sm",variant:a<100?"primary":"tertiary",className:(0,ee.cn)("transition-all duration-400 h-7 group ps-1.5 pe-1 gap-0 text-secondary ms-1 rounded-e-none -me-4",n&&"rounded-l-3xl",a<100&&"text-fg-invert"),tooltipContent:d("make-video-presets.label","Video Presets"),children:[a<100?(0,t.jsxs)("div",{className:"text-xs font-semibold w-[4ch] mb-[1px]",children:[a,"%"]}):(0,t.jsx)(td.Film,{className:"size-4"}),(0,t.jsx)(ta.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"}),(0,t.jsx)("div",{className:"w-4"})]})}),(0,t.jsx)(tx.DropdownMenuContent,{align:"start",side:"top",children:u.map(e=>(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>m(e),children:e.display_name},e.mode_name))})]}),(0,t.jsxs)(X.Button,{"aria-label":d("image-make-video-button.label","Make video"),shape:A?"pill":"circle",size:"sm",variant:"primary",onClick:M,className:(0,ee.cn)("h-7  z-20 items-center",n&&" me-0.5",A&&"pe-1 ps-3",!A&&"w-7"),children:[A&&(0,t.jsx)("span",{className:"font-semibold text-xs mb-[1px]",children:d("image-make-video-button.label","Make video")}),(0,t.jsx)("span",{className:"ms-0.5",children:(0,t.jsx)(ey.Play,{size:18,fill:"currentColor",strokeWidth:0})})]})]})]})}function t$(e){let{post:s,setHasExpandedVideoOptions:a,isModelGenerated:n,originalPrompt:i}=e,{t:r}=(0,R.useTranslation)("imagine"),[o,c]=(0,l.useState)(""),d=(0,l.useRef)(null),[u,m]=(0,l.useState)(null!=i?i:""),h=(0,l.useCallback)(e=>{d.current=e,e&&(e.value=u)},[u]),{replace:p}=(0,er.useRouting)(),f=(0,z.useMediaStore)(e=>(0,tb.default)(e.videoByMediaId[s.id])),x=(0,z.useMediaStore)(e=>e.fetchMediaPost),g=(0,z.useMediaStore)(e=>e.generateVideoForImage),v=(0,ef.useSettingsStore)(e=>e.setShowAgeVerification),j=(0,ef.useSettingsStore)(e=>e.setAgeVerificationCallback),y=(0,ef.useSettingsStore)(e=>e.ageVerificationCallback),{stage:b}=(0,ts.useAgeVerificationStage)(),w=tQ({isModelGenerated:n}),k=(0,z.useMediaStore)(e=>e.smoothedVideoProgress[s.id]||e.smoothedVideoProgress[s.mediaPostId||""]),N=(0,eh.useMobileSize)(),C=(0,l.useCallback)(e=>{var t,a;let n=null!=(a=null==(t=d.current)?void 0:t.value)?a:"";m(e=>n.trim().length>0?n:e),d.current&&(d.current.value="");let i=()=>{var t,a,i;let l="speech"===o?n:void 0,r="custom"===o?n:void 0;tA("image_feed_video_generation_started",{location:"imagine-post-page",mode:e.mode_name,source:"lightbox"});let c=null==(t=s.originalPost)?void 0:t.id;if(c)return void x(c).then(t=>{var s,a;g(null!=(a=null==(s=t.originalPost)?void 0:s.id)?a:t.id,e.mode_name,"imagine-post-page",l,r).catch(t=>{tG(t,e),(0,D.logError)("imagine-post-page",t)}),p({page:"imagine-post",postId:t.id})}).catch(e=>{tA("image_feed_video_generation_error",{location:"imagine-post-page",message:"failed to fetch original post"}),(0,D.logError)("imagine-post-page",e)});g(null!=(i=null==(a=s.originalPost)?void 0:a.id)?i:s.id,e.mode_name,"imagine-post-page",l,r).catch(t=>{tG(t,e),(0,D.logError)("imagine-post-page",t)})};if(e.custom_mode||e.speech_mode)if(!o)return void c(e.speech_mode?"speech":"custom");else{i(),c("");return}if(!e.is_mature||"pass"===b)return void i();let l=()=>{i(),y===l&&j(void 0)};j(l),v(!0)},[s,x,g,v,j,y,c,o,d,b,p,m]),S=(0,l.useCallback)(()=>{(!d.current||d.current.value.trim())&&C({display_name:"Normal",mode_name:"normal",custom_mode:"custom"===o,speech_mode:"speech"===o})},[C,o,d]);if((0,l.useEffect)(()=>{let e=d.current,t=t=>{if("Escape"===t.key){t.stopPropagation(),t.preventDefault(),c("");return}"Enter"===t.key&&(null==e?void 0:e.value.trim())&&(t.preventDefault(),t.stopPropagation(),S())};return e&&o&&(e.focus(),window.addEventListener("keydown",t,!0)),()=>window.removeEventListener("keydown",t,!0)},[o,S]),o){let e="speech"==o?r("image-make-video-text-input.placeholder.speech","Say something"):r("image-make-video-text-input.placeholder.custom","Custom video prompt");return(0,t.jsxs)("div",{className:(0,ee.cn)("flex gap-1 flex-row ms-12 px-2 w-full rounded-full border border-border-l2 items-center bg-surface-l1",N&&"ms-2"),children:[(0,t.jsx)(X.Button,{"aria-label":r("image-make-video-text-input.close.label","Close"),shape:"circle",size:"xs",variant:"tertiary",onClick:()=>c(""),children:(0,t.jsx)(tf.X,{className:"size-4"})}),(0,t.jsx)("input",{ref:h,type:"text","aria-required":"true","aria-label":r("image-make-video-text-input.label","Custom prompt"),placeholder:e,className:"w-full bg-transparent py-2 text-sm font-medium placeholder:text-muted-foreground focus-visible:outline-none"}),(0,t.jsx)(X.Button,{"aria-label":r("image-make-video-text-input.close.label","Close"),shape:"circle",size:"xs",variant:"tertiary",onClick:S,className:"bg-surface-invert hover:bg-surface-invert hover:opacity-80",children:(0,t.jsx)("span",{className:"text-surface-l2 ms-0.5",children:(0,t.jsx)(ey.Play,{className:"size-4",fill:"currentColor",strokeWidth:0})})})]})}if(f){let e="number"==typeof(null==f?void 0:f.progress)&&f.progress<100;return(0,t.jsxs)(tx.DropdownMenu,{onOpenChange:e=>{e&&a(!0)},children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:e?(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",className:(0,ee.cn)(f&&"cursor-progress"),children:[(0,t.jsx)(ey.Play,{fill:"currentColor",strokeWidth:0,className:"size-4"}),(0,t.jsx)("span",{className:"w-[4ch]","aria-live":"polite",role:"status","aria-label":r("image-make-video-progres.aria","Video generation progress: {{progressValuePercentage}}%",{progressValuePercentage:f.progress}),children:r("image-make-video-progress.label","{{progressValuePercentage}}%",{progressValuePercentage:Math.round(null!=k?k:0)})}),(0,t.jsx)(ta.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"})]}):(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",className:"group",children:[(0,t.jsx)(ey.Play,{fill:"currentColor",strokeWidth:0,className:"size-4"}),r("video-redo-button.label","Redo"),(0,t.jsx)(ta.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"})]})}),(0,t.jsx)(tx.DropdownMenuContent,{align:"end",side:"bottom",children:w.map(e=>(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>C(e),children:e.display_name},e.display_name))})]})}let I=w.find(e=>"normal"===e.mode_name&&!e.custom_mode&&!e.speech_mode)||w[0];return(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",onClick:()=>I&&C(I),className:"rounded-e-none border-r border-border-l2 pe-2",children:[(0,t.jsx)(ey.Play,{fill:"currentColor",strokeWidth:0,className:"size-4"}),r("image-make-video-button.label","Make video")]}),(0,t.jsxs)(tx.DropdownMenu,{onOpenChange:e=>{e&&a(!0)},children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",className:"group rounded-s-none border-s-0 ps-2 pe-3",children:[(0,t.jsx)(ta.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"}),(0,t.jsx)("span",{className:"sr-only",children:r("video-generation-model-selector.label","Pick style")})]})}),(0,t.jsx)(tx.DropdownMenuContent,{align:"end",side:"bottom",children:w.map(e=>(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>C(e),children:e.display_name},e.mode_name))})]})]})}function tZ(e){let{post:s,imageUrl:a,videoUrl:n,hdVideoUrl:i,modelName:l,videoModelName:r,videoPlayingRef:o,lastGeneratedVideo:c}=e,d=(0,ep.useFeatureFlags)(),u=d.SHOW_IMAGINE_DEV_INFO,m=o.current?n:a,h=(0,z.useMediaStore)(e=>e.dislikedIds[m]),p=(0,z.useMediaStore)(e=>e.likedIds[m]),f=(0,z.useMediaStore)(e=>e.upscaleVideo),x=(0,z.useMediaStore)(e=>e.setDisliked),g=(0,z.useMediaStore)(e=>e.setLiked),v=u?null==c?void 0:c.videoPrompt:void 0,{t:j}=(0,R.useTranslation)("imagine"),y=j("image-make-video-three-dot-button.label","More options");return(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(X.Button,{shape:"circle",size:"sm",variant:"tertiary","aria-label":y,children:(0,t.jsx)(tr.Ellipsis,{className:"size-4"})})}),(0,t.jsxs)(tx.DropdownMenuContent,{align:"start",side:"top",children:[(0,t.jsx)(tx.DropdownMenuItem,{disabled:p,onSelect:()=>{var e;g(m),x(m,!1),tA("image_feed_like",{type:o.current?"video":"image",url:m,post_id:null!=(e=s.itemId)?e:s.id,model_name:o.current?r:l})},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tp.ThumbsUp,{className:"size-4",fill:p?"currentColor":"none"}),j("image-thumbs-up-button.label","Thumbs up")]})}),(0,t.jsx)(tx.DropdownMenuItem,{disabled:h,onSelect:()=>{var e;x(m),g(m,!1),tA("image_feed_dislike",{type:o.current?"video":"image",url:m,post_id:null!=(e=s.itemId)?e:s.id,model_name:o.current?r:l})},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(th.ThumbsDown,{className:"size-4",fill:h?"currentColor":"none"}),j("image-thumbs-down-button.label","Thumbs down")]})}),d.ENABLE_UPSCALE_VIDEO&&(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>{if(!(null==c?void 0:c.id))return void(0,D.logError)("imagine-post-page",Error("No video ID found"));f(s.id,null==c?void 0:c.id).catch(e=>{(0,D.logError)("imagine-post-page",e)})},disabled:!!i||!n,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tc,{className:"size-4"}),j("image-upscale-video-button.label","Upscale video")]})}),v&&(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>{(0,tj.copyAndToast)(null!=v?v:"","Copied")},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(tu.Info,{className:"size-4"}),"Dev Info"]})})]})]})}var tJ=e.i(795021),$=$,t0=e.i(408654),t0=t0,t1=e.i(179314),t2=e.i(623434),t5=e.i(723008);function t4(){let{route:e}=(0,er.useRouting)(),s=(0,tJ.useImagineCarpetStore)(e=>e.enabled),a=(0,tJ.useImagineCarpetStore)(e=>e.selectedAsset),[n,i]=(0,l.useState)(null),{resolvedTheme:r,setTheme:o}=(0,es.useTheme)();return((0,l.useEffect)(()=>{"dark"!==r&&o("dark")},[]),(0,tJ.useImagineCarpetConfig)(),s)?n?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col items-center justify-center gap-4 bg-black",children:[(0,t.jsx)("div",{className:"w-full h-[10%]",children:(0,t.jsx)(st,{backAction:()=>{i(null)}})}),(0,t.jsx)("div",{className:"w-full h-[90%]",children:(0,t.jsx)("iframe",{allow:"fullscreen",src:n+"?"+new Date().getTime(),className:"w-full h-full"})})]}):"imagine-carpet"===e.page&&void 0!==e.display?(0,t.jsx)(t3,{idx:e.display}):a?(0,t.jsx)(t8,{onBack:()=>{tJ.useImagineCarpetStore.getState().setSelectedAsset(null)}}):(0,t.jsx)(t6,{setIframeSrc:i}):(0,t.jsx)(t5.Spinner,{})}function t3(e){var s,a;let{idx:n}=e;(0,tJ.useImagineCarpetConfig)();let i=(0,l.useRef)(null);(0,l.useEffect)(()=>(tJ.useImagineCarpetStore.getState().startPhotoRollPolling("tv_feed"),()=>{tJ.useImagineCarpetStore.getState().stopPhotoRollPolling()}),[]);let r=(0,tJ.useImagineCarpetStore)(e=>e.getTvItem(n-1)),o=(0,ec.useEnvironment)().ASSET_SERVER_URL,c=null!=(s=(0,ew.getCachedAssetUrl)(o,null==r?void 0:r.key))?s:"";return(0,t.jsx)("img",{ref:i,src:c,alt:null!=(a=null==r?void 0:r.name)?a:"full screen image",className:"w-full h-dvh object-cover",onClick:function(){var e;null==(e=i.current)||e.requestFullscreen().catch(e=>{(0,D.logError)("TvDisplay:handleClick",e)})}})}function t8(e){var s,a,n;let{onBack:i}=e,r=(0,tJ.useImagineCarpetStore)(e=>e.submitImageForProcessing),o=(0,tJ.useImagineCarpetStore)(e=>e.setSelectedAsset),[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(!0),[h,p]=(0,l.useState)(0),[f,x]=(0,l.useState)(""),[g,v]=(0,l.useState)(!1),j=(0,l.useRef)(null),y=(0,tJ.useImagineCarpetStore)(e=>e.asset_path),b=(0,tJ.useImagineCarpetStore)(e=>e.email_str),w=(0,tJ.useImagineCarpetStore)(e=>e.thanks_str1),k=(0,tJ.useImagineCarpetStore)(e=>e.thanks_str2),N=(0,tJ.useImagineCarpetStore)(e=>e.thanks_str3);(0,l.useEffect)(()=>{c&&setTimeout(()=>{o(null),d(!1)},13e3)},[c,o,d]);let C=(0,tJ.useImagineCarpetStore)(e=>e.theme_options),S=(0,tJ.useImagineCarpetStore)(e=>e.selectedAsset),I=(0,ec.useEnvironment)().ASSET_SERVER_URL,T=null!=(a=(0,ew.getCachedAssetUrl)(I,null==S?void 0:S.key))?a:"",M=null!=(n=null==C||null==(s=C[h])?void 0:s.prompt)?n:"",P=(0,l.useCallback)(()=>{d(!0),m(!0),setTimeout(()=>{(async function(){await r(T,null!=M?M:"",f)})().catch(e=>{(0,D.logError)("SelectedAsset:submit",e)})},1)},[r,d,f,m,T,M]),E=(0,l.useCallback)(e=>{p(e),v(!0),setTimeout(()=>{m(!1),v(!1)},250)},[m,v]);return c?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col ",children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+y+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:(0,t.jsxs)(t2.motion.div,{className:"flex flex-col items-center justify-center gap-8 w-full h-full",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"circIn"},children:[(0,t.jsx)("h1",{className:"text-5xl font-bold ",children:w}),(0,t.jsx)("p",{className:"text-3xl font-semibold w-full text-center leading-normal",children:k}),(0,t.jsx)("p",{className:"text-3xl font-semibold w-2/3 text-center leading-normal",children:N})]})}),(0,t.jsx)(se,{})]}):u?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col ",children:[(0,t.jsx)(ss,{backAction:i}),(0,t.jsx)("img",{src:"https://data.x.ai/"+y+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)("div",{className:"absolute top-10 left-0 w-full flex items-center justify-center pointer-events-none",children:(0,t.jsx)("img",{src:"https://data.x.ai/"+y+"/choose_theme.png",alt:"Choose Photo",width:340.5,height:32.5})}),(0,t.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center ",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-20 justify-center",children:(0,t.jsx)(t1.AnimatePresence,{mode:"wait",children:C.map((e,s)=>{let a=!1;return g&&s===h&&(a=!0),(0,t.jsx)(t2.motion.button,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeIn",delay:.1*s},onClick:e=>{e.stopPropagation(),e.preventDefault(),E(s)},children:(0,t.jsxs)("div",{className:"w-[280px] h-[380px] flex flex-col items-center justify-center gap-1 ",children:[(0,t.jsx)("img",{src:e.image,className:"w-full h-full object-cover"+(a?" ring-4 ring-white":""),alt:"<img>"}),(0,t.jsx)("label",{className:" text-center m-2 font-bold text-xl",children:e.label})]})},s)})})})}),(0,t.jsx)(se,{bottom:20})]}):(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col gap-2",children:[(0,t.jsx)(st,{backAction:()=>{m(!0)}}),(0,t.jsx)("img",{src:"https://data.x.ai/"+y+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)("div",{className:"w-full h-2/5 flex items-center justify-center p-4 mt-8",children:(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:(0,t.jsx)(t2.motion.img,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeIn"},width:225,height:400,src:T,alt:null==S?void 0:S.name,className:"object-cover ",style:{rotate:"10deg"}})})}),(0,t.jsxs)("div",{className:"w-full h-1/2 flex flex-col items-center  gap-4",children:[(0,t.jsx)("h2",{className:"text-[42px] font-bold w-2/3 text-center leading-normal",children:b}),(0,t.jsx)("div",{className:"w-4/5",children:(0,t.jsxs)("form",{className:"w-full flex flex-row items-center justify-center",autoComplete:"off",onSubmit:e=>{var t;e.preventDefault(),(null==(t=j.current)?void 0:t.validity.valid)&&P()},children:[(0,t.jsx)(X.Button,{type:"submit",variant:"none",size:"md",shape:"circle",className:"invisible",children:(0,t.jsx)(t0.default,{className:"size-8"})}),(0,t.jsx)("input",{ref:j,autoComplete:"off",pattern:"[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$",spellCheck:"false",autoCapitalize:"none",autoCorrect:"off",type:"email",id:"email",name:"email",required:!0,className:"outline-none w-full font-medium p-10 m-2 border-b-4 border-white bg-transparent text-3xl",placeholder:"ani@grok.com",value:f,onChange:e=>{x(e.target.value)}}),(0,t.jsx)(X.Button,{type:"submit",variant:"none",size:"md",shape:"circle","aria-label":"Submit",children:(0,t.jsx)(t0.default,{className:"size-10"})})]})})]}),(0,t.jsx)(se,{})]})}function t6(e){let{setIframeSrc:s}=e,[a,n]=(0,l.useState)(!0);(0,l.useEffect)(()=>(tJ.useImagineCarpetStore.getState().startPhotoRollPolling("photo_roll"),()=>{tJ.useImagineCarpetStore.getState().stopPhotoRollPolling()}),[]);let i=(0,tJ.useImagineCarpetStore)(e=>e.asset_path),[r,o]=(0,l.useState)(!0),c=(0,tJ.useImagineCarpetStore)(e=>e.show_legal_terms),d=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),o(!1),setTimeout(()=>{n(!1),o(!0)},250)},[n]),[u,m]=(0,l.useState)(null);return((0,l.useEffect)(()=>{let e="pulse-bright-inline";if(!document.getElementById(e)){let t=document.createElement("style");t.id=e,t.textContent="\n        @keyframes pulse-bright-inline {\n          0%, 100% { filter: brightness(0.8); opacity: 0.75; }\n          50% { filter: brightness(1.8); opacity: 1; }\n        }\n        .pulse-bright-inline {\n          animation: pulse-bright-inline 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n      ",document.head.appendChild(t),m(e)}return()=>{if(u){let e=document.getElementById(u);e&&document.head.removeChild(e)}}},[u]),a)?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col bg-black items-center justify-center",onClick:d,children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+i+"/logo2.png",alt:"Logo",width:467,height:140,className:"mix-blend-screen"}),(0,t.jsx)("div",{className:"h-[200px]"}),(0,t.jsx)("div",{className:"w-full flex items-center justify-center",style:{height:"".concat(131,"px")},children:(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:r&&(0,t.jsx)(t2.motion.img,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.3,ease:"easeOut"},src:"https://data.x.ai/"+i+"/start_btn.png",alt:"Start",width:432,height:131,className:"mix-blend-screen pulse-bright-inline"})})}),(0,t.jsx)("div",{className:"h-[200px]"}),(0,t.jsx)("div",{className:"h-[140px]"}),(0,t.jsx)(se,{scale:1.75,includeTerms:c,setIframeSrc:s})]}):(0,t.jsx)(t9,{setShowStartPage:n})}function t9(e){let{setShowStartPage:s}=e,a=(0,tJ.useImagineCarpetStore)(e=>e.list),n=(0,l.useRef)(null),i=(0,tJ.useImagineCarpetStore)(e=>e.asset_path),{width:r,height:o}=F(n),c=function(e,t){let{width:s,columnWidth:a=200,columnGutter:n=0,rowGutter:i,columnCount:r,maxColumnCount:o,maxColumnWidth:c}=e;void 0===t&&(t=e_);let d=()=>{let[e,t]=eF(s,a,n,r,o,c);return eA(t,e,n,null!=i?i:n)},u=l.useRef();void 0===u.current&&(u.current=d());let m=l.useRef(t),h=[s,a,n,i,r,o,c],p=l.useRef(h),f=!h.every((e,t)=>p.current[t]===e);if(f||!t.every((e,t)=>m.current[t]===e)){let e=u.current,s=d();if(m.current=t,p.current=h,f){let t=e.size();for(let a=0;a<t;a++){let t=e.get(a);s.set(a,void 0!==t?t.height:0)}}u.current=s}return u.current}({width:r,columnWidth:512,columnGutter:10,columnCount:2,maxColumnCount:5},[r]),d=M(c),{scrollTop:u,isScrolling:m}=Q(n);(0,l.useEffect)(()=>{let e;function t(){clearTimeout(e),e=setTimeout(()=>{s(!0)},15e3)}return window.addEventListener("mousemove",t),window.addEventListener("touchstart",t),window.addEventListener("keydown",t),window.addEventListener("touchmove",t),t(),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t),window.removeEventListener("touchmove",t),clearTimeout(e)}},[s,u]);let h=j({positioner:c,resizeObserver:d,scrollTop:u,isScrolling:m,height:o,itemHeightEstimate:500,items:a,render:t7,onRender:()=>{},overscanBy:5,itemKey:e=>{var t;return null!=(t=null==e?void 0:e.assetId)?t:""},role:"list"});return(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col bg-black fade-in",children:[(0,t.jsx)("div",{tabIndex:-1,className:"flex flex-col w-full h-dvh overflow-scroll items-center",ref:e=>{n.current=e},children:h}),(0,t.jsx)("div",{className:"w-full h-[364px] absolute top-0 left-0 pointer-events-none",children:(0,t.jsx)("img",{className:"animate-accordion-down",src:"https://data.x.ai/"+i+"/scrim.png",alt:"Choose Photo",width:"100%",height:"100%"})}),(0,t.jsx)("div",{className:"absolute top-10 left-0 w-full flex items-center justify-center pointer-events-none",children:(0,t.jsx)("img",{src:"https://data.x.ai/"+i+"/choose_photo.png",alt:"Choose Photo",width:340.5,height:32.5})})]})}function t7(e){var s;let{data:a,width:n,index:i}=e,{ASSET_SERVER_URL:r}=(0,ec.useEnvironment)(),[o,c]=(0,l.useState)(!1),d=null!=(s=(0,ew.getCachedAssetUrl)(r,a.key))?s:"";return(0,t.jsx)("div",{style:{width:n,height:1.5*n},onClick:e=>{o&&tJ.useImagineCarpetStore.getState().setSelectedAsset(a),e.stopPropagation(),e.preventDefault()},children:(0,t.jsx)("img",{onLoad:()=>setTimeout(()=>c(!0),50*Math.min(10,i+1)),className:(0,ee.cn)("w-full h-full object-cover opacity-0 transition-all duration-500 ease-in-expo scale-50  ",o&&"opacity-100 scale-100"),src:d,alt:a.name})})}function se(e){let{bottom:s=100,scale:a=1,includeTerms:n=!1,setIframeSrc:i}=e,l=(0,tJ.useImagineCarpetStore)(e=>e.asset_path);return(0,t.jsxs)("div",{className:"absolute right-0 w-full flex flex-col items-center justify-center gap-6",style:{bottom:"".concat(s,"px")},children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+l+"/powered_by.png",alt:"Powered by",width:154*Math.max(1,.75*a),height:20*Math.max(1,.75*a)}),(0,t.jsx)("img",{src:"https://data.x.ai/"+l+"/grok_imagine.png",alt:"Grok Imagine",width:205*a,height:50*a}),n&&(0,t.jsxs)("div",{className:" flex flex-row gap-4 mt-4",children:[(0,t.jsx)(X.Button,{variant:"none",size:"md",shape:"rectangle",className:"bg-transparent opacity-30 border-b-2 border-white rounded-none text-lg","aria-label":"Back",onClick:e=>{null==i||i("https://data.x.ai/"+l+"/xAI_TOS.htm"),e.stopPropagation(),e.preventDefault()},children:"xAI Terms of Service"}),(0,t.jsx)(X.Button,{variant:"none",size:"md",shape:"rectangle",className:"bg-transparent opacity-30 border-b-2 border-white rounded-none text-lg","aria-label":"Back",onClick:e=>{null==i||i("https://data.x.ai/"+l+"/xAI_PP.html"),e.stopPropagation(),e.preventDefault()},children:"xAI Privacy Policy"})]})]})}function st(e){let{backAction:s}=e;return(0,t.jsx)(X.Button,{variant:"none",size:"md",shape:"circle",className:"absolute top-10 left-10 bg-transparent opacity-50","aria-label":"Back",onClick:s,children:(0,t.jsx)($.default,{className:"size-8"})})}function ss(e){let{backAction:s}=e;return(0,t.jsx)(X.Button,{variant:"none",size:"md",shape:"circle",className:"absolute top-10 left-10 bg-transparent opacity-50","aria-label":"Back",onClick:s,children:(0,t.jsx)(tf.X,{className:"size-8"})})}var sa=e.i(19862);e.i(916390);var sn=e.i(626205),si=e.i(920958),sl=e.i(257239),sr=e.i(364778),so=e.i(785239);e.i(298616);var sc=e.i(910503);let sd=(0,to.default)("AlarmClockPlus",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}]]);var su=e.i(31028),sm=e.i(128017),sh=e.i(881261),sp=e.i(229439);e.i(907324);var sf=e.i(76950),sx=e.i(61098);function sg(e){let{children:s,numOfLines:a,...n}=e;return(0,t.jsx)("p",{style:{display:"-webkit-box",WebkitLineClamp:a,WebkitBoxOrient:"vertical",overflow:"hidden"},...n,children:s})}var sv=e.i(984569);function sj(e){let{task:s,onClick:a}=e,n=(0,si.useLogEvent)(),{getScheduleLabel:i}=(0,sl.useTaskLabels)(),r=(0,so.useTasksStore)(eU.prop("setCreateDialogIsOpen")),o=(0,so.useTasksStore)(eU.prop("setTaskToEdit")),c=(0,l.useCallback)(()=>{n("task_preset_clicked",void 0,{location:"task-presets:handleClick"}),r(!0),o(s),null==a||a()},[a,r,o,n,s]),d=(0,sv.getMainScheduleOfTaskDefinition)(s),u=(0,l.useMemo)(()=>{var e,t;if(d)return i(d.cadence,d.timeOfDay,d.ianaTimezone,d.localDayOfWeek,d.localDayOfMonth,null!=(t=null==(e=d.localDayOfYear)?void 0:e.toISODate())?t:void 0)},[i,d]);return(0,t.jsxs)("div",{className:(0,ee.cn)("group grow w-full rounded-2xl p-4 flex flex-col items-start  border cursor-pointer border-border-l1 bg-surface-l1 hover:bg-surface-l2 gap-1",{}),onClick:c,children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(sd,{size:14,className:"text-fg-primary"}),(0,t.jsx)("h1",{className:"font-semibold text-sm",children:s.cta||s.name})]}),(0,t.jsxs)("div",{className:"grow w-full  overflow-hidden",children:[(0,t.jsx)("p",{className:"text-xs font-normal  mb-1",children:u}),(0,t.jsx)(sg,{className:"text-xs text-fg-secondary font-normal",numOfLines:2,children:s.prompt})]})]})}var sy=e.i(768991),sb=e.i(584244);function sw(){let e=(0,sx.useRouter)(),{t:s}=(0,R.useTranslation)("base"),a=(0,si.useLogEvent)(),n=new URLSearchParams({return_to:"".concat(location.pathname).concat(location.search).concat(location.hash)}).toString(),i=(0,l.useCallback)(()=>{a("sign_in_redirect",void 0,{location:"tasks-anon-page"}),e.push("/sign-in".concat(n?"?".concat(n):""))},[a,e,n]),r=(0,l.useCallback)(()=>{a("sign_up_redirect",void 0,{location:"tasks-anon-page"}),e.push("/sign-up".concat(n?"?".concat(n):""))},[a,e,n]);return(0,t.jsxs)("main",{className:"h-full flex flex-col justify-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4 text-center",children:"Unlock Automation with Grok Tasks"}),(0,t.jsxs)("p",{className:"mb-6 text-lg",children:["Discover ",(0,t.jsx)("strong",{children:"Tasks"}),"  your automation tool for scheduling recurring operations with Grok."]}),(0,t.jsx)(sk,{}),(0,t.jsxs)("p",{className:"font-semibold text-center mb-4",children:["Ready to get started? ",(0,t.jsx)("strong",{children:"Log in"})," to your Grok account now and create your first task today! If you don't have an account, signing up is quick and easy."]}),(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,t.jsxs)(eW.Button,{size:"pill",variant:"primary",className:"h-8 px-3 text-sm",onClick:r,children:[(0,t.jsx)(sb.User,{size:16,strokeWidth:2}),(0,t.jsx)("div",{children:s("Sign up","Sign up")})]}),(0,t.jsx)(eW.Button,{size:"pill",variant:"none",className:(0,ee.cn)("hidden @sm:flex","h-8 px-3 text-sm text-primary bg-transparent ring-1 ring-inset ring-toggle-border","hover:bg-button-secondary-hover hover:border-text-secondary"),onClick:i,children:(0,t.jsx)("div",{children:s("Sign in","Sign in")})})]})]})}function sk(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"What You Can Do with Tasks"}),(0,t.jsxs)("ul",{className:"list-disc pl-6 mb-6 space-y-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Create and Schedule"}),": Set up a new task in seconds. Define cron-like schedules and provide prompts to guide Grok's actions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Automated Operations"}),": Grok's LLM, with full internet access, executes your tasks on schedule  processing data, fetching information, and performing actions like sending emails or push notifications."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Customize and Manage"}),": Tailor tasks to your needs, monitor executions, and edit schedules or prompts as required. Keep your automations organized and efficient."]})]}),(0,t.jsx)("p",{className:"mb-6",children:"Tasks are designed to make your Grok experience more automated, productive, and hands-off. Whether you're monitoring updates, sending reminders, or integrating workflows, Tasks handle it seamlessly."})]})}var sN=e.i(114007);function sC(){return(0,ev.useSession)().user?(0,t.jsx)(sS,{}):(0,t.jsxs)("div",{className:"h-dvh w-full relative selection:bg-highlight",children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)("div",{className:"max-w-[50rem] px-2 pt-16 @sm:pt-18 mx-auto w-full flex-col h-full relative items-center",children:(0,t.jsx)(sw,{})}),(0,t.jsx)(e4.CommandMenu,{})]})}function sS(){let{t:e}=(0,R.useTranslation)("tasks"),s=(0,si.useLogEvent)(),a=(0,eh.useMobileSize)(),n=(0,so.useTasksStore)(eU.prop("setSelectedTaskIdForSidePanel")),i=(0,so.useTasksStore)(eU.prop("selectedTaskIdForSidePanel")),r=(0,so.useTasksStore)(eU.prop("setTaskPageTabMode")),o=(0,so.useTasksStore)(eU.prop("setCreateDialogIsOpen")),{route:c,replace:d}=(0,er.useRouting)(),u="tasks"===c.page&&c.taskId||null,m="tasks"===c.page&&c.tab||null;(0,l.useEffect)(()=>{u&&n(u),m&&r("active"===m?sv.TabMode.ACTIVE:sv.TabMode.ARCHIVED),d({page:"tasks",taskId:null,tab:null})},[u,m,n,r,d]);let[h,p]=(0,l.useState)({}),f=(0,so.useTasksStore)(eU.prop("taskPageTabMode")),{taskPresets:x}=(0,sl.useTaskPresets)(),g=(0,so.useTasksStore)(eU.prop("userActiveTasks")),v=(0,so.useTasksStore)(eU.prop("userInactiveTasks")),j=(0,so.useTasksStore)(eU.prop("initialized")),y=(0,l.useCallback)((e,t)=>{p(s=>({...s,[e]:t}))},[p]);(0,l.useEffect)(()=>{let t=e("tasks-page-document-title","Tasks");document.title="".concat(t," - Grok")},[e]),(0,sn.useDocumentTitle)(e("tasks-page-document-title","Tasks")),(0,l.useEffect)(()=>{s("opened_tasks_page",void 0,{location:"tasks-page:useEffect"})},[s]);let b=!!(0,ev.useSession)().user,w=(0,l.useRef)(null),[k,N]=(0,l.useState)(!0),[C,S]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{if(w.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=w.current;0===e?N(!0):N(!1),e+s>=t-5?S(!0):S(!1)}},t=w.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[w]);let I=(0,l.useCallback)(()=>{s("clicked_add_new_task",void 0,{location:"tasks-page"}),o(!0)},[o,s]),T=(0,l.useMemo)(()=>{if(f===sv.TabMode.ACTIVE){var e;return e=g.filter(e=>{var t;return null==(t=e.task)?void 0:t.isActive}),e.sort((e,t)=>{var s,a,n,i;let l=h[null!=(n=null==(s=e.task)?void 0:s.taskId)?n:""],r=h[null!=(i=null==(a=t.task)?void 0:a.taskId)?i:""];return l&&r?sf.DateTime.fromISO(r).diff(sf.DateTime.fromISO(l)).toMillis():l?-1:1*!!r})}return f===sv.TabMode.ARCHIVED?v.filter(e=>{var t;return!(null==(t=e.task)?void 0:t.isActive)}):[]},[f,g,h,v]),M=(0,l.useMemo)(()=>x.sort(()=>Math.random()-.5).slice(0,2),[x]);if(!b)return(0,sx.redirect)("/");let P=f===sv.TabMode.ACTIVE&&T.length<=3;return(0,t.jsxs)("div",{className:(0,ee.cn)("h-dvh w-full relative selection:bg-highlight",{"overflow-y-auto":a}),children:[!i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{})]}),(0,t.jsxs)("div",{className:(0,ee.cn)("max-w-[50rem] px-5 pt-16 @sm:pt-18 mx-auto w-full flex flex-col h-full items-center pb-4","transition-all duration-300 spring"),style:C?{}:{maskImage:Y.BOTTOM_MASK_IMAGE,WebkitMaskImage:Y.BOTTOM_MASK_IMAGE},children:[(0,t.jsx)("div",{className:"flex justify-between align-center min-h-[42px] w-full",children:(0,t.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 group",children:(0,t.jsx)("h1",{className:"text-2xl flex gap-2 items-center font-semibold",children:e("tasks.page-title","Tasks")})}),(0,t.jsxs)(X.Button,{variant:"secondary",shape:"rectangle",onClick:I,size:"md","aria-label":e("tasks.create-task","Create task"),children:[(0,t.jsx)(sp.Plus,{size:16}),a?null:(0,t.jsx)("span",{children:e("tasks.create-task","Create task")})]})]})}),j?(0,t.jsxs)("div",{className:"pt-6 w-full overflow-auto relative no-scrollbar",style:k?{}:{maskImage:Y.TOP_MASK_IMAGE,WebkitMaskImage:Y.TOP_MASK_IMAGE},ref:w,children:[0===T.length&&f===sv.TabMode.ACTIVE&&(0,t.jsx)(sM,{onClick:I}),0===T.length&&f===sv.TabMode.ARCHIVED&&(0,t.jsx)(sP,{}),(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-col gap-4 pb-4 w-full "),children:[T.length>0&&T.filter(e=>!!e.task).map(e=>{if(e.task){var s;return(0,t.jsx)(sI,{task:e,updateTaskIdIsUnread:y},null==(s=e.task)?void 0:s.taskId)}}),P?(0,t.jsx)("div",{className:(0,ee.cn)("pt-4 flex items-center pb-20",{"flex-col pb-8":a}),children:(0,t.jsx)("div",{className:(0,ee.cn)("flex w-full gap-4",{"flex-col":a}),children:M.map((e,s)=>(0,t.jsx)(sj,{task:e},s))})}):null]})]}):(0,t.jsx)("div",{className:"grow shrink self-stretch flex items-center justify-center",children:(0,t.jsx)(t5.Spinner,{size:"sm"})})]})]})}function sI(e){var s,a,n,i,r,o,c,d,u;let{task:m,updateTaskIdIsUnread:h}=e,{t:p}=(0,R.useTranslation)("tasks"),f=(0,si.useLogEvent)(),{resolvedTheme:x}=(0,es.useTheme)(),g=(0,eh.useMobileSize)(),v=(0,so.useTasksStore)(eU.prop("selectedTaskIdForSidePanel")),j=(0,so.useTasksStore)(eU.prop("setSelectedTaskIdForSidePanel")),y=v===(null==(s=m.task)?void 0:s.taskId),[b,w]=(0,l.useState)(!1),k=(0,l.useCallback)(()=>{w(!0)},[w]),N=(0,l.useCallback)(()=>{w(!1)},[w]),C=(0,l.useCallback)(()=>{var e;if(f("clicked_tasks_card",void 0,{location:"tasks-page:handleClick"}),y)return j(void 0);j(null==(e=m.task)?void 0:e.taskId)},[y,j,f,null==(a=m.task)?void 0:a.taskId]),S=null==(n=m.schedules)?void 0:n.at(0),{data:I}=(0,sc.useQuery)({queryKey:["latest-task-result",null==(i=m.task)?void 0:i.taskId],queryFn:async()=>{var e;if(!(null==(e=m.task)?void 0:e.taskId))throw Error("TaskId is required");return sr.grokTasksApi.grokTasksGetTaskResults({taskId:m.task.taskId,limit:1})},enabled:!!(null==(r=m.task)?void 0:r.taskId),staleTime:0,refetchOnMount:"always"}),T=null==I||null==(o=I.results)?void 0:o.at(0),M=!(null==(c=m.task)?void 0:c.isActive),P=!!(T&&!M),E=null==T?void 0:T.createTime;(0,l.useEffect)(()=>{var e,t;h(null!=(t=null==(e=m.task)?void 0:e.taskId)?t:"",E)},[h,null==(d=m.task)?void 0:d.taskId,E]);let z=!!((null==(u=m.task)?void 0:u.isActive)&&(null==S?void 0:S.isEnabled)),D=(0,so.useTasksStore)(eU.prop("setTaskToEdit")),{pauseOrUnpauseTaskSchedule:A}=(0,sl.useTaskActions)(),L=(0,l.useCallback)(e=>{e.stopPropagation(),f("edit_task_clicked",void 0,{location:"tasks-side-panel:handleEditClick"}),D((0,sv.apiTaskWithScheduleToTaskDefinition)(m))},[D,m,f]),F=(0,l.useCallback)(e=>{e.stopPropagation(),f("pause_task_clicked",void 0,{location:"tasks-side-panel:handlePauseClick"}),A({enabled:!1,scheduleId:null==S?void 0:S.scheduleId})},[A,S,f]),_=(0,l.useCallback)(e=>{e.stopPropagation(),f("resume_task_clicked",void 0,{location:"tasks-side-panel:handleUnpauseClick"}),A({enabled:!0,scheduleId:null==S?void 0:S.scheduleId})},[A,S,f]);return m.task&&S?(0,t.jsxs)("div",{className:(0,ee.cn)("w-full flex flex-col py-0 rounded-3xl border bg-surface-l1 hover:bg-surface-l2 cursor-pointer  relative",{"hover:bg-surface-base":"light"===x},{"bg-surface-l2 hover:bg-surface-l3":y},{"py-1":!(P&&T)},{"bg-surface-inset hover:bg-button-ghost-hover":y&&"light"===x}),onMouseEnter:k,onMouseLeave:N,onClick:C,children:[(0,t.jsxs)("div",{className:"flex flex-col px-5 py-3 gap-0.5",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)("h1",{className:(0,ee.cn)("text-sm font-semibold line-clamp-1",{"text-xs":g}),children:m.task.name&&m.task.name.length>0?m.task.name:"Task"}),!g&&(0,t.jsx)("div",{children:b?(0,t.jsxs)("div",{className:"flex flow-row m-0 p-0 h-4 -mt-4 -mr-2 gap-x-1",children:[(0,t.jsx)(X.Button,{variant:"secondary",size:"sm",shape:"rectangle",onClick:L,"aria-label":p("tasks-result.edit-label","Edit"),children:(0,t.jsx)(sh.Pencil,{size:12})}),z||M?(0,t.jsx)(X.Button,{variant:"secondary",size:"sm",shape:"rectangle",onClick:F,"aria-label":p("tasks-result.pause-label","Pause"),children:(0,t.jsx)(tS.Pause,{size:14})}):(0,t.jsx)(X.Button,{variant:"secondary",size:"sm",shape:"rectangle",onClick:_,"aria-label":p("tasks-result.resume-label","Resume"),children:(0,t.jsx)(ey.Play,{size:14})})]}):(0,t.jsx)(sy.CombinedTaskTriggerLabel,{task:S,isScheduled:z,iconPosition:"right"})})]}),g&&(0,t.jsx)(sy.CombinedTaskTriggerLabel,{task:S,isScheduled:z})]}),(0,t.jsx)(t1.AnimatePresence,{children:!g&&P&&T&&(0,t.jsx)("div",{className:"border-t-[0.5px]",children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(sT,{taskResult:T})})})})]}):null}function sT(e){var s;let{taskResult:a}=e,{t:n}=(0,R.useTranslation)("tasks"),i=(0,eh.useMobileSize)(),r=(0,l.useMemo)(()=>{var e;if(!a.createTime)return null;let t=sf.DateTime.fromISO(a.createTime),s=sf.DateTime.now();return null!=(e=t.toRelative({base:s}))?e:n("just-now","Just now")},[n,a.createTime]);return(0,t.jsxs)("div",{className:"flex-nowrap px-5 pb-3 pt-2 flex items-center justify-between w-full text-sm h-full gap-0.5",children:[(0,t.jsxs)("div",{className:(0,ee.cn)("flex items-center gap-1.5",{"justify-between w-full":i}),children:[!i&&(0,t.jsx)(sm.MessageCircle,{size:14,className:"text-fg-secondary "}),(0,t.jsx)("p",{className:"text-fg-secondary line-clamp-1",children:null!=(s=a.title)?s:n("new-task-result-label","New task result")}),i&&(0,t.jsx)(tE.NotificationBlip,{variant:"sm"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-fg-secondary",children:[(0,t.jsx)("p",{className:(0,ee.cn)("line-clamp-1",{"text-xs":i}),children:r}),!a.isRead&&(0,t.jsx)("div",{className:"w-[14px] h-full flex items-center justify-center",children:!i&&(0,t.jsx)(tE.NotificationBlip,{variant:"sm"})})]})]})}let sM=e=>{let{onClick:s}=e,{t:a}=(0,R.useTranslation)("tasks");return(0,t.jsxs)(sN.Card,{variant:"ghost",className:"p-4 sm:p-6 gap-4 flex flex-col justify-center items-center",children:[(0,t.jsx)("div",{className:"bg-surface-l1 rounded-full p-2 flex items-center justify-center",children:(0,t.jsx)(sd,{size:24,className:"text-fg-secondary"})}),(0,t.jsxs)("div",{className:"text-sm flex flex-col gap-1 items-center justify-center max-w-sm text-center",children:[(0,t.jsxs)("h1",{className:"font-semibold",children:[a("no-tasks-banner.title","Get started by adding a task")," "]}),(0,t.jsx)("p",{className:"text-fg-secondary",children:a("no-tasks-banner.subtitle","Schedule a task to automate actions and get reminders when they complete.")})]}),(0,t.jsxs)(X.Button,{variant:"secondary",size:"sm",shape:"rectangle",onClick:s,children:[(0,t.jsx)(sp.Plus,{size:20}),a("task-starter.new-task","New task")]})]})},sP=()=>{let{t:e}=(0,R.useTranslation)("tasks");return(0,t.jsxs)("div",{className:"w-full py-8 border rounded-xl flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center rounded-full bg-surface-l1 p-4",children:(0,t.jsx)(su.Archive,{size:20})}),(0,t.jsxs)("div",{className:"flex flex-col items-center w-full gap-2 text-lg font-semibold",children:[(0,t.jsx)("h1",{children:e("no-archived-tasks-banner.title","No archived tasks")}),(0,t.jsx)("p",{className:"text-xs font-normal text-fg-secondary text-center leading-1",children:e("no-archived=tasks-banner.subtitle","Archived tasks will show up here")})]})]})};var sE=e.i(432517),sz=e.i(412920),sD=e.i(290768);e.i(881081);var sR=e.i(727151),sA=e.i(713087),sL=e.i(376493),sF=e.i(218946),s_=e.i(136783),sB=e.i(111669),sG=e.i(969286);let sW="soft-deleted-conversations",sU=e=>{var s;let{conversation:a,restore:n,forceDelete:i}=e,{t:l}=(0,R.useTranslation)("base");return(0,t.jsxs)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-between items-center p-2 border rounded-xl bg-card",children:[(0,t.jsx)("span",{className:"truncate",children:null!=(s=a.title)?s:a.conversationId}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(eW.Button,{onClick:()=>a.conversationId&&n(a.conversationId),variant:"outline",children:l("deleted-conversations.restore","Restore")}),(0,t.jsx)(eW.Button,{onClick:()=>a.conversationId&&i(a.conversationId),variant:"destructive",children:l("deleted-conversations.force-delete","Force Delete")})]})]})};function sO(){let{t:e}=(0,R.useTranslation)("base"),{user:s}=(0,ev.useSession)(),{conversations:a,isLoading:n,error:i,refetch:l,loadMoreRef:r,historyContainerRef:o}=(()=>{let{data:e,fetchNextPage:t,hasNextPage:s,isFetchingNextPage:a,isLoading:n,error:i,refetch:l}=(0,sB.useInfiniteQuery)({queryKey:[sW],queryFn:async e=>{let{pageParam:t}=e;return await sr.chatApi.chatListSoftDeletedConversations({pageSize:"100",pageToken:t})},getNextPageParam:e=>e.nextPageToken||void 0,initialPageParam:void 0,staleTime:0}),r=(null==e?void 0:e.pages.flatMap(e=>e.conversations||[]))||[],{loadMoreRef:o,historyContainerRef:c}=(0,sL.useInfiniteScrollRefs)({hasNextPage:s,isFetchingNextPage:a,isLoading:n,fetchNextPage:()=>{t().catch(e=>(0,D.logError)("soft-deleted-conversations-load-more",e))}});return{conversations:r,isLoading:n,error:i,loadMoreRef:o,historyContainerRef:c,refetch:l}})(),{restoreConversation:c}=(()=>{let{t:e}=(0,R.useTranslation)(),s=(0,sR.getQueryClient)(),a=(0,sF.useRequestErrorToastFn)(),n=(0,si.useLogEvent)(),{routeToConversation:i}=(0,sA.useGrokRouter)(),l=(0,s_.useConversationStore)(eU.prop("fetchGetConversation")),{mutate:r,isPending:o}=(0,sG.useMutation)({mutationFn:async e=>{n("restore-conversation",void 0,{location:"restore-conversation:mutate",conversationId:e}),await sr.chatApi.chatRestoreSoftDeletedConversation({body:{conversationId:e}})},onError:t=>{a("restore-conversation",t,e("deleted-conversations.restore.error","Failed to restore conversation")),(0,D.logError)("restore-conversation",t)},onSuccess:(a,r)=>{s.invalidateQueries({queryKey:[sW]}),l(r).then(()=>{eB.toast.success(e("deleted-conversations.restore.success","Successfully restored conversation"),{action:(0,t.jsx)(eW.Button,{variant:"filledSecondary",size:"sm",onClick:()=>{i(r),n("view-restored-conversation",void 0,{location:"restore-conversation:onSuccess",conversationId:r})},children:e("deleted-conversations.restore.view","View")})})}).catch(e=>{(0,D.logError)("restore-conversation",e)})}});return{restoreConversation:r,isPending:o}})(),{forceDeleteConversation:d}=(()=>{let{t:e}=(0,R.useTranslation)(),t=(0,sR.getQueryClient)(),s=(0,sF.useRequestErrorToastFn)(),a=(0,si.useLogEvent)(),n=(0,s_.useConversationStore)(eU.prop("fetchForceDeleteConversation")),{mutate:i,isPending:l}=(0,sG.useMutation)({mutationFn:async e=>{await n(e),a("force-delete-conversation",void 0,{location:"force-delete-conversation:mutate",conversationId:e})},onError:t=>{s("force-delete-conversation",t,e("deleted-conversations.force-delete.error","Failed to force delete conversation")),(0,D.logError)("force-delete-conversation",t)},onSuccess:()=>{t.invalidateQueries({queryKey:[sW]})}});return{forceDeleteConversation:i,isPending:l}})();return s?(0,t.jsxs)("main",{className:(0,ee.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{}),(0,t.jsxs)("div",{className:"max-w-[50rem] px-5 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:o,children:[(0,t.jsx)("h1",{className:"text-2xl flex gap-2 items-center",children:e("deleted-conversations.title","Deleted Conversations")}),(0,t.jsx)("div",{className:"flex flex-col w-full items-start text-xs text-muted-foreground pb-4",children:e("deleted-conversations.description","Conversations marked for deletion will be permanently deleted after 30 days.")}),(0,t.jsx)(sz.FadeScrollContainer,{children:(0,t.jsxs)(t1.AnimatePresence,{children:[null==a?void 0:a.map(e=>(0,t.jsx)(sU,{conversation:e,restore:c,forceDelete:d},e.conversationId)),(null==a?void 0:a.length)===0&&!n&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:e("deleted-conversations.no-conversations-found","No deleted conversations found")})},"no-conversations-found"),n&&(0,t.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(sD.Loader2,{className:"animate-spin"})})})},"deleted-conversations-loading"),i&&(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,t.jsx)("div",{className:"text-center",children:e("deleted-conversations.error.description","There was an issue loading your deleted conversations")}),(0,t.jsx)(eW.Button,{variant:"filledSecondary",onClick:()=>l(),children:e("Retry","Retry")})]},"deleted-conversations-error"),(0,t.jsx)("div",{ref:r})]})})]})]}):(0,t.jsx)("main",{className:(0,ee.cn)("w-screen h-dvh relative"),children:(0,t.jsx)(sE.ErrorCard,{title:e("deleted-conversations.error.title","Error"),description:e("deleted-conversations.error.anonymous-user","You must be logged in to access this page"),cta:e("deleted-conversation-page.cta","Return home")})})}var sq=e.i(878191),sV=e.i(519837),sH=e.i(779886),sK=e.i(258722);let sQ=e=>{let{anchor:s,children:a}=e;return(0,t.jsx)(er.Link,{route:{page:"faq",anchor:s},onClick:()=>{(0,D.logEventGlobal)("faq_item_click",s,{location:"faq_page"})},children:(0,t.jsx)(eW.Button,{variant:"ghost",size:"lg","aria-label":"View answer",className:"my-1",asChild:!0,children:(0,t.jsxs)("div",{className:"flex justify-between w-full items-center",id:s,children:[(0,t.jsx)("span",{className:"text-lg overflow-hidden text-ellipsis",children:a}),(0,t.jsx)(sq.ChevronRightIcon,{className:"w-4 h-4"})]})})})},sY=(0,l.memo)(function(){var e,s,a;let n=(0,sK.useRoutingStore)(e=>e.route),i="faq"===n.page?n:(0,ty.never)("only for /faq"),r=(0,sV.useSettingsDialogStore)(e=>e.setTab),o=(0,sV.useSettingsDialogStore)(e=>e.toggleOpen),{SUPPORT_URL:c}=(0,ec.useEnvironment)(),d=(0,l.useCallback)(e=>{e.preventDefault(),o(),r("personality")},[o,r]),u=(0,l.useMemo)(()=>(e=>{let{handlePersonalityClick:s}=e;return{"what-is-grok":{anchor:"what-is-grok",question:"What is Grok?",answer:(0,t.jsx)("p",{children:"Grok is a conversational generative AI powered by xAI's state-of-the-art Large Language Models. It's built to assist with a wide range of tasks while being helpful, entertaining, and truthful. Grok aims to answer questions about the universe, help with deep work, and provide real-time insights, all with a touch of humor and personality."})},"key-features":{anchor:"key-features",question:"What are Grok's key features?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Grok offers a variety of powerful features, including:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Natural Language Processing and Question Answering"}),": Handles text and voice queries for accurate, context-aware responses."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Real-Time Search and Information Retrieval"}),": Searches public X posts (formerly Twitter) and the web in real-time for up-to-date information."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Creative Writing and Content Generation"}),": Assists with writing stories, articles, or other creative content."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Image Generation and Editing"}),": Creates and edits images based on your descriptions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Image and Video Understanding"}),": Analyzes uploaded images or videos to provide insights or descriptions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Coding Assistance"}),": Helps write, debug, and explain code."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Document Analysis"}),": Upload documents for summarization, analysis, or extraction of key information."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Personas and Customization"}),": Choose fun personas (e.g., witty, unhinged, or role-playing like a wizard) to customize Grok's tone and style."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Native Tool Use"}),": Integrates tools like code interpreters and internet access to query missing context and adjust responses dynamically."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Multilingual Capabilities"}),": Supports multiple languages with high precision."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Private Chat Mode"}),": Activate for conversations that aren't saved long-term, ensuring privacy for sensitive discussions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Conversation History"}),": View and manage past chats for continuity."]})]}),(0,t.jsx)("p",{children:'Grok stands out for its real-time capabilities, reasoning agents, and focus on being a "trusted assistant for deep work."'})]})},models:{anchor:"models",question:"What models power Grok, and what are their features?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Grok is powered by advanced models from xAI, each with unique strengths:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 4"}),": The most intelligent model in the world, featuring native tool use, real-time search integration, and superior reasoning."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 4 Heavy"}),": The most powerful version of Grok 4, offering enhanced performance and higher rate limits. Accessible through the SuperGrok Heavy subscription tier."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 3"}),": Fast model that combines reasoning with extensive pretraining knowledge. It includes code interpreters, internet access, and the ability to dynamically adjust approaches for complex tasks."]})]})]})},"creative-tasks":{anchor:"creative-tasks",question:"Can Grok handle creative or specialized tasks?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Yes! Grok excels at:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(er.Link,{route:{page:"files"},children:"Generating rich documents, stories, or reports"}),"."]}),(0,t.jsx)("li",{children:"Writing and debugging code in various languages."}),(0,t.jsxs)("li",{children:[(0,t.jsx)(er.Link,{route:{page:"files",emptyView:"image"},children:'Creating/editing images (e.g., via prompts like "generate a cosmic landscape")'}),"."]}),(0,t.jsx)("li",{children:"Analyzing images for descriptions, insights, or edits."}),(0,t.jsx)("li",{children:'Role-playing or adopting personas for fun interactions (e.g., "Respond as a pirate captain").'})]})]})},"real-time-search":{anchor:"real-time-search",question:"Does Grok have real-time search and how does it work?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Yes, Grok has the most advanced real-time search capabilities. It can:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Search public X posts for the latest discussions."}),(0,t.jsx)("li",{children:"Perform web searches for current information."}),(0,t.jsx)("li",{children:"Integrate results into responses for up-to-date, accurate answers."})]}),(0,t.jsx)("p",{children:"This is powered by models like Grok 4, ensuring responses are timely and relevant."})]})},"customize-responses":{anchor:"customize-responses",question:"Can I customize Grok's responses?",answer:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("p",{children:["Absolutely. You can choose one of predefined styles or write your own instructions in"," ",(0,t.jsx)("a",{onClick:s,className:"cursor-pointer",children:"settings"}),"."]})})},"mistakes-inaccuracies":{anchor:"mistakes-inaccuracies",question:"How does Grok handle mistakes or inaccuracies?",answer:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("p",{children:'Like all AIs, Grok may occasionally "hallucinate" or provide incorrect info based on its training data. It encourages users to verify facts, and you can provide feedback to help improve it. Grok\'s design prioritizes truthfulness to minimize this.'})})},"share-links":{anchor:"share-links",question:"How do shared links work?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-yellow-100/10 dark:bg-yellow-900/10 border border-yellow-200/50 dark:border-yellow-800/50 rounded-lg px-4 py-2 mb-4 flex flex-row items-center gap-3",children:[(0,t.jsx)(eO.AlertTriangle,{className:"text-yellow-200 dark:text-yellow-100 size-5"}),(0,t.jsx)("p",{className:"font-semibold",children:"Shared links can be viewed by anyone with the link."})]}),(0,t.jsx)("h4",{children:"Can I share my Grok conversations?"}),(0,t.jsx)("p",{children:"Yes, you control what you choose to share. You can share your Grok conversations with others:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:'On grok.com by clicking "Share" in the top right corner of your browser or the share icon below your conversation to create and copy a share link'}),(0,t.jsx)("li",{children:"On the Grok Apps by tapping the share icon under your conversation to create a share link"})]}),(0,t.jsx)("p",{children:"From there, you also control where you share your Grok conversation."}),(0,t.jsx)("h4",{children:"What happens when you share"}),(0,t.jsx)("p",{children:"When you create a share link, anyone with the link can view your entire conversationincluding messages, uploads, and generated content. No Grok account required."}),(0,t.jsx)("p",{children:"Note: Any share link you generate will be accessible to anyone you choose to share the link with. For example, if you share the link publicly on a social media platform, it may be subject to indexing by a search engine (e.g., Google) just like any other publicly shared content."}),(0,t.jsx)("h4",{children:"Can I revoke access to my shared Grok conversations?"}),(0,t.jsx)("p",{children:"Yes, you control what you share and how long it is shared. You can revoke access to any or all of your Grok conversation shared links by:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:["Logging into grok.com, navigating to"," ",(0,t.jsx)(er.Link,{route:{page:"share-links"},children:"grok.com/share-links"}),', and clicking "Remove" next to the share link you no longer wish to share']}),(0,t.jsx)("li",{children:"Using the menu in your chat"}),(0,t.jsx)("li",{children:"Clicking Unshare on the shared conversation page"})]}),(0,t.jsx)("h4",{children:"Before you share"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Review your entire conversation"}),(0,t.jsx)("li",{children:"Remove any personal or sensitive information"}),(0,t.jsx)("li",{children:"Remember that recipients can save or download content"})]}),(0,t.jsx)("p",{className:"mt-4",children:"Tip: Use Private Chat Mode for sensitive conversations that shouldn't be shared."})]})},"linking-accounts":{anchor:"linking-accounts",question:"Why can't I access my subscription on all my devices?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"If you're unable to access your subscription on certain devices, this usually happens when you log in using different authentication methods across devices."}),(0,t.jsx)("p",{children:"Even if you use the same email address, different authentication methods (like Google, Apple, or email/password) create separate accounts that aren't automatically connected."}),(0,t.jsxs)("p",{children:["To resolve this, you'll need to manage your accounts at"," ",(0,t.jsx)("a",{href:"https://accounts.x.ai",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 underline",children:"accounts.x.ai"}),". Since different authentication methods create separate accounts, you'll need to delete the duplicate accounts and keep only your primary one with your subscription."]}),(0,t.jsxs)("div",{className:"bg-blue-100/10 dark:bg-blue-900/10 border border-blue-200/50 dark:border-blue-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-blue-200 dark:text-blue-100 mb-2",children:" Account Management Steps:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,t.jsxs)("li",{children:["Visit ",(0,t.jsx)("strong",{children:"accounts.x.ai"})," with any duplicate accounts created by different authentication methods."]}),(0,t.jsx)("li",{children:"Delete the duplicate accounts."}),(0,t.jsx)("li",{children:"Log in with your primary account (the one with your subscription)."}),(0,t.jsx)("li",{children:"Navigate to account settings."}),(0,t.jsx)("li",{children:"Connect additional authentication methods to your primary account."}),(0,t.jsx)("li",{children:"Verify that you can access your subscription on all your devices."})]})]}),(0,t.jsxs)("div",{className:"bg-yellow-100/10 dark:bg-yellow-900/10 border border-yellow-200/50 dark:border-yellow-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-200 dark:text-yellow-100 mb-2",children:" Important Note:"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("strong",{children:"Do not delete your primary account with the subscription."})," Only delete the duplicate accounts created when logging in with different authentication methods (Google, Apple, email/password, etc.) using the same email address."]})]}),(0,t.jsxs)("div",{className:"bg-blue-100/10 dark:bg-blue-900/10 border border-blue-200/50 dark:border-blue-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-blue-200 dark:text-blue-100 mb-2",children:" Note:"}),(0,t.jsx)("p",{className:"text-sm",children:"SuperGrok subscriptions do not apply to Grok in X. If you have a SuperGrok subscription, it will only work on grok.com and the Grok mobile apps, not within the X platform."})]})]})}}})({handlePersonalityClick:d}),[d]);return(0,t.jsxs)("div",{className:"h-dvh flex-1 overflow-auto relative",children:[(0,t.jsx)("div",{className:"sm:hidden mt-2",children:(0,t.jsx)(e5.TopLeftButton,{shared:!1})}),(0,t.jsx)("div",{className:"prose pb-8 px-4 mt-8 mx-auto pt-2 sm:pt-8",children:i.anchor&&u[i.anchor]?(0,t.jsxs)("section",{children:[(0,t.jsx)("nav",{"aria-label":"Breadcrumb",children:(0,t.jsxs)("ol",{className:"flex items-center m-0 p-0 gap-4",children:[(0,t.jsx)("li",{className:"flex items-center list-none",children:(0,t.jsx)(er.Link,{route:{page:"faq",anchor:null},children:(0,t.jsx)(eW.Button,{variant:"link","aria-label":"FAQ",className:"text-muted-foreground p-0",asChild:!0,children:(0,t.jsx)("span",{children:"FAQ"})})})}),(0,t.jsx)("span",{className:"text-muted-foreground",children:(0,t.jsx)(sq.ChevronRightIcon,{className:"w-4 h-4"})}),(0,t.jsx)("li",{className:"list-none m-0 p-0",children:(0,t.jsx)("span",{className:"text-muted-foreground",id:i.anchor,children:null==(e=u[i.anchor])?void 0:e.question})})]})}),(0,t.jsxs)("header",{className:"flex flex-col my-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:null==(s=u[i.anchor])?void 0:s.question}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Updated on Sept 15, 2025"})]}),(0,t.jsx)(sH.Separator,{className:"my-8"}),(0,t.jsx)("div",{children:null==(a=u[i.anchor])?void 0:a.answer})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{children:[(0,t.jsx)(er.Link,{route:{page:"faq",anchor:null},children:(0,t.jsx)("h1",{children:"Grok Web FAQ"})}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-8",children:"Updated on Sept 15, 2025"})]}),(0,t.jsxs)("main",{children:[(0,t.jsxs)("p",{children:["Welcome to the Grok Web FAQ page! Grok is designed to be a helpful, witty, and maximally truthful assistant, inspired by the Hitchhiker's Guide to the Galaxy and JARVIS from Iron Man. This FAQ focuses on Grok's Web features, capabilities, and how to make the most of them. For legal terms, privacy, or account issues, visit"," ",(0,t.jsx)("a",{href:"https://x.ai/legal",target:"_blank",rel:"noreferrer noopener",children:"x.ai/legal"}),"."]}),(0,t.jsxs)("p",{children:["If your question isn't covered here, feel free to"," ",(0,t.jsx)(er.Link,{route:{page:"main"},children:"ask Grok directly"})," or visit our"," ",(0,t.jsx)("a",{href:c,target:"_blank",rel:"noreferrer noopener",children:"community forum"}),"."]}),(0,t.jsx)(sH.Separator,{className:"my-8"}),Object.values(u).map((e,s)=>{let{anchor:a,question:n}=e;return(0,t.jsx)(sQ,{anchor:a,children:n},s)}),(0,t.jsx)(sH.Separator,{className:"my-8"}),(0,t.jsxs)("p",{children:["If you have more questions,"," ",(0,t.jsx)(er.Link,{route:{page:"main"},children:"chat with Grok now! "})]})]})]})})]})}),sX=e=>e.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric",timeZone:"UTC"}),s$=(0,l.memo)(function(e){let{changeLogEntries:s}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{children:[(0,t.jsx)(er.Link,{route:{page:"changelog",anchor:null},children:(0,t.jsx)("h1",{children:"Grok Changelog"})}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-8",children:"Latest updates for Grok Web"})]}),(0,t.jsxs)("main",{children:[(0,t.jsx)("p",{children:"See what's new in Grok. Here you'll find information about all the latest updates, new features, improvements, and bug fixes."}),(0,t.jsx)(sH.Separator,{className:"my-8"}),s.map((e,a)=>(0,t.jsxs)("div",{children:[(0,t.jsx)(sJ,{entry:e}),a!==s.length-1&&(0,t.jsx)(sH.Separator,{className:"my-8"})]},e.anchor)),(0,t.jsx)(sH.Separator,{className:"my-8"}),(0,t.jsxs)("p",{children:["Want to see what Grok can do with the latest features?"," ",(0,t.jsx)(er.Link,{route:{page:"main"},children:"Start a conversation now!"})]})]})]})}),sZ=(0,l.memo)(function(e){let{entry:s}=e;return(0,t.jsxs)("section",{children:[(0,t.jsx)("nav",{"aria-label":"Breadcrumb",children:(0,t.jsxs)("ol",{className:"flex items-center m-0 p-0 gap-4",children:[(0,t.jsx)("li",{className:"flex items-center list-none",children:(0,t.jsx)(er.Link,{route:{page:"changelog",anchor:null},children:(0,t.jsx)(eW.Button,{variant:"link","aria-label":"Changelog",className:"text-muted-foreground p-0",asChild:!0,children:(0,t.jsx)("span",{children:"Changelog"})})})}),(0,t.jsx)("span",{className:"text-muted-foreground",children:(0,t.jsx)(sq.ChevronRightIcon,{className:"w-4 h-4"})})]})}),(0,t.jsx)("header",{className:"flex flex-col my-4",children:(0,t.jsx)("h1",{className:"text-2xl font-bold",children:sX(s.date)})}),(0,t.jsx)(sH.Separator,{className:"my-8"}),(0,t.jsx)("div",{children:s.content})]})}),sJ=(0,l.memo)(function(e){let{entry:s}=e;return(0,t.jsx)(er.Link,{route:{page:"changelog",anchor:s.anchor},className:"text-primary hover:text-primary",children:(0,t.jsx)("div",{className:"flex justify-between w-full items-center",id:s.anchor,children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-4",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground w-32",children:sX(s.date)}),(0,t.jsx)("div",{className:"flex flex-col items-start gap-4",children:(0,t.jsx)("div",{className:"flex flex-col prose",children:s.content})})]})})})}),s0=(0,l.memo)(function(){let e=(0,sK.useRoutingStore)(e=>e.route),s="changelog"===e.page?e:(0,ty.never)("only for /changelog"),a=(0,l.useMemo)(()=>[{anchor:"sep-05-2025",date:new Date("2025-09-05"),content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:"New Features"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Calculator, unit conversion tools"}),(0,t.jsx)("li",{children:"Improved typeaheads"}),(0,t.jsx)("li",{children:"Improved code highlighting, performance, and styles"}),(0,t.jsx)("li",{children:"Tool calling for fast mode"}),(0,t.jsx)("li",{children:"Generate Imagine videos from chat generated images"}),(0,t.jsx)("li",{children:"Imagine audio mute preference persistence"}),(0,t.jsx)("li",{children:"Faster video loading for generated videos"}),(0,t.jsx)("li",{children:"Textbox option for chat surveys"}),(0,t.jsx)("li",{children:"Ctrl + Shift + M to switch model mode"})]}),(0,t.jsx)("h4",{children:"Bug Fixes"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:'Fix "Export to PDF" black background'}),(0,t.jsx)("li",{children:"Fix web results not showing in voice mode"}),(0,t.jsx)("li",{children:"Fix double Finished Thinking notification"}),(0,t.jsx)("li",{children:"Fix text direction in side panel and typeaheads for RTL languages"})]})]})},{anchor:"aug-29-2025",date:new Date("2025-08-29"),content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:"New Features"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Imagine"}),(0,t.jsx)("li",{children:"Grok 4 for anonymous users"}),(0,t.jsx)("li",{children:"Improved typeaheads"}),(0,t.jsx)("li",{children:"Cleaned up citation rendering"}),(0,t.jsx)("li",{children:"Better search results"})]}),(0,t.jsx)("h4",{children:"Bug Fixes"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"General chat stability under bad network conditions"}),(0,t.jsx)("li",{children:"Fixed bugs with creating new chats from shared links"})]})]})}],[]),n=(0,l.useMemo)(()=>a.find(e=>e.anchor===s.anchor),[a,s.anchor]);return(0,t.jsxs)("div",{className:"h-dvh flex-1 overflow-auto relative",children:[(0,t.jsx)("div",{className:"sm:hidden mt-2",children:(0,t.jsx)(e5.TopLeftButton,{shared:!1})}),(0,t.jsx)("div",{className:"prose pb-8 px-4 mt-8 mx-auto pt-2 sm:pt-8",children:s.anchor&&n?(0,t.jsx)(sZ,{entry:n}):(0,t.jsx)(s$,{changeLogEntries:a})})]})});var s1=e.i(877253),s2=e.i(284210),s5=e.i(9885),s4=e.i(974659),s3=e.i(913494),s8=e.i(945711);let s6=(0,l.memo)(e=>{let{asset:s,isFileSelected:n}=e,{t:i}=(0,R.useTranslation)(),r=(0,si.useLogEvent)(),o=(0,a.useChatPageStore)(eU.prop("setSidePanelContent")),[c,d]=(0,l.useState)(!1),u=(0,s3.useFilesPageStore)(e=>e.deleteAsset),m=(0,l.useCallback)(()=>{if(n)return void o(void 0);o({type:"asset",data:(0,s2.convertAssetMetadataToFileMetadata)(s),hideEdit:!0})},[s,n,o]),h=(0,l.useCallback)(e=>{var t,a;e.stopPropagation(),u(s.assetId),r("delete_asset","asset_row",{location:"asset-row",assetId:s.assetId,assetName:s.name,assetSize:null!=(a=null==(t=s.sizeBytes)?void 0:t.toString())?a:"unknown",assetType:s.mimeType})},[s,u,r]);return(0,t.jsxs)(t2.motion.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:(0,ee.cn)("flex flex-shrink-0 items-center gap-4 p-2 border rounded-xl bg-card hover:bg-card-hover cursor-pointer focus:bg-card-hover focus:outline-none mb-2 overflow-x-hidden",n&&"bg-card-hover"),tabIndex:0,onClick:m,children:[(0,t.jsx)(s1.AssetIcon,{metadata:(0,s2.convertAssetMetadataToFileMetadata)(s),className:"rounded-lg w-12 h-12 ms-0 me-0 [&>img]:h-full [&>img]:w-full"}),(0,t.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,t.jsx)("span",{className:"line-clamp-1 break-all",children:s.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 line-clamp-1 break-all",children:[(0,t.jsx)("span",{children:s.sizeBytes?(0,s4.formatBytes)(s.sizeBytes):i("file-browser.unknown-size","Unknown")}),(0,t.jsx)("span",{children:"  "}),(0,t.jsx)("span",{children:s.createTime?(0,s5.formatModifyTime)(s.createTime):""}),(0,t.jsx)("span",{children:"  "}),(0,t.jsx)("span",{children:s.mimeType})]})]}),c?(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)(eW.ButtonWithTooltip,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),d(!1)},tooltipContent:i("Cancel","Cancel"),"aria-label":i("Cancel","Cancel"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,t.jsx)(tf.X,{size:16})}),(0,t.jsx)(eW.ButtonWithTooltip,{variant:"ghost",size:"sm",btnColor:"danger",onClick:h,tooltipContent:i("Confirm","Confirm"),"aria-label":i("Confirm","Confirm"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,t.jsx)(s8.Trash2,{size:16})})]}):(0,t.jsx)(eW.ButtonWithTooltip,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),d(!0)},tooltipContent:i("Delete","Delete"),"aria-label":i("Delete","Delete"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,t.jsx)(s8.Trash2,{size:16})})]},s.assetId)});var s9=e.i(944408);let s7=(0,to.default)("ArrowDownNarrowWide",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h4",key:"6d7r33"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h10",key:"1438ji"}]]);var ae=e.i(749894),at=e.i(70872),as=e.i(446583);let aa=[{label:(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.size",defaults:"Size"}),value:"size"},{label:(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.name",defaults:"Name"}),value:"name"},{label:(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.created-time",defaults:"Created Time"}),value:"created"},{label:(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.last-used-time",defaults:"Last Used Time"}),value:"used"}];function an(){let{t:e}=(0,R.useTranslation)("base"),{user:s}=(0,ev.useSession)(),{push:n,replace:i,route:r}=(0,er.useRouting)(),o="files"===r.page?r:(0,ty.never)("only for /files"),[c,d]=(0,l.useState)(""),u=o.sort||"used",m=(0,eh.useMobileSize)(),h=(0,tI.useDebouncedValue)(c,500);(0,l.useEffect)(()=>{i({...o,search:h})},[h,i,o]);let p=(0,a.useChatPageStore)(e=>{var t;return(null==(t=e.sidePanelContent)?void 0:t.type)!=="asset"?null:e.sidePanelContent.data.fileMetadataId}),{assets:f,isLoading:x,hasError:g,refetch:v,loadMoreRef:j,historyContainerRef:y}=(()=>{let{route:e}=(0,er.useRouting)(),t=(0,s3.useFilesPageStore)(e=>e.loadFirstPage),s=(0,s3.useFilesPageStore)(e=>e.loadNextPage),a=(0,s3.useFilesPageStore)(e=>e.listPageToken),n=(0,s3.useFilesPageStore)(e=>e.listStatus),i=(0,s3.useAssetsList)(),r="files"===e.page?e.sort:"used",o="files"===e.page?e.search:void 0;(0,l.useEffect)(()=>{t({sort:r,search:o})},[t,r,o,e.page]);let{loadMoreRef:c,historyContainerRef:d}=(0,sL.useInfiniteScrollRefs)({hasNextPage:!!a,isFetchingNextPage:"loading"===n,isLoading:"loading"===n,fetchNextPage:()=>{s().catch(e=>(0,D.logError)("files-load-more",e))}});return{assets:i,isLoading:"loading"===n,hasError:"error"===n,refetch:t,loadMoreRef:c,historyContainerRef:d}})();return s?(0,t.jsxs)("main",{className:(0,ee.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{}),(0,t.jsxs)("div",{className:"max-w-[50rem] px-5 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:y,children:[(0,t.jsx)("h1",{className:(0,ee.cn)("text-2xl flex gap-2 items-center pb-4 font-semibold",m&&"ps-3"),children:e("Files","Files")}),(0,t.jsxs)("div",{className:"flex gap-2 items-center justify-between w-full pb-2",children:[(0,t.jsx)(at.Input,{value:c,onChange:e=>d(e.target.value),placeholder:e("file-browser.filter.placeholder","Search files..."),className:"text-primary bg-surface-l1 border-border-l1 h-10 rounded-xl"}),(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(eW.Button,{variant:"outline",className:"h-10 rounded-xl",children:[(0,t.jsx)(s7,{size:15,className:"text-fg-secondary"}),e("files-sort-show-menu","Sort"),(0,t.jsx)(s9.ChevronDownIcon,{className:"text-fg-secondary",size:14})]})}),(0,t.jsx)(tx.DropdownMenuContent,{children:aa.map(e=>(0,t.jsxs)(tx.DropdownMenuItem,{className:"gap-2",onSelect:()=>{var t;return t=e.value,void n({...o,sort:t})},children:[e.label,u===e.value&&(0,t.jsx)("span",{className:"ms-auto text-xs text-primary",children:(0,t.jsx)(ae.CheckIcon,{size:16,className:"text-primary"})})]},e.value))})]})]}),(0,t.jsxs)(sz.FadeScrollContainer,{children:[(0,t.jsxs)(t1.AnimatePresence,{children:[null==f?void 0:f.map(e=>(0,t.jsx)(s6,{isFileSelected:e.assetId===p,asset:e},e.assetId)),(null==f?void 0:f.length)===0&&!x&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:e("file-browser.no-files-found","No files found")})},"no-files-found"),x&&(0,t.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(sD.Loader2,{className:"animate-spin"})})})},"files-loading"),g&&(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,t.jsx)("div",{className:"text-center",children:e("file-browser.error.description","There was an issue loading your files")}),(0,t.jsx)(eW.Button,{variant:"filledSecondary",onClick:()=>v(),children:e("Retry","Retry")})]},"files-error")]}),(0,t.jsx)("div",{ref:j})]})]})]}):(0,t.jsx)("main",{className:(0,ee.cn)("w-screen h-dvh relative"),children:(0,t.jsx)(sE.ErrorCard,{title:e("Error","Error"),description:e("file-browser.error.anonymous-user","You must be logged in to access this page"),cta:e("files-page-error.cta","Return home")})})}e.i(200942);var ai=e.i(659097),al=e.i(274920),ar=e.i(23854);function ao(e){let{className:s}=e,{t:a}=(0,R.useTranslation)("files"),n=(0,l.useRef)(null),{data:{enableImageUploads:i}={}}=(0,e3.useFeatureControls)(),r=(0,s3.useFilesPageStore)(e=>e.uploadAsset),{push:o}=(0,er.useRouting)(),c=(0,l.useCallback)((e,t)=>{let s=t.items;if(!s||0===s.length||!s[0]||!("webkitGetAsEntry"in s[0]))return void e.forEach(e=>r(e));let n=e=>{".DS_Store"!==e.name&&r(e,e=>o({page:"files",fileId:e}))},i=e=>{(0,D.logError)("explorer-drop-zone:file-upload",e),eB.toast.error(a("files-extract-error","Error when processing file"))};for(let e=0;e<s.length;e++){let t=s[e];if(!t)continue;let a=t.webkitGetAsEntry();a&&(0,ar.extractFiles)(a,n,i)}},[a,r,o]),d=(0,al.useDropZone)({ref:n,onDrop:c,canDrop:e=>{var t;return!(!i&&(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))||(eB.toast.error(a("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1)}},[i,a]);return(0,t.jsx)(ai.DropCard,{ref:n,dragState:d,title:a("explorer-dropzone.title","Drop files to upload"),className:s})}var ac=e.i(850821),ad=e.i(376436),au=e.i(257491),am=e.i(903474),ah=e.i(551583),ap=e.i(715127),af=e.i(498647),ax=e.i(465620),ag=e.i(976346),av=e.i(12465),aj=e.i(969330),ay=e.i(979566),ab=e.i(351958),aw=e.i(631534),aw=aw,ak=e.i(208998);let aN=(0,l.memo)(e=>{let{children:s}=e,{t:a}=(0,R.useTranslation)("files"),n=(0,s3.useFilesPageStore)(e=>e.createAsset),i=(0,si.useLogEvent)(),{push:r}=(0,er.useRouting)(),o=(0,ak.useFileSpecs)(),{ENABLE_XLSX_EDITING:c}=(0,ep.useFeatureFlags)(),{data:{enableFileUploads:d,enableImageUploads:u}={}}=(0,e3.useFeatureControls)(),m=(0,l.useRef)(null),h=(0,s3.useFilesPageStore)(e=>e.uploadAsset),p=(0,l.useCallback)(e=>r({page:"files",fileId:e}),[r]),f=(0,l.useCallback)(e=>{n(e,p),i("files.create-file",e,{location:"AddFileButton:handleCreate"})},[n,p,i]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:s||(0,t.jsxs)(X.Button,{variant:"secondary",shape:"square",size:"sm",className:"flex-shrink-0",children:[(0,t.jsx)(sp.Plus,{size:"18"}),(0,t.jsx)("span",{className:"sr-only",children:a("files-add-button.label","Add new file")})]})}),(0,t.jsxs)(tx.DropdownMenuContent,{align:"start",alignOffset:-8,sideOffset:8,className:"min-w-40",children:[(0,t.jsx)(aC,{fileTypeId:"markdown",onSelect:f}),c&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>{f(o.spreadsheet.newFileName)},children:[(0,l.createElement)(o.spreadsheet.Icon,{className:"me-2 text-secondary",size:16}),o.spreadsheet.name]}),(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>r({page:"files",fileId:null,emptyView:"image"}),children:[(0,t.jsx)(ab.ImagePlusIcon,{size:16,className:"me-2 text-secondary"}),a("files-add-image","Image")]}),(0,t.jsxs)(tx.DropdownMenuSub,{children:[(0,t.jsxs)(tx.DropdownMenuSubTrigger,{children:[(0,t.jsx)(aw.default,{size:16,className:"me-2 text-secondary"}),a("files-add-code","Code")]}),(0,t.jsx)(tx.DropdownMenuPortal,{children:(0,t.jsx)(tx.DropdownMenuSubContent,{sideOffset:12,alignOffset:-4,className:"min-w-36",children:ak.codeIds.map(e=>(0,t.jsx)(aC,{fileTypeId:e,disableIcons:!0,onSelect:f},e))})})]}),(0,t.jsx)(tx.DropdownMenuSeparator,{className:"bg-border-l1 mx-2 last:hidden"}),d&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>{m.current&&m.current.click()},children:[(0,t.jsx)(ay.FolderIcon,{size:16,className:"me-2 text-secondary"}),a("files-menu-upload.label","Upload Files")]})]})]}),(0,t.jsx)("input",{type:"file",ref:m,className:"hidden",onChange:e=>{if(!e.target.files)return;let t=Array.from(e.target.files),s=u?t:t.filter(e=>!e.type.startsWith("image/"));t.length!==s.length&&eB.toast.error(a("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),s.forEach(e=>void h(e,p)),e.target.value=""},multiple:!0})]})});function aC(e){let{fileTypeId:s,onSelect:a,disableIcons:n}=e,{Icon:i,name:l,newFileName:r}=(0,ak.useFileSpecs)()[s];return(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>a(r),children:[n?null:(0,t.jsx)(i,{size:16,className:"me-2 text-secondary"}),l]})}var aS=e.i(705576);function aI(e){let{className:s,onClose:a,onBlur:n,...i}=e,{t:r}=(0,R.useTranslation)("files"),o=(0,ee.cn)("rounded-full shadow-none border border-border ps-9 h-8 focus:ring-0",s),c=(0,l.useCallback)(e=>{null==n||n(e),""===e.target.value&&(null==a||a())},[n,a]);return(0,t.jsxs)("div",{className:"relative flex flex-1",children:[(0,t.jsx)(aS.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),(0,t.jsx)(at.Input,{placeholder:r("files-search-input.placeholder","Search"),className:o,onBlur:c,...i})]})}function aT(){var e,s;let{t:a}=(0,R.useTranslation)("files"),n=(0,er.useRouting)(),{push:i,replace:r}=n,o="files"===n.route.page?n.route:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw Error(e)}("Only use Header in /files"),c=(0,ev.useSession)(),[d,u]=(0,l.useState)(null!=(e=o.search)?e:""),[m,h]=(0,l.useState)(null!=(s=o.search)&&s),[p,f]=(0,l.useState)(!1),x=(0,tI.useDebouncedValue)(d,500);(0,l.useEffect)(()=>{r({page:"files",search:x})},[x,r]),(0,l.useEffect)(()=>{o.search||(f(!1),u(""))},[o.search]);let g=e=>{e.stopPropagation(),e.preventDefault(),f(!1),u(""),i({page:"files",sort:null,createdBy:null,fileType:null,search:""})},v="files"===o.page&&o.sort||null,j="files"===o.page&&o.createdBy||null,y="files"===o.page&&o.fileType||null,b=()=>{u(""),h(!1)},w=(0,l.useMemo)(()=>[{label:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(aj.Avatar,{className:"w-6 h-6",textClassName:"!text-[10px]",user:c.user}),(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.creator-human",defaults:"Me"})]}),value:"user"},{label:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(ac.BlackholeLogo,{className:"w-6 h-6"}),(0,t.jsx)(as.Trans,{ns:"base",i18nKey:"file-browser.sort.creator-grok",defaults:"Grok"})]}),value:"grok"}],[c.user]),k=[{value:"image",label:a("files-filter-images","Images"),icon:ap.ImageIcon},{value:"document",label:a("files-filter-documents","Documents"),icon:au.DocumentIcon},{value:"spreadsheet",label:a("files-filter-spreadsheets","Spreadsheets"),icon:ag.TableIcon},{value:"code",label:a("files-filter-code","Code"),icon:ad.CodeIcon},{value:"pdf",label:a("files-filter-pdf","PDF"),icon:am.FilePdfIcon}];return(0,t.jsxs)("header",{className:"flex flex-col gap-px @container px-4",children:[(0,t.jsxs)("div",{className:"flex gap-2 h-header-height items-center",children:[(0,t.jsx)("div",{className:"flex-1 relative min-h-[32px]",children:(0,t.jsx)(t1.AnimatePresence,{mode:"sync",children:m?(0,t.jsx)(t2.motion.div,{initial:{width:"32px",height:"32px",opacity:0},animate:{width:"100%",height:"auto",opacity:1},exit:{width:"32px",height:"32px",opacity:0},transition:{duration:.1,ease:"easeOut"},className:"flex justify-end items-center gap-2 absolute top-0 end-0",children:(0,t.jsx)(aI,{value:d,onChange:e=>{u(e.target.value)},autoFocus:!0,className:"flex-1",onKeyDown:e=>{"Escape"===e.key&&b()},onClose:b})},"search-input"):(0,t.jsxs)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1,ease:"easeOut"},className:"flex justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold flex items-center justify-start",children:(0,t.jsx)(er.Link,{route:{page:"files",fileId:null},children:a("files-explorer-header","Files")})}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(X.Button,{variant:"tertiary",shape:"square",size:"sm","aria-label":a("files-explorer-collapse-button","Collapse"),onClick:()=>s3.useFilesPageStore.getState().setIsFileExplorerCollapsed(!0),children:(0,t.jsx)(ax.SidebarExpandIcon,{size:18,className:"text-fg-secondary"})}),(0,t.jsxs)(X.Button,{variant:"tertiary",shape:"square",size:"sm",onClick:()=>h(!0),children:[(0,t.jsx)(af.SearchIcon,{size:18,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"sr-only",children:a("files-search-open-button.label","Show search input")})]})]})]},"title-and-button")})}),(0,t.jsx)(aN,{})]}),(0,t.jsxs)("div",{className:"flex gap-2 overflow-x-auto no-scrollbar h-subheader-height items-center",children:[(0,t.jsxs)(tx.DropdownMenu,{open:p,onOpenChange:f,children:[(0,t.jsxs)("div",{className:(0,ee.cn)("flex items-center rounded-full border gap-0.5 border-border-l2 h-8 overflow-hidden flex-shrink-0 focus-visible:bg-button-ghost-hover hover:bg-button-ghost-hover",(y||j)&&"bg-button-ghost-hover border-secondary pr-0"),children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{variant:"secondary",size:"sm",shape:"rectangle",className:(0,ee.cn)("border flex-shrink-0 border-transparent hover:bg-transparent",(y||j)&&"pr-0 hover:bg-transparent"),style:{boxShadow:"none"},children:[(0,t.jsx)(ah.FilterIcon,{size:16,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"sr-only",children:a("files-filter-open-button.label","Show filters")}),(0,t.jsx)("span",{className:"hidden @[160px]:inline-block",children:a("files-filter-show-menu","Filter")})]})}),y||j?(0,t.jsxs)(X.Button,{variant:"tertiary",size:"sm",onClick:g,shape:"circle",children:[(0,t.jsx)(av.XIcon,{size:16}),(0,t.jsx)("span",{className:"sr-only",children:a("files-filter-clear","Clear all filters")})]}):null]}),(0,t.jsxs)(tx.DropdownMenuContent,{side:"bottom",align:"start",sideOffset:6,className:"no-a11y-check rounded-2xl",children:[(0,t.jsxs)("div",{className:"min-w-40 flex flex-col gap-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-secondary ms-3 my-2 min-w-32",children:a("files-filter-by-creator","Created By")}),w.map(e=>(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>{i({page:"files",createdBy:e.value})},className:"flex items-center gap-2",children:[e.label,j===e.value&&(0,t.jsx)("span",{className:"ms-auto text-xs text-primary",children:(0,t.jsx)(ae.CheckIcon,{size:16,className:"text-primary"})})]},"CREATOR_OPTIONS"+e.value.toString()))]}),(0,t.jsx)(tx.DropdownMenuSeparator,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-secondary ms-3 my-2",children:a("files-filter-by-type","File Type")}),k.map(e=>{let s=e.icon;return(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>{i({page:"files",fileType:e.value})},className:"flex items-center gap-2",children:[(0,t.jsx)(s,{size:16,className:"text-fg-secondary"}),e.label,y===e.value&&(0,t.jsx)("span",{className:"ms-auto text-xs text-primary",children:(0,t.jsx)(ae.CheckIcon,{size:16,className:"text-primary"})})]},e.value||"all")})]})]}),(d||y||j)&&(0,t.jsx)(X.Button,{variant:"secondary",size:"md",shape:"rectangle",onClick:g,className:"w-full mt-4 rounded-xl",children:a("files-filter-reset","Reset filters")})]})]}),(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{variant:"secondary",size:"sm",shape:"pill",className:" flex-shrink-0",children:[(0,t.jsx)(s7,{size:15,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"sr-only",children:a("files-sort-show-menu","Show sorting menu")}),(0,t.jsx)("span",{className:"hidden @[160px]:inline-block",children:a("files-sort-show-menu","Sort")})]})}),(0,t.jsx)(tx.DropdownMenuContent,{side:"bottom",align:"start",sideOffset:6,className:"min-w-36",children:aa.map(e=>(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>{i({page:"files",sort:e.value})},className:"flex items-center gap-2",children:[e.label,v===e.value&&(0,t.jsx)("span",{className:"ms-auto text-xs text-primary",children:(0,t.jsx)(ae.CheckIcon,{size:16,className:"text-primary"})})]},e.value))})]}),(0,t.jsx)(aM,{})]})]})}let aM=(0,l.memo)(function(){let e=(0,s3.useFilesPageStore)(e=>"loading"===e.listStatus);return(0,t.jsx)(t1.AnimatePresence,{children:e&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeOut"},className:"flex-1 flex justify-end items-center",children:(0,t.jsx)(t5.Spinner,{size:"xs",className:"border-b-secondary"})})})});var aP=e.i(786608);e.i(602723);var aE=e.i(562929),az=e.i(516722),aD=e.i(13330);function aR(e){let{onRetry:s}=e,{t:a}=(0,R.useTranslation)("files");return(0,t.jsxs)("div",{className:"border border-l1 bg-surface-l1 rounded-2xl p-4 flex flex-col items-center justify-center text-center",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold mb-2",children:a("files-list-loading-error.title","Could not load files")}),(0,t.jsx)("p",{className:"text-xs text-fg-secondary mb-4",children:a("files-list-loading-error.message","Something went wrong while loading your files")}),(0,t.jsxs)(eW.Button,{variant:"outline",size:"md",onClick:s,children:[(0,t.jsx)(aD.RefreshCw,{className:"h-4 w-4 text-secondary"}),a("files-list-loading-error.retry","Retry")]})]})}function aA(e){let{onFiltersClear:s}=e,{t:a}=(0,R.useTranslation)("files");return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4 overflow-hidden",children:[(0,t.jsx)("p",{className:"text-muted-foreground truncate",children:a("files-no-results.label","No results")}),s&&(0,t.jsxs)(eW.Button,{variant:"outline",size:"md",onClick:()=>{s()},children:[(0,t.jsx)(av.XIcon,{size:16}),(0,t.jsx)("span",{className:"truncate",children:a("files-clear-filters.label","Clear filters")})]})]})}var aL=e.i(337017),aF=e.i(952447),a_=e.i(269295),aB=e.i(890201);function aG(e){var s;let{asset:a,stack:n,className:i}=e,r=(0,l.useRef)(!n.length);return n.length?(0,t.jsx)("div",{className:(0,ee.cn)("relative",i),children:(0,t.jsxs)(t1.AnimatePresence,{initial:r.current,children:[(0,t.jsx)(t2.motion.div,{animate:{x:-2,y:2,rotate:-8},transition:{delay:.2,duration:1},children:(0,t.jsx)(s1.AssetIcon,{metadata:(0,s2.convertAssetMetadataToFileMetadata)(a),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})},a.assetId),(0,t.jsx)(t2.motion.div,{animate:{x:2,y:-2,rotate:8},transition:{duration:2},className:"absolute inset-0 -z-10",children:(0,t.jsx)(s1.AssetIcon,{metadata:(0,s2.convertAssetMetadataToFileMetadata)(n[0]),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})},null==(s=n[0])?void 0:s.assetId)]})}):(0,t.jsx)(s1.AssetIcon,{metadata:(0,s2.convertAssetMetadataToFileMetadata)(a),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-surface-l1 border border-white"})}function aW(e){let{okLabel:s,onOk:a,cancelLabel:n,onCancel:i}=e;return(0,t.jsxs)("div",{className:(0,ee.cn)("flex","items-center justify-end gap-0.5"),children:[(0,t.jsxs)(X.ButtonWithTooltip,{variant:"tertiary",size:"sm",shape:"square",onClick:i,tooltipContent:n,tooltipContentProps:{hideWhenDetached:!0},children:[(0,t.jsx)(av.XIcon,{size:16,className:"text-fg-primary"}),(0,t.jsx)("span",{className:"sr-only",children:n})]}),(0,t.jsxs)(X.ButtonWithTooltip,{variant:"tertiary",size:"sm",shape:"square",onClick:a,tooltipContent:s,tooltipContentProps:{hideWhenDetached:!0},children:[(0,t.jsx)(ae.CheckIcon,{size:16,className:"text-fg-primary"}),(0,t.jsx)("span",{className:"sr-only",children:n})]})]})}let aU=(0,l.memo)(function(e){let{value:s,onSubmit:a,onCancel:n,state:i,suffix:r,className:o}=e,{t:c}=(0,R.useTranslation)("files"),[d,u]=(0,l.useState)(s),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{u(s)},[s]),(0,l.useEffect)(()=>{"edit"===i&&m.current&&(m.current.focus(),m.current.setSelectionRange(0,m.current.value.lastIndexOf(".")))},[i]);let h=()=>{a(d.trim())};if("edit"===i)return(0,t.jsxs)("div",{className:"flex flex-1",onClick:ek.handleIsolateClick,children:[(0,t.jsx)("input",{ref:m,className:"w-full bg-transparent focus-visible:outline-none",value:d,onKeyDown:e=>{"Enter"===e.key?h():"Escape"===e.key&&n()},onChange:e=>u(e.target.value),"aria-label":c("filename-edit-input.label","Edit file name")}),(0,t.jsx)(aW,{onCancel:e=>{e.preventDefault(),e.stopPropagation(),n()},cancelLabel:c("Cancel","Cancel"),onOk:e=>{e.preventDefault(),e.stopPropagation(),e.preventDefault(),e.stopPropagation(),h()},okLabel:c("Save","Save")})]});let p=(0,ee.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",o);return(0,t.jsxs)("span",{className:p,style:{maskImage:Y.RIGHT_MASK_IMAGE,WebkitMaskImage:Y.RIGHT_MASK_IMAGE},children:[s,r&&(0,t.jsx)("span",{className:"text-fg-tertiary",children:r})]})}),aO=e=>(0,t.jsx)("span",{className:"font-bold",children:e}),aq=e=>{let{text:s,pattern:a,renderMatch:n=aO}=e,i=(0,l.useMemo)(()=>{let e=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t=RegExp("(".concat(e,")"),"gi");return s.split(t)},[s,a]);return(0,t.jsx)(t.Fragment,{children:i.map((e,s)=>e.toLowerCase()===a.toLowerCase()&&n?(0,t.jsx)(l.Fragment,{children:n(e)},s):(0,t.jsx)(l.Fragment,{children:e},s))})};function aV(e){let{assetId:s}=e,a=(0,s3.useFilesPageStore)(e=>e.debouncedSearchQuery),n=(0,s3.useFilesPageStore)(e=>{var t,n;return null!=(n=null==(t=e.searchHighlight[a])?void 0:t[s])?n:""});return n&&a?(0,t.jsx)("div",{className:"px-3 mb-2 text-xs text-fg-secondary text-start max-w-full text-wrap line-clamp-3 leading-normal max-h-[4.5em]",children:(0,t.jsx)(aq,{text:n,pattern:a,renderMatch:aH})}):null}let aH=e=>(0,t.jsx)("span",{className:"text-fg-primary font-semibold",children:e});var aK=e.i(290124);let aQ=(0,l.memo)(function(e){var s,a,n,i,r,o,c;let{asset:d,stackedAssets:u,action:m,onActionChange:h,className:p,isActive:f=!1}=e,{push:x,route:g}=(0,er.useRouting)(),{t:v}=(0,R.useTranslation)("base"),j=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.assetsById)),y=(0,si.useLogEvent)(),[,b]=(0,aK.splitFileName)(null!=(a=d.name)?a:""),w=null!=(i=null!=b?b:(0,aB.extension)(null!=(n=d.mimeType)?n:""))?i:"",k=(null==m?void 0:m.type)==="edit"&&(null==m?void 0:m.assetId)===d.assetId,N=(null==m?void 0:m.type)==="delete"&&(null==m?void 0:m.assetId)===d.assetId,C=(0,s3.useFilesPageStore)(e=>e.renameAsset),S=(0,l.useMemo)(()=>u.map(e=>{var t;return null==(t=j[e])?void 0:t.data}).filter(Boolean).sort((e,t)=>new Date((null==e?void 0:e.createTime)||"").getTime()-new Date((null==t?void 0:t.createTime)||"").getTime())||[],[u,j]),I=(0,l.useCallback)(()=>{h(null)},[h]),T=(0,l.useCallback)(e=>{var t,s,a,n;let i=null==(s=j[d.rootAssetId||d.assetId])||null==(t=s.data)?void 0:t.sourceConversationId,l=null!=(n=null!=(a=d.rootAssetSourceConversationId)?a:i)?n:d.sourceConversationId;l&&(e.stopPropagation(),e.preventDefault(),x({page:"chat",conversationId:l,temporary:!1}))},[d.rootAssetSourceConversationId,d.rootAssetId,d.assetId,d.sourceConversationId,j,x]),M=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),h({type:"delete",assetId:d.assetId})},[d.assetId,h]),P=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),I()},[I]),E=(0,s3.useFilesPageStore)(e=>e.deleteAsset),z=async e=>{var t;e.stopPropagation(),e.preventDefault(),h(null),await E(null!=(t=d.assetId)?t:""),y("files.delete",d.assetId,{location:"FileRow:handleDelete"}),(null==u?void 0:u.length)&&await Promise.all(u.map(e=>(y("files.delete",e,{location:"FileRow:handleDelete"}),E(e)))),"files"===g.page&&(g.fileId===d.rootAssetId||g.fileId===d.assetId)&&x({page:"files",fileId:null})},A=(0,ee.cn)("flex py-0 gap-1 relat justify-start items-center w-full overflow-hidden group/file hover:bg-button-ghost-hover min-h-10 h-auto items-stretch",{"bg-button-ghost-active":f},p);return(0,t.jsx)(X.Button,{variant:"tertiary",size:"sm",shape:"rectangle",className:A,asChild:!0,children:(0,t.jsxs)(er.Link,{route:{page:"files",fileId:null!=(o=null!=(r=d.rootAssetId)?r:d.assetId)?o:null},className:(0,ee.cn)("group/file text-sm","w-full flex flex-col justify-center !gap-0 text-primary ps-0 pe-1"),children:[(0,t.jsxs)("div",{className:"w-full flex flex-row gap-2 text-primary ps-2 items-center min-h-10",children:[(null==(s=d.mimeType)?void 0:s.startsWith("image/"))?(0,t.jsx)(aG,{asset:d,stack:S,className:"w-fit h-fit"}):(0,t.jsx)(s1.AssetIcon,{metadata:(0,s2.convertAssetMetadataToFileMetadata)(d),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-transparent"}),(0,t.jsx)(aU,{value:null!=(c=d.name)?c:"",onCancel:I,onSubmit:e=>{var t;h(null),""!==e&&(C(null!=(t=d.assetId)?t:"",e).catch((0,D.createLogError)("FileRow")),y("files.rename",e,{location:"FileRow:save"}))},state:k?"edit":"view"}),k?null:N?(0,t.jsx)(aW,{onCancel:P,cancelLabel:v("Cancel","Cancel"),onOk:z,okLabel:v("Delete","Delete")}):(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:(0,ee.cn)("hidden group-hover/file:hidden group-focus-visible/file:hidden","text-fg-secondary"),children:w}),(0,t.jsxs)("div",{className:(0,ee.cn)("flex items-center justify-end"),children:[(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.ButtonWithTooltip,{tabIndex:-1,className:(0,ee.cn)("text-fg-secondary",d.isRootAssetCreatedByModel?"w-8":"w-0","group-hover/file:w-8 group-focus-visible/file:w-8 group-hover/file:flex group-focus-visible/file:flex"),variant:"tertiary",size:"sm",shape:"square",style:{boxShadow:d.isRootAssetCreatedByModel?"none":void 0},tooltipContent:v("files-more-options.label","Options"),tooltipContentProps:{hideWhenDetached:!0,side:"bottom"},children:[d.isRootAssetCreatedByModel?(0,t.jsx)(ac.BlackholeLogo,{className:(0,ee.cn)("opacity-20 group-hover/file:hidden group-focus-visible/file:hidden size-4")}):null,(0,t.jsx)(aL.EllipsisVertical,{size:16,className:"hidden group-hover/file:block group-focus-visible/file:block"}),(0,t.jsx)("span",{className:"sr-only",children:v("files-more-options.label","Options")})]})}),(0,t.jsxs)(tx.DropdownMenuContent,{side:"bottom",align:"end",className:"min-w-36",children:[(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:e=>{e.preventDefault(),h({type:"edit",assetId:d.assetId})},className:"flex items-center gap-2",children:[(0,t.jsx)(a_.PenIcon,{size:16,className:"text-fg-secondary"}),v("files.rename","Rename")]}),d.isRootAssetCreatedByModel&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:e=>{T(e)},className:"flex items-center gap-2",children:[(0,t.jsx)(aF.MessageCircleIcon,{size:16,className:"text-fg-secondary"}),v("files.open-conversation","Open Conversation")]})]})]}),(0,t.jsxs)(X.ButtonWithTooltip,{tabIndex:-1,className:(0,ee.cn)("text-fg-secondary","hidden group-hover/file:flex group-focus-visible/file:flex"),onClick:M,variant:"tertiary",size:"sm",shape:"square",tooltipContent:v("files-list-delete.tooltip","Delete file"),tooltipContentProps:{hideWhenDetached:!0},children:[(0,t.jsx)(s8.Trash2,{size:16}),(0,t.jsx)("span",{className:"sr-only",children:v("files-list-delete","Delete file")})]})]})]})]}),(0,t.jsx)(aV,{assetId:d.assetId})]})})});var aY=e.i(186679);function aX(){return(0,t.jsx)(aY.DelayedRender,{delayMs:300,children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-3","aria-busy":"true",children:[(0,t.jsx)(a$,{className:"w-1/5"}),(0,t.jsx)(a$,{className:"w-3/5"}),(0,t.jsx)(a$,{className:"w-2/5"}),(0,t.jsx)(a$,{className:"w-1/5"}),(0,t.jsx)(a$,{className:"w-2/3"})]})})}let a$=e=>{let{className:s}=e;return(0,t.jsxs)("div",{className:"flex w-full gap-3 items-center",children:[(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6 rounded-md"}),(0,t.jsx)(eb.Skeleton,{className:(0,ee.cn)("w-full rounded-xl h-4",s)})]})};function aZ(){let{t:e}=(0,R.useTranslation)("files");return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,t.jsx)("h2",{className:"text-md font-semibold text-center text-fg-primary truncate",children:e("files-empty.title","No Files")}),(0,t.jsx)("p",{className:"text-center text-fg-secondary truncate text-sm",children:e("files-empty.subtitle","Upload files or ask Grok to create one.")})]}),(0,t.jsx)(aN,{children:(0,t.jsxs)(eW.Button,{className:"flex-shrink-0",size:"md",variant:"filledSecondary",children:[(0,t.jsx)(sp.Plus,{className:"size-4"}),e("files-empty.add-button","Add File")]})})]})}let aJ=(0,l.memo)(e=>{let{className:s}=e,{t:a}=(0,R.useTranslation)("files"),n=(0,er.useRouting)(),i=n.push,r="files"===n.route.page?n.route:(0,ty.never)("Files list only for /files"),[o,c]=(0,l.useState)(null),d=(0,s3.useFilesPageStore)(e=>e.loadFirstPage),u=(0,s3.useFilesPageStore)(e=>e.loadNextPage),m=(0,s3.useFilesPageStore)(e=>e.listPageToken),h=(0,si.useLogEvent)(),{search:p,sort:f,fileType:x,createdBy:g}=r,v=(0,l.useCallback)(()=>{d({search:p,sort:f,fileType:x,createdBy:g}),p&&h("files.search","",{location:"files-list:reloadFilesList"}),f&&"used"!==f&&h("files.sort",f,{location:"files-list:reloadFilesList"}),(x||g)&&h("files.filter","",{location:"files-list:reloadFilesList"})},[d,p,f,x,g,h]);(0,l.useEffect)(()=>v(),[v]);let j=(0,s3.useFilesPageStore)(e=>!!(e.debouncedSearchQuery||e.searchFileType||e.source!==aE.AssetRepositorySearchAssetMetadataSourceEnum.SourceAny)),y=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.list)),b=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.listStatus)),w=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.assetsById)),k=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.currentVersion)),N=(0,l.useMemo)(()=>y.map(e=>{var t;return null==(t=w[e])?void 0:t.data}).filter(ty.isDefined),[y,w]),C=(0,l.useMemo)(()=>{let e=N.reduce((e,t)=>{var s,a;return(null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.sourceConversationId&&(e[t.sourceConversationId]||(e[t.sourceConversationId]=[]),null==(a=e[t.sourceConversationId])||a.push(t.assetId)),e},{});return N.map(t=>{var s;let a=[];if((null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.currentConversationId){let s=e[t.currentConversationId];s&&a.push(...s)}return{rootAsset:t,children:a}})},[N]),S=(0,l.useMemo)(()=>{let e=new Set(C.flatMap(e=>e.children.filter(t=>t!==e.rootAsset.assetId)));return y.filter(t=>!e.has(t))},[y,C]),I=(0,s3.useFilesPageStore)(e=>e.creationRequests),T=(0,l.useCallback)(()=>{m&&"loading"!==b&&u()},[b,u,m]),M=(0,aP.useIntersectionObserver)(T),P=null;if("loading"===b&&!m&&0===y.length)return(0,t.jsx)(aX,{});"ready"===b?0===y.length?P=j?(0,t.jsx)(aA,{onFiltersClear:()=>{i({...r,sort:void 0,createdBy:void 0,fileType:void 0,search:""})}}):(0,t.jsx)(aZ,{}):m&&(P=(0,t.jsx)("div",{ref:M,className:"text-center mt-8 text-sm text-fg-secondary",children:a("files-scrollto.label","Scroll to load more")})):"loading"===b?m&&(P=(0,t.jsx)(aX,{})):"error"===b&&(P=(0,t.jsx)(aR,{onRetry:d}));let E=(0,ee.cn)("gap-0 py-1.5",s);return(0,t.jsxs)(sz.FadeScrollContainer,{className:E,fadeSize:"md","aria-busy":"loading"===b,children:[(0,t.jsx)("ol",{children:I.filter(e=>!e.assetId||!w[e.assetId]).map(e=>(0,t.jsx)(t2.motion.li,{initial:{height:0,scaleY:0,opacity:0},animate:{height:"auto",scaleY:1,opacity:1},transition:{duration:.15},children:(0,t.jsx)(a0,{request:e})},e.name))}),(0,t.jsx)("ol",{children:(0,t.jsx)(t1.AnimatePresence,{children:S.map(e=>{var s,a;let n=k[e];if(!n)return null;let i=null==(s=w[n])?void 0:s.data;return i?(0,t.jsx)(t2.motion.li,{initial:{height:"auto",scaleY:1,opacity:1},exit:{height:0,scaleY:0,opacity:0},transition:{duration:.15},children:(0,t.jsx)(aQ,{asset:i,stackedAssets:(null==(a=C.find(t=>t.rootAsset.assetId===e))?void 0:a.children)||[],action:o,onActionChange:c,isActive:r.fileId===e||I.some(t=>t.assetId===e)})},e):null})})}),P]})});function a0(e){var s;let{request:a}=e,[n,i]=(0,aK.splitFileName)(null!=(s=a.name)?s:"");return(0,t.jsxs)("div",{className:"h-[42px] rounded-xl px-3.5 text-sm p-4 flex items-center bg-button-ghost-active",children:[(0,t.jsx)(t5.Spinner,{size:"xs",className:"me-[11px]"}),(0,t.jsx)("span",{children:n}),i&&(0,t.jsxs)("span",{className:"text-fg-secondary",children:[".",i]})]})}function a1(e){let{className:s}=e,{data:{enableFileUploads:a}={}}=(0,e3.useFeatureControls)();return(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-col",s),children:[(0,t.jsx)(aT,{}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)(aJ,{className:"h-full px-2"}),a&&(0,t.jsx)(ao,{className:"m-2"})]})]})}var a2=e.i(938270),a5=e.i(489843),a4=e.i(227465),a3=e.i(681404);function a8(e){let{className:s,buttonText:a,multiple:n=!0}=e,{t:i}=(0,R.useTranslation)("files"),r=(0,l.useRef)(null),o=(0,ee.cn)("flex items-center @xs:flex-col @xs:items-start @xs:justify-between h-auto p-3 rounded-2xl min-w-32 bg-surface-l1 border-border-l1",s),{data:{enableImageUploads:c}={}}=(0,e3.useFeatureControls)(),d=(0,s3.useFilesPageStore)(e=>e.uploadAsset),{push:u}=(0,er.useRouting)(),m=(0,l.useCallback)(e=>u({page:"files",fileId:e}),[u]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eW.Button,{variant:"outline",className:o,onClick:()=>{r.current&&r.current.click()},disabled:!1,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ay.FolderIcon,{className:"w-6 h-6 stroke-[1.5] text-secondary"}),(0,t.jsx)("span",{children:a||i("file-upload-button.label","Upload Files")})]})}),(0,t.jsx)("input",{type:"file",ref:r,style:{display:"none"},onChange:e=>{if(!e.target.files)return;let t=Array.from(e.target.files),s=c?t:t.filter(e=>!e.type.startsWith("image/"));t.length!==s.length&&eB.toast.error(i("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),s.forEach(e=>void d(e,m)),e.target.value=""},multiple:n})]})}let a6="w-6 h-6 text-secondary stroke-[1.5]",a9=(0,l.memo)(e=>{let{className:s}=e,{ENABLE_XLSX_EDITING:a}=(0,ep.useFeatureFlags)(),{t:n}=(0,R.useTranslation)("files"),{push:i}=(0,er.useRouting)(),r=(0,ak.useFileSpecs)(),o=(0,si.useLogEvent)(),c=(0,s3.useFilesPageStore)(e=>e.createAsset),{data:{enableFileUploads:d}={}}=(0,e3.useFeatureControls)(),u=(0,l.useCallback)((e,t)=>{c(e,t),o("files.create-file",e,{location:"Empty:handleCreate"})},[c,o]),m=e=>i({page:"files",fileId:e});return(0,t.jsxs)("div",{className:"h-full relative",children:[(0,t.jsx)(a3.CollapseButton,{className:"absolute top-3 left-3 z-10",variant:"tertiary",size:"sm",shape:"square"}),(0,t.jsxs)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},className:(0,ee.cn)("flex flex-col items-center justify-center h-full p-4 @container",s),children:[(0,t.jsx)(ac.BlackholeLogo,{className:"w-20 h-20 text-muted-foreground"}),(0,t.jsx)("p",{className:"mt-4 text-md text-muted-foreground text-center",children:n("empty.create-something-new","Create something new")}),(0,t.jsxs)("div",{className:"w-full max-w-xl gap-3 mt-6 overflow-wrap items-stretch flex flex-col @xs:items-center @xs:flex-row flex-wrap justify-center ",children:[(0,t.jsx)(a7,{icon:(0,t.jsx)(au.DocumentIcon,{className:a6}),text:n("empty.document","Document"),onClick:()=>void u(r.markdown.newFileName,m)}),a&&(0,t.jsx)(a7,{icon:(0,l.createElement)(r.spreadsheet.Icon,{className:a6}),text:n("empty.spreadsheet","Spreadsheet"),onClick:()=>void u(r.spreadsheet.newFileName,m)}),(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(a7,{icon:(0,t.jsx)(ad.CodeIcon,{className:a6}),text:n("empty.code","Code")})}),(0,t.jsx)(tx.DropdownMenuContent,{className:"min-w-36",side:"right",sideOffset:12,children:ak.codeIds.map(e=>(0,t.jsx)(ne,{fileTypeId:e,disableIcons:!0,onSelect:e=>void u(e,m)},e))})]}),(0,t.jsx)(a7,{icon:(0,t.jsx)(ab.ImagePlusIcon,{className:a6}),text:n("empty.image","Image"),onClick:()=>{i({page:"files",fileId:null,emptyView:"image"})}}),d&&(0,t.jsx)(a8,{})]}),d&&(0,t.jsx)(ao,{className:"m-4"})]})]})});function a7(e){let{icon:s,text:a,...n}=e;return(0,t.jsxs)(eW.Button,{variant:"outline",className:"flex @xs:flex-col items-center justify-center @xs:items-start @xs:justify-between h-auto p-3 rounded-2xl min-w-32 @xs:bg-surface-l1 border-0  @xs:border-border-l1 @xs:border transition-none @xs:transition-colors",...n,children:[s,(0,t.jsx)("span",{children:a})]})}function ne(e){let{fileTypeId:s,onSelect:a,disableIcons:n}=e,{Icon:i,name:l,newFileName:r}=(0,ak.useFileSpecs)()[s];return(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:()=>a(r),children:[n?null:(0,t.jsx)(i,{size:16,className:"me-2"}),l]})}var nt=e.i(637797),ns=e.i(159422),na=e.i(475267),nn=e.i(315366),ni=e.i(448888),nl=e.i(431533);let nr=e=>{let{selectedImage:s,isPeekingParent:a,isFinalImageLoaded:n,setIsFinalImageLoaded:i,isParentImageLoaded:r,setIsParentImageLoaded:o}=e,[c,d]=(0,l.useState)([]),[u,m]=(0,l.useState)(!0),h=(0,l.useMemo)(()=>"streaming"===s.state,[s.state]),p=(0,l.useMemo)(()=>!!(s.generatedImageHeight&&s.generatedImageWidth),[s.generatedImageHeight,s.generatedImageWidth]),f=(0,l.useMemo)(()=>s.generatedImageHeight&&s.generatedImageWidth?s.generatedImageWidth/s.generatedImageHeight:4/3,[s.generatedImageHeight,s.generatedImageWidth]);return(0,l.useEffect)(()=>{(h||!u)&&(null==s?void 0:s.progressMap)?d(s.progressMap):!h&&(null==s?void 0:s.url)?d(e=>[...e,{progress:1,imageUrl:s.url||""}]):d([])},[h,null==s?void 0:s.url,null==s?void 0:s.progressMap,u]),(0,l.useEffect)(()=>{h&&u&&m(!1),h||!n||u||m(!0)},[h,n,u]),(0,t.jsx)("figure",{className:(0,ee.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg"),children:(0,t.jsx)(t1.AnimatePresence,{mode:"wait",children:h||!u?p?(0,t.jsx)(t2.motion.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:f,maxHeight:s.generatedImageHeight},children:(0,t.jsx)(ni.GrokImage,{status:"streaming",intermediateResults:c,isModerated:s.isModerated,aspectRatio:f})},"streaming-image"):(0,t.jsx)(nl.ImageLoader,{}):(0,t.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[s.url&&(0,t.jsxs)(t.Fragment,{children:[!n&&(0,t.jsx)(nl.ImageLoader,{className:"absolute z-20 inset-0"}),(0,t.jsx)(t2.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:s&&a||!n?"hidden":"visible",transition:{ease:"easeInOut"},src:s.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>i(!0)},"finished-image")]}),(0,t.jsx)(t1.AnimatePresence,{children:!h&&s&&a&&(0,t.jsxs)(t2.motion.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!r&&(0,t.jsx)(nl.ImageLoader,{className:"absolute z-20 inset-0"}),(0,t.jsx)(t2.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:r?"visible":"hidden",src:s.parentImageUrl,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>o(!0)},"parent-image")]},"parent-image-container")})]})})})};var no=e.i(538036),no=no,nc=e.i(8681),nd=e.i(283272),nu=e.i(688578),nm=e.i(258669);let nh=e=>{let{children:s,onUploadImage:n}=e,{t:i}=(0,R.useTranslation)("base"),r=(0,nu.useFileStore)(eU.prop("fetchUploadFile")),o=(0,nu.useFileStore)(eU.prop("removeByConversationId")),c=(0,a.useChatPageStore)(eU.prop("conversationId")),d=(0,sF.useRequestErrorToastFn)(),u=(0,l.useRef)(null),[m,h]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1),v=(0,l.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),j=(0,l.useCallback)(async(e,t)=>{let s;if(1!==e.length||!e[0])return void eB.toast.error(i("image-editor.one-upload-allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void eB.toast.error(i("image-editor.images-only-allowed","Only image files are allowed"));f(!0);try{let t=r(e[0],c||"no_conversation_id");s=await t.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}s instanceof Error&&d("image-editor-upload:uploadFile",s,i("image-editor.failed-to-upload","Failed to upload file")),f(!1),o(c||"no_conversation_id"),!s||s instanceof Error||n({image:s,type:t})},[i,r,c,n,o,d]),y=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),p||h(!0)},[p]),b=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h(!1)},[]),w=(0,l.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),h(!1),!p)return j(Array.from(e.dataTransfer.files),"upload")},[j,p]),k=(0,l.useCallback)(e=>{if(e.target.files)return j(Array.from(e.target.files),"upload").finally(()=>{u.current&&(u.current.value="")})},[j]),N=(0,l.useCallback)(async e=>j([e],"draw").finally(()=>{g(!1)}),[j]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:y,onDragLeave:b,onDrop:w,className:"border resize transition-colors w-full h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(m&&!p&&"bg-surface-l1 border-border-l1"),children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full",children:[(0,t.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:m&&!p?(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(nc.Files,{className:"size-6"})},"files"):(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(ab.ImagePlusIcon,{className:"size-6"})},"image-plus")})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-primary",children:i("image-editor.empty.title","Ask Grok to create an image")}),(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:p?(0,t.jsx)(t2.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:i("image-editor.empty.uploading-image","Uploading image")},"uploading"):m?(0,t.jsx)(t2.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:i("image-editor.empty.drop-image","Drop image here")},"dragging"):(0,t.jsx)(t2.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:i("image-editor.empty.description","You can also upload an image or draw instead.")},"not-dragging")})]}),s,(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(eW.Button,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:p,onClick:v,children:[p?(0,t.jsx)(t5.Spinner,{size:"xxs"}):(0,t.jsx)(nd.Upload,{className:"size-4 text-fg-secondary"}),i("image-editor.empty.upload","Upload")]}),(0,t.jsxs)(eW.Button,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:p,onClick:()=>{g(!0)},children:[(0,t.jsx)(no.default,{className:"size-4 text-fg-secondary"}),i("image-editor.empty.draw","Draw")]})]}),(0,t.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:k,multiple:!1,"data-testid":"file-input"})]})}),(0,t.jsx)(nm.default,{open:x,setOpen:g,onAttach:N})]})};var np=e.i(497985),nf=e.i(90476);let nx=(0,to.default)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var ng=e.i(500751);let nv=e=>{let{selectedImage:s,title:n,isSending:i=!1,onRegenerate:r,onClose:o}=e,{t:c}=(0,R.useTranslation)("base"),[d,u]=(0,l.useState)(!1),m=(0,a.useChatPageStore)(e=>e.conversationId),h=(0,a.useChatPageStore)(e=>e.lastMessageId),p=(0,l.useCallback)(()=>{var e;!d&&(null==s?void 0:s.url)&&(u(!0),(0,tv.downloadImage)(s.url,null==(e=s.url)?void 0:e.split("/").pop()).catch((0,D.createLogError)("image-editor:handleDownload")).finally(()=>u(!1)))},[d,s]);return(0,t.jsx)("header",{className:"flex justify-between w-full items-start h-10 gap-3  relative z-30 flex-shrink-0",children:(0,t.jsxs)(t1.AnimatePresence,{mode:"popLayout",children:[n&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"w-full overflow-hidden min-w-0 hidden sm:block",children:n},JSON.stringify(n)),(0,t.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(null==s?void 0:s.state)&&["streaming","error","completed"].includes(s.state)&&(null==s?void 0:s.regenResponseId)&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(eW.ButtonWithTooltip,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":c("image-editor.regenerate","Regenerate Image"),tooltipContent:c("image-editor.regenerate","Regenerate Image"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:"streaming"===s.state||i,onClick:r,children:(0,t.jsx)(t2.motion.button,{whileTap:(null==s?void 0:s.state)==="streaming"||i?void 0:{scale:.9},children:(0,t.jsx)(nf.RefreshCwIcon,{className:"size-5"})})})},"regenerate"),s&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(eW.ButtonWithTooltip,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":c("image-editor.download-image","Download Image"),tooltipContent:c("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===s.state||!s.url||d,onClick:p,children:(0,t.jsx)(ng.PopInOut,{children:d?(0,t.jsx)(t5.Spinner,{size:"xs"}):(0,t.jsx)(nx,{className:"size-5"})},d?"is-downloading":"download-icon")})},"download"),m&&h&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(np.ShareButton,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:m,responseId:h,iconProps:{size:20}})},"share"),o&&(0,t.jsx)(eW.Button,{"aria-label":c("iamge-editor.close","Close Image Editor"),variant:"ghostSecondary",size:"iconMd",rounded:!0,onClick:o,children:(0,t.jsx)(av.XIcon,{size:20})})]})]})})},nj=e=>{let{images:s,selectedImageId:a,onSelect:n}=e,i=(0,l.useRef)(null),r=(0,l.useRef)(null),o=(0,l.useRef)(0);return(0,l.useEffect)(()=>{if(s.length>0&&i.current&&a){let e=i.current,t=e.querySelector('[data-image-id="'.concat(a,'"]'));t&&!((e,t)=>{let s={left:t.scrollLeft,top:t.scrollTop,right:t.scrollLeft+t.clientWidth,bottom:t.scrollTop+t.clientHeight},a={left:e.offsetLeft,top:e.offsetTop,right:e.offsetLeft+e.offsetWidth,bottom:e.offsetTop+e.offsetHeight};return a.left>=s.left&&a.right<=s.right&&a.top>=s.top&&a.bottom<=s.bottom})(t,e)&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},[s.length,a,s]),(0,l.useEffect)(()=>{let e=e=>{if(0===s.length||!a||document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||"DIV"===document.activeElement.tagName))return;let t=s.findIndex(e=>e.id===a);if(-1===t)return;let i=t;switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),i=t>0?t-1:s.length-1;break;case"ArrowRight":case"ArrowDown":e.preventDefault(),i=t<s.length-1?t+1:0;break;default:return}let l=Date.now();if(l-o.current>=150){o.current=l;let e=s[i];e&&n(e)}else r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{o.current=Date.now();let e=s[i];e&&n(e)},150-(l-o.current))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),r.current&&clearTimeout(r.current)}},[s,a,n]),(0,t.jsx)(t2.motion.aside,{ref:i,className:"flex @lg:flex-col @lg:max-h-full @lg:w-auto w-fit max-w-full h-auto overflow-auto items-center justify-start gap-2 z-30 px-4 py-1 @lg:px-1 @lg:py-4",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:s.map(e=>(0,t.jsx)(t2.motion.button,{"data-image-id":e.id,className:(0,ee.cn)("size-20 shrink-0 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":e.id===a}),onClick:()=>n(e),whileTap:e.id!==a?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0},selected:{scale:1.05,opacity:1,transition:{duration:.15}}},initial:"hidden",animate:e.id===a?"selected":"visible",exit:"hidden",children:(0,t.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,t.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3] pointer-events-none",children:(0,t.jsx)(ni.GrokImage,{isModerated:e.isModerated,status:"streaming"===e.state?"streaming":"finished",iconSize:24,intermediateResults:"streaming"===e.state?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var ny=e.i(889963),nb=e.i(211550),nw=e.i(57779),nk=e.i(659065);let nN=e=>{let{selectedImage:s,isSending:a,isStreaming:n,onSend:i}=e,{editImagePresets:r}=(0,ny.useEditImagePresets)(),o=(0,eh.useMobileSize)(),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)(null),h=(0,l.useMemo)(()=>!s||n||a,[n,a,s]),p=(0,l.useCallback)(e=>{d(t=>t===e?null:e)},[d]),f=(0,l.useCallback)(e=>{if(s&&!n&&!a)return d(null),i(e.prompt,e.presetId)},[n,s,a,i]),x=(0,l.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let s=t.getBoundingClientRect();return s.right+12+200>window.innerWidth?{left:s.left-200-12,top:s.top+(s.height-150)/2}:{left:s.right+12,top:s.top+(s.height-150)/2}},[]);return(0,l.useEffect)(()=>{if(!c||o)return void m(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&m(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[c,o]),(0,t.jsx)("div",{className:"flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:r.map((e,s)=>(0,t.jsx)(t2.motion.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*s},className:"bg-surface-base rounded-full",children:o?(0,t.jsxs)(nk.Drawer,{open:e.category===c,onOpenChange:t=>{t?d(e.category):d(null)},children:[(0,t.jsx)(nk.DrawerTrigger,{disabled:h,asChild:!0,children:(0,t.jsx)(nC,{category:e,disabled:h})}),(0,t.jsxs)(nk.DrawerContent,{className:"max-h-[90dvh]",children:[(0,t.jsx)(nk.DrawerHeader,{children:(0,t.jsxs)(nk.DrawerTitle,{className:"flex items-center justify-center gap-2",children:[e.icon&&l.default.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,t.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,t.jsxs)(eW.Button,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>f(e),children:[e.icon&&l.default.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,t.jsxs)(tx.DropdownMenu,{open:e.category===c,onOpenChange:()=>p(e.category),children:[(0,t.jsx)(tx.DropdownMenuTrigger,{disabled:h,asChild:!0,children:(0,t.jsx)(nC,{category:e,disabled:h})}),(0,t.jsx)(tx.DropdownMenuContent,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onMouseLeave:()=>{m(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(s=>(0,t.jsxs)(tx.DropdownMenuItem,{"data-preset-id":s.presetId,className:"flex items-center gap-2",onSelect:()=>f(s),children:[s.icon&&l.default.createElement(s.icon,{size:16,className:"text-secondary flex-shrink-0"}),s.label,u===s.presetId&&(0,nw.createPortal)((0,t.jsxs)(t2.motion.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:x(s.presetId),children:[(0,t.jsx)(nl.ImageLoader,{className:"absolute inset-0"}),s.previewUrl&&(0,t.jsx)(nb.default,{src:s.previewUrl,alt:s.presetId,width:200,height:150,priority:!o&&c===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},s.presetId))})]})},e.category))})},nC=l.default.forwardRef((e,s)=>{let{category:a,disabled:n,...i}=e;return(0,t.jsxs)(eW.Button,{ref:s,size:"md",variant:"filledSecondary",rounded:!0,className:(0,ee.cn)(!n&&"*:hover:text-primary transition-all"),disabled:n,...i,children:[a.icon&&l.default.createElement(a.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,t.jsx)("span",{children:a.label})]})});var nS=e.i(410594),nI=e.i(939574);let nT=e=>{let{selectedImage:s,isSending:a,isStreaming:n,isWaitingForResponse:i,isAborting:r,inputValue:o,onInputValueChange:c,onSend:d,onAbort:u}=e,{t:m}=(0,R.useTranslation)("base"),h=(0,l.useRef)(null),p=(0,l.useRef)(null),f=(0,l.useMemo)(()=>n||a||i,[n,a,i]),x=(0,l.useMemo)(()=>!a&&!i&&!n&&!!o.trim(),[a,o,n,i]);(0,l.useEffect)(()=>{if(!f&&p.current){let e=setTimeout(()=>{var e;null==(e=p.current)||e.focus()},50);return()=>clearTimeout(e)}},[f]);let g=(0,l.useCallback)(e=>{var t;e.preventDefault(),!f&&o.trim()&&(d(o),null==(t=p.current)||t.focus())},[d,f,o]),v=(0,l.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=h.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,t.jsxs)("form",{className:(0,ee.cn)("w-full rounded-[32px] p-3 bg-surface-l2 shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset"),onSubmit:g,ref:h,children:[(0,t.jsx)(t1.AnimatePresence,{children:f&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1}},className:"pb-1.5 -ml-0.5",children:(0,t.jsx)(nI.MessageLoadingIndicator,{})},"loading-indicator")}),(0,t.jsx)(eK.default,{ref:p,className:(0,ee.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5 transition-all outline-transparent",f&&"animate-pulse"),onChange:e=>c(e.target.value),value:f?"":o,placeholder:f?m("image-editor.generating","Generating"):s?m("image-editor.describe-edits","Describe your edits"):m("image-editor.describe-image","Describe the image you want"),minRows:1,onKeyDown:v,disabled:f,name:"query",maxRows:5}),(0,t.jsx)("div",{className:(0,ee.cn)("ms-auto flex flex-row items-end gap-1"),children:f?(0,t.jsx)(t2.motion.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,ee.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),disabled:r,onClick:e=>{e.preventDefault(),u()},children:(0,t.jsx)("div",{className:(0,ee.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,t.jsx)(nS.Square,{size:20})})}):(0,t.jsx)(t2.motion.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:s?{scale:1.1}:void 0,whileTap:s?{scale:.95}:void 0,className:(0,ee.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":m("image-editor.submit","Submit"),disabled:!x,children:(0,t.jsx)("div",{className:(0,ee.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",x?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,t.jsx)(eQ.ArrowUpIcon,{size:20,className:"relative"})})})})]})},nM=e=>{let{images:s,selectedImage:a,title:n,inputValue:i,queryBarPosition:r="bottom",onInputValueChange:o,hideHeader:c=!1,hideQueryBar:d=!1,isAborting:u=!1,isSending:m=!1,isStreaming:h=!1,isWaitingForResponse:p=!1,onImageSelect:f,onSendQuery:x,onRegenerate:g,onAbort:v,onImageUpload:j,onClose:y}=e,{t:b}=(0,R.useTranslation)("base"),[w,k]=(0,e2.useLocalStorage)("image-editor-first-open",!0),[N,C]=(0,l.useState)(!1),[S,I]=(0,l.useState)(!1),[T,M]=(0,l.useState)(!1),P=(0,l.useMemo)(()=>a?(0,t.jsx)(nr,{selectedImage:a,isPeekingParent:N,setIsPeekingParent:C,isParentImageLoaded:S,isFinalImageLoaded:T,setIsFinalImageLoaded:M,setIsParentImageLoaded:I}):null,[a,N,S,T]),E=(0,l.useMemo)(()=>"center"===r&&!h&&!a&&!p&&!d,[r,h,a,p,d]);return(0,l.useEffect)(()=>{if(null==a?void 0:a.url){M(!1);let e=new Image;e.onload=()=>M(!0),e.src=a.url}},[null==a?void 0:a.url]),(0,l.useEffect)(()=>{if(null==a?void 0:a.parentImageUrl){I(!1);let e=new Image;e.onload=()=>I(!0),e.src=null==a?void 0:a.parentImageUrl}},[null==a?void 0:a.parentImageUrl]),(0,l.useEffect)(()=>{w&&(k(!1),eB.toast.message((0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-fg-primary font-bold",children:b("image-editor-welcome.title","Welcome to Image Editor")}),(0,t.jsx)("p",{className:"text-fg-secondary",children:b("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[w,k,b]),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-between w-full h-full relative @container",children:[(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-col gap-8 w-full mb-6 sm:mb-10",{"sm:mb-0":c&&!a}),children:[!c&&(0,t.jsx)(nv,{selectedImage:a,title:n,isSending:m,onRegenerate:g||(()=>{}),onClose:y}),a&&s.length>1&&(0,t.jsxs)("div",{className:"w-full h-[88px] @lg:h-auto relative @lg:absolute @lg:w-auto @lg:right-0 @lg:bottom-0 @lg:top-14 grid place-items-center @lg:mx-0",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 -right-3 bg-gradient-to-l w-8 @lg:bottom-auto @lg:right-0 @lg:left-0 @lg:w-full @lg:-top-3 @lg:h-8 @lg:bg-gradient-to-b from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),(0,t.jsx)("div",{className:"absolute inset-y-0 -left-3 bg-gradient-to-r w-8 @lg:top-auto  @lg:right-0 @lg:left-0 @lg:w-full @lg:-bottom-3 @lg:h-8 @lg:bg-gradient-to-t from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),s.length>1&&(0,t.jsx)(nj,{images:s,selectedImageId:a.id,onSelect:f||(()=>{})})]})]}),p||h&&!a?(0,t.jsx)(nl.ImageLoader,{}):a?P:(0,t.jsx)("div",{className:"w-full h-full max-w-7xl",children:(0,t.jsx)(nh,{onUploadImage:j||(()=>{}),children:E&&(0,t.jsx)("div",{className:"w-full max-w-xl",children:(0,t.jsx)(nT,{selectedImage:a,isWaitingForResponse:p,isStreaming:h,isSending:m,isAborting:u,inputValue:i||"",onInputValueChange:o||(()=>{}),onSend:x||(()=>{}),onAbort:v||(()=>{})})})})}),!E&&(0,t.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-20",children:(0,t.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[!!a&&(0,t.jsx)(nN,{isStreaming:h,isSending:m,selectedImage:a,onSend:x||(()=>{})}),!d&&(0,t.jsx)(nT,{selectedImage:a,isWaitingForResponse:p,isSending:m,isStreaming:h,isAborting:u,inputValue:i||"",onInputValueChange:o||(()=>{}),onSend:x||(()=>{}),onAbort:v||(()=>{})})]})})]})};var nP=e.i(593522);let nE=()=>{let{push:e}=(0,er.useRouting)(),{t:s}=(0,R.useTranslation)("base"),{ASSET_SERVER_URL:n}=(0,ec.useEnvironment)(),i=(0,ep.useFeatureFlags)(),r=(0,si.useLogEvent)(),o=(0,s3.useFilesPageStore)(e=>e.loadRecent),c=(0,a.useChatPageStore)(eU.prop("streamedMessageId")),d=(0,a.useChatPageStore)(eU.prop("setConversationId")),u=(0,a.useChatPageStore)(eU.prop("setStreamedMessageId")),m=(0,ns.useResponseStore)(eU.prop("byId")),h=(0,ns.useResponseStore)(e=>e.byId[null!=c?c:""]),[p,f]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1),[v,j]=(0,l.useState)(""),[y,b]=(0,l.useState)([]),[w,k]=(0,l.useState)(null),[N,C]=(0,l.useState)(!1),[S,I]=(0,l.useState)(!1),[T,M]=(0,l.useState)(!1),P=(0,l.useMemo)(()=>y.find(e=>e.id===w)||null,[y,w]),E=(0,l.useCallback)(e=>{let t=ns.useResponseStore.getState().byId[e.parentResponseId||""],a="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(i=>{let[l,r]=i,o=Object.keys(r).map(Number),c=r[Math.max(...o)];return{id:l,url:(0,ew.getAssetUrl)(n,null==c?void 0:c.imageUrl),state:a?"streaming":"completed",isModerated:!1,title:(null==t?void 0:t.imageEditUri)?s("image-editor.edited-image","Edited image"):s("image-editor.generated-image","Generated image"),description:null==t?void 0:t.message,regenResponseId:null==t?void 0:t.responseId,progressMap:a?o.map(e=>{var t;let s=(0,ew.getAssetUrl)(n,null==(t=r[e])?void 0:t.imageUrl);return s?{progress:e/100,imageUrl:s}:null}).filter(e=>null!==e):void 0,generatedImageWidth:a?e.generatedImageWidth:void 0,generatedImageHeight:a?e.generatedImageHeight:void 0}})},[n,s]),z=(0,l.useCallback)(e=>{e.length&&b(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===w)){var s;k((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[b,w]),D=(0,l.useCallback)(t=>{var s;let{image:a,type:n}=t;return"upload"===n?r("image_editor_upload",void 0,{location:"empty-image-workbench"}):"draw"===n&&r("image_editor_draw",void 0,{location:"empty-image-workbench"}),e({page:"files",fileId:null!=(s=a.fileMetadataId)?s:null,emptyView:"default"}),o()},[e,o,r]),A=(0,l.useCallback)(()=>{e({page:"files",fileId:null,emptyView:"default"})},[e]),L=(0,l.useCallback)(e=>{let t=ef.useSettingsStore.getState(),s=a.useChatPageStore.getState();return"none"!==s.reasoningMode&&s.setReasoningMode("none"),r("image_editor_generate",void 0,{location:"empty-image-workbench",message:e,messageLength:String(e.length)}),f(!0),I(!1),M(!0),j(""),s.establishNewConversation({...{message:e,toolOverrides:{imageGen:!0},enableRetries:!0},temporary:t.isIncognito,disableToolComposer:!0,toolOverrides:{imageGen:!0},ff:i})},[i,j,r]),F=(0,l.useCallback)(async e=>(g(!0),e().then(()=>{d(void 0),u(void 0),f(!1),b([]),k(null),C(!1)}).finally(()=>{g(!1)})),[d,u]),_=(0,nt.useHandleAbort)("empty-image-workbench:handleAbort",F),B=(0,l.useCallback)(()=>{T&&(M(!1),eB.toast.error(s("image-editor.failed-to-generate","Failed to generate image"))),d(void 0),f(!1),g(!1),b([]),k(null),C(!1)},[s,d,T]);return(0,l.useEffect)(()=>{if(!S)if(h&&"streaming"===h.state){let e=E(h);if(!h.imageAttachmentCount||e.length||N)(null==e?void 0:e.length)&&(z(e),f(!1));else{let e=Array.from({length:h.imageAttachmentCount}).map((e,t)=>({id:"optimistic-streaming-image-".concat(t),url:"",state:"streaming",isModerated:!1,title:s("image-editor.generated-image","Generated image"),description:h.message,progressMap:[],generatedImageWidth:h.generatedImageWidth,generatedImageHeight:h.generatedImageHeight}));b(t=>[...t,...e]),e[0]&&k(e[0].id),C(!0)}}else if(h&&("error"===h.state||h.error))B();else{C(!1);let s=[];if(h&&"closed"===h.state){var t,a,n,i,l;s=E(h);let r=null==(i=h.streamingImageById)||null==(a=i[null!=(l=null==(n=Object.keys(h.streamingImageById||{}))?void 0:n[0])?l:""])||null==(t=a[100])?void 0:t.assetId;s.length>0&&!S&&r&&(I(!0),o().then(()=>(d(void 0),u(void 0),e({page:"files",fileId:r}))).catch(B))}z(s)}},[h,E,z,b,s,p,N,w,m,S,B,e,o,d,u]),(0,t.jsx)(na.PanelGroup,{direction:"horizontal",autoSaveId:"workbench",className:"bg-surface-l1 dark:bg-surface-inset",children:(0,t.jsx)(na.Panel,{order:1,minSize:50,defaultSize:100,className:"flex flex-col max-h-[100vh] h-[100vh]",children:(0,t.jsxs)("div",{className:"flex flex-col h-full max-h-full",children:[(0,t.jsx)("div",{className:"h-12 min-h-12 flex items-center justify-end px-4",children:(0,t.jsx)(X.Button,{"aria-label":s("image-editor.close","Close Image Editor"),shape:"square",variant:"tertiary",size:"sm",onClick:A,children:(0,t.jsx)(av.XIcon,{className:"size-5"})})}),(0,t.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,t.jsx)("div",{className:"w-full max-w-full relative h-full max-h-full",children:(0,t.jsx)(nn.ErrorBoundary,{fallbackRender:()=>(0,t.jsx)(nP.FileError,{}),children:(0,t.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full bg-surface-l1 dark:bg-surface-inset",children:(0,t.jsx)(nM,{queryBarPosition:"center",isStreaming:!!h&&"streaming"===h.state,selectedImage:P,images:y,isWaitingForResponse:p,isAborting:x,inputValue:v,hideHeader:!0,onImageSelect:e=>k(e.id),onInputValueChange:j,onSendQuery:L,onImageUpload:D,onAbort:_,onClose:A})})})})})]})})})};var nz=e.i(117521),nD=e.i(505784),nR=e.i(233833),nA=e.i(271109),nL=e.i(972150),nF=e.i(196978),n_=e.i(237065),nB=e.i(330477),nG=e.i(96889),nW=e.i(137278);function nU(e){let{asset:s,size:a="sm"}=e,{t:n}=(0,R.useTranslation)("files"),i=(0,nW.useWorkspaceStore)(e=>e.listStatus),r=(0,nW.useWorkspaceStore)(e=>e.loadFirstPage);(0,l.useEffect)(()=>{"ready"!==i&&r()},[i,r]);let o=(0,nW.useWorkspacesList)(),{add:c}=(0,n_.useAddWorkspace)(),d=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),c().catch((0,D.createLogError)("add-to-workspace-button:create-workspace"))},[c]);return(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(X.ButtonWithTooltip,{variant:"tertiary",shape:"square",size:a,tooltipContent:n("add-to-project-button.tooltip","Add to Project"),children:(0,t.jsx)(ay.FolderIcon,{size:18})})}),(0,t.jsxs)(tx.DropdownMenuContent,{className:"w-[250px] p-2 rounded-3xl flex flex-col gap-0.5",sideOffset:0,children:[!(null==o?void 0:o.length)&&(0,t.jsx)(nF.EmptyPopoverContent,{content:n("No projects yet","No projects yet"),ctaText:n("Create Project","Create Project"),onClickCta:d},"no-workspaces"),o.length&&(0,t.jsx)("div",{className:(0,ee.cn)("py-1 pl-2 text-sm text-secondary font-semibold sticky top-0"),children:n("add-to-project-menu-item","Add to Project")}),o.map(e=>(0,t.jsx)(nO,{workspaceId:e.workspaceId,asset:s},e.workspaceId))]})]},"add-to-workspace-button")}function nO(e){var s;let{workspaceId:a,asset:n}=e,i=(0,si.useLogEvent)(),r=(0,nW.useWorkspaceStore)(e=>{var t;return null==(t=e.byId[a])?void 0:t.data}),{mutate:o,error:c}=(0,nG.useAttachWorkspaceAsset)(a);(0,sF.useRequestErrorToast)("attach-dropdown:attachAsset",c);let{data:d}=(0,nG.useWorkspaceAssets)(a),u=null==d||null==(s=d.assets)?void 0:s.some(e=>e.assetId===n.assetId),m=(0,l.useCallback)(e=>{n.assetId&&(o({assetId:n.assetId}),i("add_to_workspace",void 0,{location:"add-to-workspace-button",workspaceId:a,assetId:n.assetId}))},[o,n,i,a]);return(0,t.jsxs)(X.Button,{className:(0,ee.cn)(nR.SIDEBAR_MENU_ITEM_CLASS,"rounded-2xl"),variant:"tertiary",size:"md",shape:"rectangle",onClick:m,disabled:u,children:[(0,t.jsx)(nB.WorkspaceIcon,{icon:null==r?void 0:r.icon,sizeClass:"size-4",rounded:!0,buttonSize:"iconXs",disabled:!0}),(0,t.jsx)("span",{className:(0,ee.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden text-left"),style:{maskImage:Y.RIGHT_MASK_IMAGE,WebkitMaskImage:Y.RIGHT_MASK_IMAGE},children:null==r?void 0:r.name})]})}var nq=e.i(65992),nV=e.i(534661),nH=e.i(190425),nK=e.i(210574),nQ=e.i(993706);e.i(266636);var nY=e.i(988333),nX=e.i(102598),n$=e.i(979915),nZ=e.i(469662),nJ=e.i(291411),n0=e.i(290119),n1=e.i(907736);function n2(e){let{mode:s,setMode:a}=e,{t:n}=(0,R.useTranslation)("chat");return(0,t.jsx)(n0.Tabs,{className:"flex-1 flex-row justify-start flex no-a11y-check",defaultValue:"code",value:s,onValueChange:e=>a(e),children:(0,t.jsxs)(n0.TabsList,{children:[(0,t.jsxs)(n0.TabsTrigger,{className:"gap-1",value:"code","aria-label":n("Code","Code"),children:[(0,t.jsx)(n1.Code,{className:"size-4"}),(0,t.jsx)("span",{className:"hidden md:inline",children:n("Code","Code")})]}),(0,t.jsx)(n0.TabsTrigger,{className:"gap-1",value:"preview","aria-label":n("Preview","Preview"),children:(0,t.jsx)("span",{className:"hidden md:inline",children:n("Preview","Preview")})})]})})}var n5=e.i(201222);let n4=e=>{let{mimetype:s,content:a}=e;if("text/html"===s)return(0,t.jsx)(n5.IFrame,{srcDoc:a,autofocus:!0})};var n3=e.i(211987),n8=e.i(132841);let n6={size:18,strokeWidth:2};e.i(282517);var n9=e.i(936980),n7=e.i(592766),ie=(0,e.i(738417).default)(function(e,t){return t instanceof e||null!=t&&(t.constructor===e||"Object"===e.name&&"object"==typeof t)});function it(e){return null!=e}var is=e.i(819316),ia=e.i(320079),ii=e.i(763805);let il={size:18,strokeWidth:2};var ir=e.i(415965);e.i(998681);var io=e.i(419118),ic=e.i(376098),id=e.i(596222);let iu={size:18,strokeWidth:2};var im=e.i(221474),ih=e.i(355524),ip=e.i(487585);function ix(e){let{asset:s}=e,a=(0,s2.convertAssetMetadataToFileMetadata)(s),{t:n}=(0,R.useTranslation)("files"),{ASSET_SERVER_URL:i}=(0,ec.useEnvironment)(),r=(0,si.useLogEvent)(),o=(0,l.useCallback)(()=>{var e,t,a,n,l;r("file_content_download_click",void 0,{location:"unknown-workbench",contentType:null!=(t=s.mimeType)?t:"unknown",assetId:null!=(a=s.assetId)?a:"",assetName:null!=(n=s.name)?n:"",assetSize:null!=(l=null==(e=s.sizeBytes)?void 0:e.toString())?l:""});let o=(0,ew.getAssetUrl)(i,s.key);if(!o)return;let c=document.createElement("a");c.href=o,c.download="file",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(o)},[r,i,s]),c=n("read-only-indicator-tooltip","Grok can't edit this type of file but can still answer questions about it");return(0,t.jsx)(nZ.WorkbenchWithChatLayout,{editor:(0,t.jsx)(im.ChatAssetViewer,{hideEdit:!0,fileMetadata:a,onClose:()=>{},className:"border-none shadow-none max-w-none"}),assetId:s.assetId,conversationId:s.currentConversationId,editorHeader:(0,t.jsx)(nQ.AssetTitle,{asset:s}),headerButtons:[(0,t.jsx)(eW.ButtonWithTooltip,{tooltipContent:n("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:o,rounded:!0,variant:"ghost",size:"iconSm","aria-label":n("Download to file","Download to file"),children:(0,t.jsx)(ic.DownloadIcon,{strokeWidth:2,size:18})},"download-button")],chat:(0,t.jsx)(nY.Conversation,{asset:s}),chatHeader:(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("div",{className:"text-secondary",children:n("files-tab-conversation-header","File Chat")}),(0,t.jsxs)(ih.Tooltip,{children:[(0,t.jsx)(ih.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{"aria-label":c,children:(0,t.jsx)(ip.PencilOff,{className:"w-4 h-4"})})}),(0,t.jsx)(ih.TooltipContent,{children:c})]})]})})}let ig={markdown:function(e){var s;let{asset:a}=e,{t:n}=(0,R.useTranslation)("files"),i=(0,n8.useIsActiveGrokBusinessSession)(),[r,o]=(0,l.useState)(!1),{content:c,setContent:d,error:u,isEditing:m,refetch:h}=(0,nK.useAssetTextContent)(a,r),{handleCopy:p,copyPressed:f,handleDownload:x,shareLoading:g,handleShare:v,sharePressed:j}=(0,nX.useFileActions)({assetId:a.assetId,content:null!=c?c:"",filename:null!=(s=a.name)?s:"file"}),{activeArtifact:y,isEditing:b,onSetActiveArtifact:w}=(0,n$.useModelEdits)({content:null!=c?c:void 0});(0,l.useEffect)(()=>{o(b)},[b]);let k=(0,ia.useTiptapEditor)({content:c,isEditable:!0,onUpdate:d});return null==c?(0,t.jsxs)("div",{className:"flex flex-col w-full h-full p-4",children:[(0,t.jsx)(eb.Skeleton,{className:"w-[30%] h-6"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsx)(eb.Skeleton,{className:"w-24 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4 w-full h-full justify-center items-center py-[10%]",children:(0,t.jsxs)("div",{className:"flex flex-col h-full w-full max-w-3xl gap-2",children:[(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl mb-2 h-8"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-sm h-6"})]})})]}):u?(0,t.jsx)(nP.FileError,{onRetryRequested:h}):(0,t.jsx)(nZ.WorkbenchWithChatLayout,{editor:(0,t.jsxs)("div",{className:(0,ee.cn)("no-a11y-check h-full overflow-auto max-w-full relative prose bg-surface-l1 dark:bg-surface-inset","\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-primary/20\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-3xl\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:font-bold\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:content-[attr(data-placeholder)]\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:float-left\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:h-0\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:pointer-events-none\n"),children:[k&&null!==c?(0,t.jsx)(is.MarkdownEditor,{editor:k,content:c,editable:!m,className:"max-w-3xl h-full justify-self-center"}):null,m?(0,t.jsx)("div",{className:"sticky overflow-visible bottom-4 start-0 w-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-primary bg-surface-l1 px-4 py-2 rounded-full h-10 border border-border",children:[(0,t.jsx)(t5.Spinner,{size:"sm"}),(0,t.jsx)("span",{children:n("files.editing-by-model","Editing...")})]})}):null]}),assetId:a.assetId,conversationId:a.currentConversationId,editorHeader:(0,t.jsx)(nQ.AssetTitle,{asset:a}),editorSubheader:k?(0,t.jsx)(ii.FormattingTools,{editable:!0,editor:k}):null,headerButtons:[(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:n("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:p,shape:"square",variant:"tertiary",size:"sm","aria-label":n("Copy Contents","Copy Contents"),children:(0,t.jsx)(ng.PopInOut,{children:f?(0,t.jsx)(ae.CheckIcon,{size:18}):(0,t.jsx)(nq.CopyIcon,{size:18})},f?"copied":"copy")},"copy-button"),(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:n("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:x,shape:"square",variant:"tertiary",size:"sm","aria-label":n("Download to file","Download to file"),children:(0,t.jsx)(nx,{...il,size:18})},"download-button"),i?null:(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:n("Share file","Share file"),onClick:v,tooltipContentProps:{className:"text-xs"},shape:"square",variant:"tertiary",size:"sm","aria-label":n("Share file","Share file"),children:(0,t.jsx)(ng.PopInOut,{children:g?(0,t.jsx)(t5.Spinner,{size:"xs"}):j?(0,t.jsx)(ae.CheckIcon,{size:18}):(0,t.jsx)(nV.ShareIcon,{...il,size:18})},g?"share-loading":j?"shared":"share")},"share-button")],chat:(0,t.jsx)(nY.Conversation,{asset:a,activeArtifact:y,onArtifactSelected:w})})},csv:n9.CsvWorkbench,spreadsheet:function(e){var s;let{asset:a}=e,{t:n}=(0,R.useTranslation)("files"),i=(0,ep.useFeatureFlags)(),r=(0,s2.convertAssetMetadataToFileMetadata)(a),{ASSET_SERVER_URL:o}=(0,ec.useEnvironment)(),c=(0,s3.useFilesPageStore)(e=>e.setAssetContent),d=(0,s3.useAssetContentWithType)(null!=(s=a.assetId)?s:"","binary"),u=(0,s3.useFilesPageStore)(e=>e.fetchBinaryContent);(0,l.useEffect)(()=>{null==d&&a.assetId&&u(a.assetId,o)},[o,a.assetId,d,u]);let m=(0,l.useCallback)(e=>{var t;c(null!=(t=a.assetId)?t:"",e)},[a.assetId,c]),{handleDownload:h}=(e=>{let{file:t,content:s}=e,a=(0,si.useLogEvent)(),{ASSET_SERVER_URL:n}=(0,ec.useEnvironment)(),i=(0,ew.getAssetUrl)(n,t.fileUri);return{handleDownload:(0,l.useCallback)(()=>{if(i||s)if(a("file_content_download_click","",{location:"spreadsheet-workbench:useFileActions:handleDownload",contentType:t.fileMimeType}),s){let e=new Blob([s],{type:t.fileMimeType});(0,ar.downloadBlob)(e,t.fileName)}else i&&(0,ar.downloadUri)(i,t.fileName)},[a,i,s,t.fileName,t.fileMimeType])}})({file:r,content:d});if(!a.assetId)return(0,t.jsx)(nP.FileError,{});let p=a.rootAssetId||a.assetId;return(0,t.jsx)(nZ.WorkbenchWithChatLayout,{editor:(0,t.jsx)("div",{className:"flex flex-col h-full overflow-hidden",children:(0,t.jsx)(id.SpreadsheetStoreProvider,{id:p,initialState:{name:a.name||"Workbook"},content:d,readOnly:!i.ENABLE_XLSX_EDITING,children:void 0!==d?(0,t.jsx)(ir.SpreadsheetEditor,{readOnly:!i.ENABLE_XLSX_EDITING,onContentUpdate:m,className:"border-t border-border-l1",autoFocus:!0}):null},p)}),assetId:a.assetId,conversationId:a.currentConversationId,editorHeader:(0,t.jsx)(nQ.AssetTitle,{asset:a}),headerButtons:[(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:n("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:h,shape:"square",variant:"tertiary",size:"sm","aria-label":n("Download to file","Download to file"),disabled:!d,children:(0,t.jsx)(ic.DownloadIcon,{...iu,size:18})},"download-button")],chat:(0,t.jsx)(nY.Conversation,{asset:a,restrictedModel:io.GROK_3_MODEL_ID})})},image:function(e){let{asset:s}=e,{t:n}=(0,R.useTranslation)("base"),{ASSET_SERVER_URL:i}=(0,ec.useEnvironment)(),r=(0,ep.useFeatureFlags)(),[o]=(0,e2.useLocalStorage)("files-tab-is-chat-open",!0),c=(0,si.useLogEvent)(),{handleEditorOpen:d,consumeEditorTimeMs:u}=(0,n7.useImageEditingMetrics)(),{editImagePresets:m}=(0,ny.useEditImagePresets)(),h=(0,s3.useFilesPageStore)(e=>e.loadRecent),p=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.assetsById)),f=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.listStatus)),x=(0,ns.useResponseStore)(eU.prop("byId")),g=(0,a.useChatPageStore)(eU.prop("conversationId")),v=(0,a.useChatPageStore)(eU.prop("streamedMessageId")),j=(0,a.useChatPageStore)(eU.prop("queryByConversationId")),y=(0,a.useChatPageStore)(eU.prop("idsetQueryByConversationId")),[b,w]=(0,l.useState)(!1),[k,N]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),[I,T]=(0,l.useState)(!1),[M,P]=(0,l.useState)(null),[E,z]=(0,l.useState)(null),[A,L]=(0,l.useState)([]),[F,_]=(0,l.useState)(null),[B,G]=(0,l.useState)(null),W=(0,l.useRef)(null),U=(0,l.useMemo)(()=>{if(!s.currentConversationId)return[];let e=[];return Object.values(p).map(e=>null==e?void 0:e.data).filter(it).forEach(t=>{var a;(null==(a=t.mimeType)?void 0:a.startsWith("image/"))&&t.sourceConversationId===s.currentConversationId&&e.push(t)}),e.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime())},[s,p]),O=g||"no_conversation_id",q=j[O],V=(0,l.useCallback)(e=>y(e,O),[O,y]),H=(0,l.useMemo)(()=>A.find(e=>e.id===E)||null,[A,E]),K=(0,l.useMemo)(()=>{let e=U.find(e=>e.assetId===M);return e||s},[s,M,U]),Q=(0,ns.useResponseStore)(e=>e.byId[null!=v?v:""]),Y=(0,l.useCallback)(e=>{let t="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(s=>{let[a,n]=s,l=Object.keys(n).map(Number),r=n[Math.max(...l)];return{id:a,url:(0,ew.getAssetUrl)(i,null==r?void 0:r.imageUrl),state:t?"streaming":"completed",isModerated:!1,responseId:e.responseId,progressMap:t?l.map(e=>{var t;return{progress:e/100,imageUrl:(0,ew.getAssetUrl)(i,null==(t=n[e])?void 0:t.imageUrl)}}):void 0,generatedImageWidth:t?e.generatedImageWidth:void 0,generatedImageHeight:t?e.generatedImageHeight:void 0}})},[i]),$=(0,l.useCallback)(e=>{e.length&&L(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===E)){var s;z((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[L,E]),Z=(0,l.useCallback)(e=>{if(!H)return;let t=ns.useResponseStore.getState(),s=ef.useSettingsStore.getState(),n=a.useChatPageStore.getState(),i=n.lastMessageId?t.byId[n.lastMessageId]:void 0;if(n.lastMessageId&&!i)throw Error("Last message is missing");"none"!==n.reasoningMode&&n.setReasoningMode("none");let l={message:e,toolOverrides:{imageGen:!0},imageEditUri:H.url?H.url.replace(/^https?:\/\/[^/]+\/?/,""):void 0,enableRetries:!0};if(H.url){let t=m.flatMap(e=>e.presets).find(t=>t.prompt===e);c("edit_image_start",(0,n7.formatImageEditUri)(H.url),{queryType:t?"preset":"manual",location:"image-workbench",presetId:(null==t?void 0:t.presetId)||"",message:e,messageLength:String(e.length)})}return N(!0),V(""),n.conversationId?n.sendResponse({...l,parentResponseId:n.lastMessageId,conversationId:n.conversationId,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[K.assetId],ff:r}):n.establishNewConversation({...l,temporary:s.isIncognito,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[K.assetId],ff:r})},[H,r,V,K.assetId,c,m]),J=(0,l.useCallback)(async e=>(S(!0),e().finally(()=>{S(!1)})),[]),ee=(0,nt.useHandleAbort)("image-workbench:handleAbort",J),et=(0,l.useCallback)(()=>{var e;!b&&(null==H?void 0:H.url)&&(w(!0),(0,tv.downloadImage)(H.url,null==(e=H.url)?void 0:e.split("/").pop()).catch((0,D.createLogError)("image-editor:handleDownload")).finally(()=>w(!1)))},[b,H]),es=(0,l.useCallback)(()=>{W.current&&(c("image_editor_close",void 0,{timeInEditorMs:String(u()),location:"image-workbench"}),W.current=null)},[u,c]);(0,l.useEffect)(()=>{if(Q&&"streaming"===Q.state&&Q.conversationId===g){let e=Y(Q);if(!Q.imageAttachmentCount||e.length||I)(null==e?void 0:e.length)&&($(e),N(!1));else{let e=Array.from({length:Q.imageAttachmentCount}).map((e,t)=>({id:"optimistic-streaming-image-".concat(t),url:"",state:"streaming",isModerated:!1,responseId:Q.responseId,progressMap:[],generatedImageWidth:Q.generatedImageWidth,generatedImageHeight:Q.generatedImageHeight}));L(t=>[...t,...e]),e[0]&&z(e[0].id),T(!0)}}else{N(!1),T(!1);let e=[];Q&&"closed"===Q.state&&!Q.error&&Q.conversationId===g&&(e=Y(Q),F!==Q.responseId&&(_(Q.responseId),h().catch((0,D.createLogError)("image-editor:loadRecent")))),Q&&("error"===Q.state||Q.error)||!Q?L(e=>{if(!e.find(e=>e.id.includes("optimistic-streaming-image")))return e;{let s=e.filter(e=>!e.id.includes("optimistic-streaming-image"));if(!s.some(e=>e.id===E)){var t;z((null==(t=s[s.length-1])?void 0:t.id)||null)}return s}}):$(e)}},[Q,Y,$,L,n,k,I,x,E,h,F,s.assetId,U,g]);let ea=(0,l.useCallback)(async()=>{let e=ns.useResponseStore.getState();if(s.currentConversationId){let t=[null==s?void 0:s.responseId,...U.map(e=>null==e?void 0:e.responseId)].filter(ie(String)),a=await e.loadResponses(s.currentConversationId,t),n=a.find(e=>(null==e?void 0:e.responseId)===(null==s?void 0:s.responseId)),l=n?e.byId[n.parentResponseId||""]:void 0,r=(0,s2.convertAssetMetadataToFileMetadata)(s);return[{id:s.assetId||"",state:"completed",isModerated:!1,url:(0,ew.getAssetUrl)(i,r.fileUri||""),responseId:s.responseId,parentImageUrl:(null==l?void 0:l.imageEditUri)?(0,ew.getAssetUrl)(i,l.imageEditUri):void 0},...U.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime()).map(e=>{let t=(0,s2.convertAssetMetadataToFileMetadata)(e),s=a.find(t=>(null==t?void 0:t.responseId)===(null==e?void 0:e.responseId)),n=s?a.find(e=>(null==e?void 0:e.responseId)===(null==s?void 0:s.parentResponseId)):void 0;return{id:e.assetId||"",state:"completed",isModerated:!1,url:(0,ew.getAssetUrl)(i,t.fileUri||""),responseId:e.responseId,parentImageUrl:(null==n?void 0:n.imageEditUri)?(0,ew.getAssetUrl)(i,n.imageEditUri):void 0}})]}if(s.sourceConversationId){let t=[null==s?void 0:s.responseId].filter(ie(String)),a=await e.loadResponses(s.sourceConversationId,t),n=(0,s2.convertAssetMetadataToFileMetadata)(s),l=a.find(e=>(null==e?void 0:e.responseId)===(null==s?void 0:s.responseId)),r=l?a.find(e=>(null==e?void 0:e.responseId)===(null==l?void 0:l.parentResponseId)):void 0;return[{id:s.assetId||"",state:"completed",isModerated:!1,url:(0,ew.getAssetUrl)(i,n.fileUri||""),responseId:s.responseId,parentImageUrl:(null==r?void 0:r.imageEditUri)?(0,ew.getAssetUrl)(i,r.imageEditUri):void 0}]}{let e=(0,s2.convertAssetMetadataToFileMetadata)(s);return[{id:s.assetId||"",state:"completed",isModerated:!1,url:(0,ew.getAssetUrl)(i,e.fileUri||""),responseId:s.responseId}]}},[i,s,U]),en=(0,l.useCallback)(e=>{var t;if(A.some(t=>t.id===E&&t.responseId===e))return;let s=null==(t=A.find(t=>t.responseId===e))?void 0:t.id;s&&z(s)},[A,E]);return(0,l.useEffect)(()=>{s.assetId&&s.assetId!==B&&"ready"===f&&(W.current&&W.current!==s.assetId&&es(),G(s.assetId),ea().then(e=>{L(e),s.assetId&&(z(s.assetId),W.current=s.assetId),_(null),T(!1),N(!1),S(!1),d(),c("image_editor_open",s.assetId,{location:"image-workbench"})}).catch((0,D.createLogError)("image-editor:getInitialImages")))},[s.assetId,f,B,ea,d,es,c]),(0,l.useEffect)(()=>{if(E&&E!==M){if(E===s.assetId||U.some(e=>e.assetId===E))P(E);else if(null==H?void 0:H.responseId){var e,t,a;let s=x[(null==H?void 0:H.responseId)||""],n=null==s||null==(a=s.streamingImageById)||null==(t=a[E])||null==(e=t[100])?void 0:e.assetId;n&&P(n)}}},[E,M,s.assetId,U,x,H]),(0,l.useEffect)(()=>()=>{es()},[es]),(0,t.jsx)(nZ.WorkbenchWithChatLayout,{editor:(0,t.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full",children:(0,t.jsx)(nM,{hideHeader:!0,hideQueryBar:o,isStreaming:Q&&"streaming"===Q.state,selectedImage:H,images:A,isWaitingForResponse:k||!H,isAborting:C,inputValue:q,onInputValueChange:V,onImageSelect:e=>z(e.id),onSendQuery:Z,onAbort:ee})}),assetId:s.assetId,disableClear:!0,conversationId:s.currentConversationId,editorHeader:(0,t.jsx)(t1.AnimatePresence,{mode:"popLayout",children:(null==H?void 0:H.state)==="streaming"?(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"text-lg font-semibold text-primary animate-pulse",children:n("image-editor.generating","Generating")},"streaming-title"):(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex-grow",children:(0,t.jsx)(nQ.AssetTitle,{asset:K,className:"text-lg font-semibold text-primary truncate min-w-0 overflow-hidden"})},Q&&"streaming"===Q.state?E:K.assetId)}),headerButtons:[H&&(0,t.jsx)(X.ButtonWithTooltip,{shape:"square",variant:"tertiary",size:"sm","aria-label":n("image-editor.download-image","Download Image"),tooltipContent:n("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===H.state||!H.url||b,onClick:et,children:(0,t.jsx)(ng.PopInOut,{children:b?(0,t.jsx)(t5.Spinner,{size:"xs"}):(0,t.jsx)(nx,{className:"size-5"})},b?"is-downloading":"download-icon")})],chat:(0,t.jsx)(nY.Conversation,{asset:s,viewedAssetId:M||void 0,onResponseImagesOpen:en,responseImagesView:"status-card"},s.assetId)})},code:function(e){var s,a,n;let{asset:i}=e,{t:r}=(0,R.useTranslation)("files"),o=(0,si.useLogEvent)(),c=(0,n8.useIsActiveGrokBusinessSession)(),[d,u]=(0,l.useState)(!1),{content:m,setContent:h,error:p,isEditing:f,refetch:x}=(0,nK.useAssetTextContent)(i,d),g=(0,l.useRef)(null),v=(0,s2.convertAssetMetadataToFileMetadata)(i),{activeArtifact:j,isEditing:y,onSetActiveArtifact:b}=(0,n$.useModelEdits)({content:null!=m?m:void 0});(0,l.useEffect)(()=>{u(y)},[y]);let{runCode:w,isCodeRunning:k,isCodeExecutionAvailable:N}=(e=>{let{code:t,mimetype:s,consoleRef:a}=e,n=(0,l.useRef)([]),{t:i}=(0,R.useTranslation)(["chat"]),r=i("code-execution.done","Done"),o=(0,nA.useCodeEditorLang)(s),{runCode:c,loading:d,result:u,codeExecutionAvailable:m}=(0,n3.useCodeExecution)(t,o);(0,l.useEffect)(()=>{var e;null==(e=a.current)||e.reset()},[a,t]);let h=(0,l.useCallback)(()=>{var e;null==(e=a.current)||e.reset(),n.current=[],c()},[a,c]);return(0,l.useEffect)(()=>{var e,t,s,i,l,o,c,d;if(!u)return;let{stdout:m,stderr:h,outputFiles:p,success:f}=u;m&&!n.current.includes(m)&&(null==(e=a.current)||e.open(),n.current.push(m),null==(t=a.current)||t.addMessage({type:"log",message:m})),h&&!n.current.includes(h)&&(null==(s=a.current)||s.open(),n.current.push(h),null==(i=a.current)||i.addMessage({type:"error",message:h,disableFixButton:!0}));let x=Object.values(p).join(",");p&&Object.values(p).length>0&&!n.current.includes(x)&&(null==(l=a.current)||l.open(),n.current.push(x),null==(o=a.current)||o.addMessage({type:"log",files:p})),f&&!n.current.includes(r)&&0===n.current.length&&(null==(c=a.current)||c.open(),n.current.push(r),null==(d=a.current)||d.addMessage({type:"system",message:r}))},[a,u,r]),{runCode:h,isCodeRunning:d,codeExecutionResult:u,isCodeExecutionAvailable:m()}})({code:null!=m?m:"",mimetype:null!=(s=v.fileMimeType)?s:"",consoleRef:g}),C=(0,l.useCallback)(()=>{w(),o("files.workbench.run-code","",{location:"code-workbench:onRunCode"})},[w,o]),S=(0,l.useCallback)(e=>{h(null!=e?e:"")},[h]),I=(e=>{let{mimetype:t,isCodeExecutionAvailable:s}=e;return s?"run":["text/html"].includes(t)?"preview":"none"})({content:null!=m?m:"",mimetype:v.fileMimeType,isCodeExecutionAvailable:N}),{handleCopy:T,copyPressed:M,handleDownload:P,handleShare:E,sharePressed:z,shareLoading:D}=(0,nX.useFileActions)({assetId:i.assetId,content:null!=m?m:"",filename:null!=(a=i.name)?a:"file"}),A=(0,nA.useCodeEditorLang)(v.fileMimeType),[L,F]=(0,l.useState)("code"),_=(0,l.useCallback)(e=>{F(e),o("files.workbench.set-mode",e,{location:"code-workbench:onSetMode"})},[o]);return((0,l.useEffect)(()=>{F("code")},[i.assetId]),null==m)?(0,t.jsxs)("div",{className:"flex flex-col w-full h-full p-4",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center justify-between",children:[(0,t.jsx)(eb.Skeleton,{className:"w-[30%] h-6"}),(0,t.jsxs)("div",{className:"flex gap-6 me-4",children:[(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"}),(0,t.jsx)(eb.Skeleton,{className:"w-6 h-6"})]})]}),(0,t.jsxs)("div",{className:"flex mt-6 flex-col h-full w-full max-w-3xl gap-3",children:[(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-2xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-3xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-xl h-5"}),(0,t.jsx)(eb.Skeleton,{className:"w-full max-w-sm h-5"})]})]}):p?(0,t.jsx)(nP.FileError,{onRetryRequested:x}):(0,t.jsx)(nZ.WorkbenchWithChatLayout,{editor:"code"===L?(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-surface-inset",children:[(0,t.jsx)("div",{className:"relative flex-1 h-full overflow-hidden",children:(0,t.jsx)(nJ.CodeEditor,{editable:!0,onContentUpdate:S,isStreaming:f,value:null!=m?m:"",syntax:A})}),(0,t.jsx)(nL.Console,{ref:g}),f?(0,t.jsx)("div",{className:"sticky overflow-visible bottom-4 start-0 w-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-primary bg-surface-l1 px-4 py-2 rounded-full h-10 border border-border",children:[(0,t.jsx)(t5.Spinner,{size:"sm"}),(0,t.jsx)("span",{children:r("files.editing-by-model","Editing...")})]})}):null]}):(0,t.jsx)(n4,{mimetype:null!=(n=i.mimeType)?n:"unknown",content:null!=m?m:""}),chat:(0,t.jsx)(nY.Conversation,{asset:i,activeArtifact:j,onArtifactSelected:b}),editorHeader:(0,t.jsx)(nQ.AssetTitle,{asset:i}),assetId:i.assetId,conversationId:i.currentConversationId,headerButtons:["preview"===I?(0,t.jsx)(n2,{mode:L,setMode:_}):null,"run"===I?(0,t.jsx)("div",{className:"py-1",children:(0,t.jsxs)(X.Button,{variant:"secondary",shape:"rectangle",size:"sm",onClick:C,disabled:k,children:[k?(0,t.jsx)(t5.Spinner,{size:"xs"}):(0,t.jsx)(nH.PlayIcon,{...n6,size:18}),r("code-execution.run","Run")]})}):null,(0,t.jsx)(nU,{asset:i},"add-to-workspace-button"),(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:r("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:T,variant:"tertiary",shape:"square",size:"sm","aria-label":r("Copy Contents","Copy Contents"),children:(0,t.jsx)(ng.PopInOut,{children:M?(0,t.jsx)(ae.CheckIcon,{size:18}):(0,t.jsx)(nq.CopyIcon,{size:18})},M?"copied":"copy")},"copy-button"),(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:r("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:P,variant:"tertiary",shape:"square",size:"sm","aria-label":r("Download to file","Download to file"),children:(0,t.jsx)(nx,{...n6,size:18})},"download-button"),c?null:(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:r("Share file","Share file"),onClick:E,tooltipContentProps:{className:"text-xs"},variant:"tertiary",shape:"square",size:"sm","aria-label":r("Share file","Share file"),children:(0,t.jsx)(ng.PopInOut,{children:D?(0,t.jsx)(t5.Spinner,{size:"xs"}):z?(0,t.jsx)(ae.CheckIcon,{size:16}):(0,t.jsx)(nV.ShareIcon,{...n6,size:18})},D?"share-loading":z?"shared":"share")},"share-button")]})},unknown:ix};function iv(e){var s;let{rootAssetId:n}=e,{t:i}=(0,R.useTranslation)("files"),{setOpen:r}=(0,nR.useSidebar)(),o=(0,s3.useFilesPageStore)((0,az.useShallow)(e=>e.fetchVersions)),c=(0,s3.useFilesPageStore)(e=>{var t;return null==(t=e.assetsById[n])?void 0:t.status}),d=(0,s3.useCurrentVersion)(n),u=(0,nz.getEditorView)();(0,l.useEffect)(function(){return u.updateState(e=>({...e,activeId:n})),()=>{u.updateState(e=>({...e,activeId:null}))}},[n,u]);let m=(0,a.useChatPageStore)(eU.prop("setMetadata")),h=u.useState(e=>e.nodes[n]);if((0,l.useEffect)(function(){h&&"sheet"===h.type&&m(null===h.selection?{activeSheetId:h.activeSheet}:{selection:{type:"sheet",sheetId:h.activeSheet,range:(0,nD.selectionLabel)(h.selection).text}})},[h,m]),(0,l.useEffect)(()=>{o(n)},[n,o]),(0,l.useEffect)(()=>{r(!1)},[]),!d&&"success"===c)return(0,t.jsx)(nP.FileError,{title:i("file-not-found.title","File not found"),message:i("file-not-found.message","We couldn't find the document. Please verify the link you entered and try again. You can also browse for your files in the Files panel.")});if(!d&&"error"===c)return(0,t.jsx)(nP.FileError,{});if(!d)return(0,t.jsx)(aY.DelayedRender,{delayMs:500,children:(0,t.jsx)("div",{className:"flex w-full h-full justify-center items-center",children:(0,t.jsx)(t5.Spinner,{})})});let p=null!=(s=ig[(0,ak.getFileCategoryForAsset)(d)])?s:ix;return(0,t.jsx)(p,{asset:d})}function ij(){var e;let s=(0,si.useLogEvent)(),{t:a}=(0,R.useTranslation)("files"),{route:n,push:i}=(0,er.useRouting)(),r=(0,eh.useMobileSize)(),{user:o}=(0,ev.useSession)(),c="files"===n.page&&null!=(e=n.fileId)?e:void 0,d=(0,s3.useFilesPageStore)(e=>{var t,s;return c&&e.currentVersion[c]?null==(s=e.assetsById[e.currentVersion[c]])||null==(t=s.data)?void 0:t.name:""}),u=(0,s3.useFilesPageStore)(e=>e.isFileExplorerCollapsed),m=(0,s3.useFilesPageStore)(e=>e.setIsFileExplorerCollapsed);if((0,l.useEffect)(()=>{s("files.open",c,{location:"files-page-content:useEffect"})},[c,s]),(0,sn.useDocumentTitle)(d||a("files-page-title","Files")),(0,a5.useHotkeys)(a2.KBD_NEW_CHAT,e=>{e.preventDefault(),e.stopPropagation(),i({page:"main"}),s("pressed_cmd_j",void 0,{location:"files-page-content:useHotkeys"})},[s,i]),!o||"files"!==n.page)return(0,t.jsx)(sa.default,{});if(r)return(0,t.jsx)(an,{});let{fileId:h,emptyView:p}=n;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a4.LayoutWithSubnav,{collapsed:u,onCollapsedChange:m,sideContent:(0,t.jsx)(a1,{className:"h-full"}),autoSaveId:"files-page-layout",style:{height:"100vh"},direction:"horizontal",className:"w-full h-[100vh] overflow-hidden",tagName:"main",children:h?(0,t.jsx)(iv,{rootAssetId:h}):"image"===p?(0,t.jsx)(nE,{}):(0,t.jsx)(a9,{})}),(0,t.jsx)(e4.CommandMenu,{})]})}var iy=e.i(230433),ib=e.i(749659);let iw=()=>{let{t:e}=(0,R.useTranslation)(),{isSuperGrokUser:s,isSuperGrokProUser:a,isEnterpriseUser:n}=(0,iy.useSubscriptions)(),i=(0,iy.useCheckoutSuccess)(),{push:l}=(0,er.useRouting)();return(0,t.jsxs)("div",{className:(0,ee.cn)("fixed z-50 bg-background grid inset-0 place-items-center gap-4 duration-200 w-[100vw] min-h-[100vh] overflow-x-hidden","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-6"),children:[(0,t.jsx)("meta",{name:"description",content:"Unlock advanced AI capabilities with SuperGrok. With SuperGrok you get signifcantly more access to our premium models and early access to new features."})," ",(0,t.jsx)("meta",{name:"keywords",content:"Grok, Supergrok, Subscription, xAI, AI, Models, Context, Images, Generation, Tools, Features"}),(0,t.jsx)(eW.Button,{asChild:!0,variant:"secondary",size:"pill",className:"absolute top-8 z-10 h-10 pr-5",children:(0,t.jsxs)(er.Link,{route:{page:"main"},children:[(0,t.jsx)(tn.ChevronLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"-mt-px",children:e("Go to","Go to")}),(0,t.jsx)("div",{className:"-mx-0.5 -mt-px",children:(0,t.jsx)(ac.GrokWordLogo,{className:"h-3"})})]})}),(0,t.jsx)(ib.UpsellPlansV2,{isSubscribed:s||a||n||!1,isSuccessful:i,onSuccess:()=>l({page:"main"})})]})};var ik=e.i(199231),iN=e.i(450363),iC=e.i(934652),iS=e.i(93910);let iI=e=>{var s;let{shareLink:a,conversation:n}=e,{t:i}=(0,R.useTranslation)("base"),{deleteShareLink:l,isPending:r}=(0,ik.useDeleteShareLink)(),o=(0,iS.useShareRoute)();return(0,t.jsxs)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-between items-center py-2 px-4 border rounded-xl bg-card gap-2",children:[(0,t.jsx)(iN.default,{href:o(null!=(s=a.publicId)?s:""),className:"group cursor-pointer text-sm flex-1 min-w-0 grow",children:(0,t.jsx)("span",{className:"line-clamp-1 font-semibold",children:n?n.title:i("share-links.unknown-conversation","Untitled")})}),(0,t.jsxs)("div",{className:"flex flex-row items-center gap-4 shrink-0 select-none",children:[a.viewCount&&(0,t.jsx)("span",{className:"flex items-center text-xs text-muted-foreground",children:i("share-links.views",{count:parseInt(a.viewCount),defaultValue_zero:"No views",defaultValue_one:"{{count}} view",defaultValue_other:"{{count}} views"})}),(0,t.jsx)(eW.Button,{onClick:e=>{e.stopPropagation(),a.shareLinkId&&l(a.shareLinkId)},variant:"outline",rounded:!0,disabled:r,children:i("share-links.remove","Unshare")})]})]})};function iT(){let{t:e}=(0,R.useTranslation)("base"),{user:s}=(0,ev.useSession)(),{currentTeam:a}=(0,iC.useEnterprise)(),{shareLinks:n,isLoading:i,error:l,refetch:r,loadMoreRef:o,historyContainerRef:c}=(0,ik.useListShareLinks)();return s?(0,t.jsxs)("main",{className:(0,ee.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{}),(0,t.jsxs)("div",{className:"max-w-[50rem] px-5 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:c,children:[(0,t.jsx)("div",{className:"flex justify-between align-center min-h-[42px] w-full",children:(0,t.jsx)("h1",{className:"text-2xl flex gap-2 items-center font-semibold",children:e("share-links.title","Shared Conversations")})}),(0,t.jsx)("div",{className:"flex flex-col w-full items-start text-muted-foreground",children:(null==a?void 0:a.teamId)?e("share-links.description.team","Shared links can be viewed by team members with access."):e("share-links.description.personal","Shared links can be viewed by anyone with the link.")}),(0,t.jsxs)(sz.FadeScrollContainer,{className:"gap-2 pt-6",children:[(0,t.jsxs)(t1.AnimatePresence,{children:[null==n?void 0:n.map(e=>{var s;return(0,t.jsx)(iI,{shareLink:e,conversation:null==e||null==(s=e.sharedLink)?void 0:s.conversation},e.shareLinkId)}),(null==n?void 0:n.length)===0&&!i&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center h-40 flex items-center justify-center w-full py-8 border rounded-3xl flex-col gap-4 p-4 sm:p-6 select-none",children:(0,t.jsx)("div",{className:"font-semibold",children:e("share-links.no-share-links-found","Nothing shared yet")})})},"no-share-links-found"),i&&(0,t.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,t.jsx)(t2.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(sD.Loader2,{className:"animate-spin"})})})},"share-links-loading"),l&&(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,t.jsx)("div",{className:"text-center",children:e("share-links.error.description","Can't load shared conversations")}),(0,t.jsx)(eW.Button,{variant:"filledSecondary",onClick:()=>r(),children:e("Retry","Try Again")})]},"share-links-error")]}),(0,t.jsx)("div",{ref:o})]})]})]}):(0,t.jsx)("main",{className:(0,ee.cn)("w-screen h-dvh relative"),children:(0,t.jsx)(sE.ErrorCard,{title:e("deleted-conversations.error.title","Sign In Required"),description:e("deleted-conversations.error.anonymous-user","Sign in to view your shared conversations"),cta:e("share-links-page-error.cta","Return home")})})}e.i(70015);var iM=e.i(252221),iP=e.i(143883);e.i(353492);var iE=e.i(69052),iz=e.i(614688);let iD=e=>{let{items:t,selectedId:s,setSelectedId:a,onSelect:n,getId:i,enabled:r=!0,containerRef:o,scrollIntoViewOptions:c={behavior:"smooth",block:"nearest"}}=e,d=(0,l.useRef)(!1),u=(0,l.useRef)(null),m=(0,l.useRef)(null),h=(0,l.useCallback)(()=>{d.current=!0,u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{d.current=!1},300)},[]),p=(0,l.useCallback)(e=>{r&&!d.current&&(a(e),m.current="mouse")},[r,a]),f=(0,l.useCallback)(()=>{r&&!d.current&&"mouse"===m.current&&(a(null),m.current=null)},[r,a]),x=(0,l.useCallback)(()=>{if(!s||!(null==o?void 0:o.current))return;let e=o.current.querySelector("[data-selected=true]");e&&e.scrollIntoView(c)},[s,o,c]);return(0,l.useEffect)(()=>{if(r&&0!==t.length)return window.addEventListener("keydown",e),window.addEventListener("mousemove",l),()=>{window.removeEventListener("keydown",e),window.removeEventListener("mousemove",l),u.current&&clearTimeout(u.current)};function e(e){"ArrowDown"===e.key||"ArrowUp"===e.key?(e.preventDefault(),h(),a(s=>{let a=s?t.findIndex(e=>i(e)===s):-1;if("ArrowDown"===e.key){if(e.metaKey||e.ctrlKey){let e=t[t.length-1];return t.length>0&&void 0!==e?i(e):null}let s=-1===a?0:(a+1)%t.length,n=t[s];return void 0!==n?i(n):null}{if(e.metaKey||e.ctrlKey){let e=t[0];return t.length>0&&void 0!==e?i(e):null}let s=-1===a?t.length-1:(a-1+t.length)%t.length,n=t[s];return void 0!==n?i(n):null}}),setTimeout(x,100),m.current="keyboard"):"Enter"===e.key&&s?(e.preventDefault(),n(s)):"Escape"===e.key&&(e.preventDefault(),a(null),m.current=null)}function l(){u.current&&clearTimeout(u.current),d.current=!1}},[t,n,s,r,i,a,h,x]),(0,l.useEffect)(()=>{s&&t.length>0?t.some(e=>i(e)===s)||(a(null),m.current=null):s&&0===t.length&&(a(null),m.current=null)},[t,s,i,a]),{handleMouseEnter:p,handleMouseLeave:f}};var iR=e.i(956916);let iA=e=>{let{title:s,description:a,cta:n,onClick:i}=e;return(0,t.jsxs)("div",{className:"py-12 px-3 flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)("div",{className:"size-10 bg-surface-l1 rounded-full flex justify-center items-center",children:(0,t.jsx)(iR.ChatBubblePlusIcon,{className:"size-5 text-fg-tertiary"})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-fg-primary text-sm font-semibold",children:s}),(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:a})]}),n&&(0,t.jsx)(X.Button,{size:"sm",shape:"rectangle",variant:"secondary",onClick:i,children:n})]})};var iL=e.i(804220);let iF=e=>{let{title:s,description:a,onClick:n}=e,{t:i}=(0,R.useTranslation)("base");return(0,t.jsxs)("div",{className:"py-12 px-3 flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)("div",{className:"size-10 bg-surface-l1 rounded-full flex justify-center items-center",children:(0,t.jsx)(iL.TriangleAlert,{className:"size-5 text-fg-tertiary"})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-fg-primary text-sm font-semibold",children:s}),(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:a})]}),(0,t.jsx)(X.Button,{size:"sm",shape:"rectangle",variant:"secondary",onClick:n,children:i("history.retry","Retry")})]})},i_=()=>{let{t:e}=(0,R.useTranslation)("base"),[s,a]=(0,l.useState)(""),[n,i]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(null),{routeToConversation:h}=(0,sA.useGrokRouter)(),p=(0,si.useLogEvent)(),f=(0,sF.useRequestErrorToastFn)(),x=(0,l.useMemo)(()=>{var e;return null!=(e=null==s?void 0:s.trim())?e:""},[s]),{results:g,refetch:v,loadMoreRef:j,historyContainerRef:y,isLoading:b,isFetching:w,isError:k,isDebouncing:N,isFetchingNextPage:C}=(0,iz.useSearchConversations)({query:x}),S=(0,l.useCallback)(e=>{if(n||r)return;h(e,!1,!0);let t=s_.useConversationStore.getState().byId[e];p("select_conversation",e,{conversationCreateTime:(null==t?void 0:t.createTime)||"",location:"command-menu"})},[n,r,h,p]),I=(0,l.useCallback)(e=>{var t;let s=g.find(t=>t.conversation.conversationId===e);d((null==s||null==(t=s.conversation)?void 0:t.title)||""),i(e)},[g]),T=(0,l.useCallback)(async e=>{var t;if(n!==e)return;let s=c.trim();if(""===s)return;let a=g.find(t=>t.conversation.conversationId===e);p("update_conversation",e,{location:"search-dialog"}),i(null);let{fetchUpdateConversation:l}=s_.useConversationStore.getState();await l(e,{title:s,starred:null==a||null==(t=a.conversation)?void 0:t.starred}).catch(e=>{f("command-menu:handleEditSave",e)}),await v()},[g,f,n,c,v,p]),M=(0,l.useCallback)(async e=>{if(r!==e)return;p("delete_conversation",e,{location:"search-dialog"}),o(null);let{fetchSoftDeleteConversation:t}=s_.useConversationStore.getState();await t(e).catch(e=>{f("command-menu:handleDeleteConfirm",e)}),await v()},[r,p,v,f]),P=(0,l.useCallback)(()=>{i(null),o(null),d("")},[]),E=(0,l.useCallback)(async e=>{var t;let s=g.find(t=>t.conversation.conversationId===e);p("favorite_conversation",e,{value:(null==s?void 0:s.conversation.starred)?"true":"false",location:"search-dialog"});let{fetchUpdateConversation:a}=s_.useConversationStore.getState();await a(e,{starred:!(null==s||null==(t=s.conversation)?void 0:t.starred)}).catch(e=>{f("command-menu:handleToggleFavorite",e)}),await v()},[g,f,v,p]),{handleMouseEnter:z,handleMouseLeave:D}=iD({items:g,selectedId:u,setSelectedId:m,onSelect:S,getId:e=>e.conversation.conversationId,enabled:!n&&!r,containerRef:y});return(0,t.jsx)("div",{className:"flex flex-col h-full min-h-0",children:(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"px-0.5 pt-0.5 flex-shrink-0",children:(0,t.jsxs)("div",{className:"relative z-20",children:[(0,t.jsx)(at.Input,{autoFocus:!0,value:s,onChange:e=>{a(e.target.value)},className:"bg-surface-l1 rounded-full h-11 pl-9 text-base",placeholder:e("history.search-conversations","Search")}),(0,t.jsx)(af.SearchIcon,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-fg-secondary"}),(0,t.jsx)(t1.AnimatePresence,{children:(b||w||N)&&x&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,t.jsx)(t5.Spinner,{size:"xs"})},"spinner")})]})}),(0,t.jsx)(t1.AnimatePresence,{mode:"wait",initial:!1,children:k?(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iF,{title:e("history.failed-to-load-history.title","Failed to load history"),description:e("history.failed-to-load-history.description","We encountered an issue while loading your conversation history"),onClick:()=>v()})},"error"):g.length>0?(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-6 bg-gradient-to-t from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-6 bg-gradient-to-b from-surface-base to-transparent z-10"}),(0,t.jsxs)("div",{ref:y,style:{scrollPaddingBlock:"1rem"},className:(0,ee.cn)("flex flex-col gap-1 h-full overflow-y-auto py-4"),children:[null==g?void 0:g.map(e=>{let{conversation:s,matchedWords:a,matchType:i,highlight:l}=e;return(0,t.jsx)("div",{"data-selected":u===s.conversationId,onMouseEnter:()=>z(s.conversationId),onMouseLeave:D,className:"relative z-0",children:(0,t.jsx)(iB,{conversation:s,matchedWords:a,matchType:i,highlight:l,isSelected:u===s.conversationId,isEditing:n===s.conversationId,isDeleting:r===s.conversationId,newTitle:c,onNewTitleChange:d,onSelect:S,onEditStart:I,onDeleteStart:o,onToggleFavorite:E,onEditSave:T,onDeleteConfirm:M,onCancel:P})},s.conversationId)}),C&&(0,t.jsxs)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"flex w-full justify-center items-center gap-3 py-2",children:[(0,t.jsx)("p",{className:"text-fg-tertiary text-sm",children:e("history.loading-more","Loading more")}),(0,t.jsx)(t5.Spinner,{size:"xs"})]},"loading-more"),(0,t.jsx)("div",{ref:j,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]}):b&&!x?(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 py-4",children:Array.from({length:3}).map((e,s)=>(0,t.jsx)(eb.Skeleton,{className:"h-[48px] w-full rounded-2xl"},s))},"skeletons"):!b&&!N&&(x?(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 pt-20",children:(0,t.jsx)("div",{className:"text-center text-fg-secondary px-4",children:e("history.no-conversations-found","No conversations found")})},"no-results"):(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iA,{title:e("history.empty-history.title","No conversations yet"),description:e("history.empty-history.description","Start a conversation to see your history here"),cta:e("history.empty-history.new-chat","New Chat"),onClick:()=>h()})},"empty"))})]})})},iB=(0,l.memo)(e=>(0,t.jsx)("div",{className:(0,ee.cn)("h-[48px] rounded-2xl grid grid-cols-1 grid-rows-1 flex-shrink-0",e.isSelected&&"bg-button-ghost-hover","MATCH_MESSAGE"===e.matchType&&!!e.highlight&&"h-[64px]"),children:(0,t.jsx)(iE.ConversationShortcut,{...e,isSelected:e.isSelected,isHovered:e.isSelected,isCurrent:!1})}));var iG=e.i(680126),iW=e.i(86871),iU=e.i(548312);let iO=()=>{let{t:e}=(0,R.useTranslation)("base"),{routeToConversation:s}=(0,sA.useGrokRouter)(),a=(0,sF.useRequestErrorToastFn)(),[n,i]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[c,d]=(0,e2.useLocalStorage)("history.shared-with-me.order-by","createTime"),[u,m]=(0,l.useState)(!1),{results:h,isLoading:p,refetch:f,isError:x,containerRef:g,loadMoreRef:v,getShareLinkHref:j,handleNavigateToSharedConversation:y}=(0,iG.useSharedWithMeLinks)({pageSize:60,orderBy:c}),{mutate:b,isPending:w}=(0,sG.useMutation)({mutationKey:["cloneConversation"],mutationFn:async e=>sr.chatApi.chatCloneConversation({shareLinkId:e,body:{}}),onSuccess:e=>{e.conversation&&s(e.conversation.conversationId)},onError:e=>{a("history-shared-with-me:cloneConversation",e)},onSettled:()=>{o(null)}}),k=(0,l.useCallback)(async e=>{let t=h.find(t=>t.shareLinkId===e);if((null==t?void 0:t.shareLinkId)&&(null==t?void 0:t.publicId)&&!w)return o(t.shareLinkId),b(t.publicId)},[w,b,h]),N=(0,l.useCallback)(e=>{window.open(j(e),"_blank")},[j]),{handleMouseEnter:C,handleMouseLeave:S}=iD({items:h,selectedId:n,setSelectedId:i,onSelect:y,containerRef:g,getId:e=>e.shareLinkId});return(0,t.jsx)("div",{className:"flex flex-col h-full min-h-0",children:(0,t.jsx)(t1.AnimatePresence,{mode:"wait",initial:!1,children:x?(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iF,{title:e("history.failed-to-load-shared.title","Failed to load shared conversations"),description:e("history.failed-to-load-shared.description","We encountered an issue while loading your shared conversations"),onClick:()=>f()})},"error"):p||h.length?(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"px-0.5 pt-0.5 flex-shrink-0",children:(0,t.jsx)("div",{className:"relative z-20",children:(0,t.jsxs)(tx.DropdownMenu,{open:u,onOpenChange:m,children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",className:"h-11",children:[(0,t.jsx)("span",{children:"createTime"===c?e("history.shared-with-me.order-by.create-time","Most recent"):e("history.shared-with-me.order-by.view-count","Most popular")}),(0,t.jsx)(s9.ChevronDownIcon,{className:(0,ee.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":u})})]})}),(0,t.jsxs)(tx.DropdownMenuContent,{children:[(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>d("createTime"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:e("history.shared-with-me.order-by.create-time","Most recent")}),"createTime"===c&&(0,t.jsx)(ae.CheckIcon,{className:"text-fg-primary size-4"})]})}),(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>d("viewCount"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:e("history.shared-with-me.order-by.view-count","Most popular")}),"viewCount"===c&&(0,t.jsx)(ae.CheckIcon,{className:"text-fg-primary size-4"})]})})]})]})})}),(0,t.jsx)(t1.AnimatePresence,{mode:"wait",children:h.length>0?(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-6 bg-gradient-to-t from-background to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-6 bg-gradient-to-b from-background to-transparent z-10"}),(0,t.jsxs)("div",{ref:g,style:{scrollPaddingBlock:"1rem"},className:(0,ee.cn)("flex flex-col gap-1 h-full overflow-y-auto py-4"),children:[null==h?void 0:h.map(e=>(0,t.jsx)("div",{"data-selected":n===e.shareLinkId,onMouseEnter:()=>C(e.shareLinkId),onMouseLeave:S,children:(0,t.jsx)(iq,{isSelected:n===e.shareLinkId,shareLink:e,orderBy:c,isLoading:r===e.shareLinkId,onOpenShareLink:y,onStartNewConversation:k,onOpenInNewTab:N})},e.shareLinkId)),(0,t.jsx)("div",{ref:v,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]}):p&&(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 py-4",children:Array.from({length:3}).map((e,s)=>(0,t.jsx)(eb.Skeleton,{className:"h-[48px] w-full rounded-2xl"},s))},"skeletons")})]}):(0,t.jsx)(t2.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iA,{title:e("history.empty-share-list.title","No shared conversations yet"),description:e("history.empty-share-list.description","Shared conversations will appear here"),onClick:()=>s()})},"no-results")})})},iq=(0,l.memo)(e=>{var s,a,n,i,r;let{isSelected:o,shareLink:c,isLoading:d,orderBy:u,onOpenShareLink:m,onOpenInNewTab:h,onStartNewConversation:p}=e,f=(0,eh.useMobileSize)(),{t:x}=(0,R.useTranslation)("base"),g=(0,l.useMemo)(()=>{var e,t;return!!((null==c||null==(e=c.user)?void 0:e.familyName)||(null==c||null==(t=c.user)?void 0:t.givenName))},[c]);return(0,t.jsx)("div",{className:(0,ee.cn)("h-[48px] rounded-2xl grid grid-cols-1 grid-rows-1 flex-shrink-0",o&&"bg-button-ghost-hover"),onClick:()=>m(c.shareLinkId),children:(0,t.jsxs)("div",{className:(0,ee.cn)("flex cursor-pointer items-center px-3 col-start-1 col-end-2 row-start-1 row-end-2"),children:[(0,t.jsx)("div",{className:"flex-grow min-w-0",children:(0,t.jsx)("div",{className:"flex items-center w-full",children:(0,t.jsx)("div",{className:"truncate text-primary",children:(null==(s=c.conversation)?void 0:s.title)||"Untitled Conversation"})})}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-32 flex justify-start items-center",children:!f&&(0,t.jsxs)(ih.Tooltip,{children:[(0,t.jsx)(ih.TooltipTrigger,{disabled:!g,asChild:!0,children:(0,t.jsx)("div",{className:"flex items-center gap-2 w-full",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(aj.Avatar,{user:null==c?void 0:c.user,className:"size-6",textClassName:"text-[12px]"}),(0,t.jsx)("span",{className:"text-fg-secondary text-sm truncate",children:"".concat((null==c||null==(a=c.user)?void 0:a.givenName)||""," ").concat((null==c||null==(n=c.user)?void 0:n.familyName)||"")})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eb.Skeleton,{className:"size-6 rounded-full flex-shrink-0"}),(0,t.jsx)(eb.Skeleton,{className:"w-full h-[16px] flex-shrink-0 flex-grow"})]})})}),g&&(0,t.jsx)(ih.TooltipContent,{side:"top",align:"center",children:"".concat((null==c||null==(i=c.user)?void 0:i.givenName)||""," ").concat((null==c||null==(r=c.user)?void 0:r.familyName)||"")})]})}),(0,t.jsx)("div",{className:"z-20 w-".concat(28," text-right"),children:d?(0,t.jsx)("div",{className:"flex items-center w-full justify-end",children:(0,t.jsx)(t5.Spinner,{size:"xs",className:"mx-2"})}):f||o?(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-end w-full",children:[(0,t.jsx)(X.ButtonWithTooltip,{tabIndex:-1,variant:"tertiary",size:"sm",shape:"square",onClick:e=>{e.stopPropagation(),h(c.shareLinkId)},tooltipContent:x("New Tab","New Tab"),"aria-label":x("New Tab","New Tab"),children:(0,t.jsx)(iU.SquareArrowOutUpRightIcon,{size:16,className:"text-primary"})}),(0,t.jsx)(X.ButtonWithTooltip,{tabIndex:-1,variant:"tertiary",size:"sm",shape:"square",onClick:e=>{e.stopPropagation(),p(c.shareLinkId)},tooltipContent:x("history.start-conversation","Start new converation"),"aria-label":x("history.start-conversation","Start new converation"),children:(0,t.jsx)(iW.ArrowRightIcon,{size:16,className:"text-primary"})})]}):"createTime"===u?c.createTime&&(0,t.jsx)(iE.Timestamp,{conversation:{createTime:c.createTime,modifyTime:c.createTime}}):"viewCount"===u&&(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:x("history.shared-with-me.views",{count:parseInt(c.viewCount||"0"),defaultValue_one:"{{count}} view",defaultValue_other:"{{count}} views"})})})]})]})})}),iV=()=>{let e=(0,si.useLogEvent)(),s=(0,sx.usePathname)(),a=(0,sx.useRouter)(),{t:n}=(0,R.useTranslation)("base"),i=(0,l.useCallback)(()=>{e("sign_in_redirect",void 0,{location:"history-anon-page"});let t=new URLSearchParams({return_to:s}).toString();a.push("/sign-in?".concat(t))},[e,a,s]),r=(0,l.useCallback)(()=>{e("sign_up_redirect",void 0,{location:"history-anon-page"});let t=new URLSearchParams({return_to:s}).toString();a.push("/sign-up?".concat(t))},[e,a,s]);return(0,t.jsx)("div",{className:"flex flex-col h-full p-4 justify-center items-center",children:(0,t.jsxs)("div",{className:"max-w-xl flex flex-col items-center justify-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-medium text-center whitespace-pre",children:n("history.anon.title","Conversation History")}),(0,t.jsx)("p",{className:"mt-6 text-secondary text-center",children:n("history.anon.description","Sign in to view and manage your past conversations with Grok.")}),(0,t.jsxs)("div",{className:"flex justify-center gap-2 mt-8",children:[(0,t.jsxs)(X.Button,{size:"sm",variant:"primary",shape:"pill",onClick:r,children:[(0,t.jsx)(sb.User,{size:16,strokeWidth:2}),(0,t.jsx)("div",{children:n("Sign up","Sign up")})]}),(0,t.jsx)(X.Button,{size:"sm",variant:"secondary",shape:"pill",onClick:i,children:(0,t.jsx)("div",{children:n("Sign in","Sign in")})})]})]})})};function iH(){let{t:e}=(0,R.useTranslation)("base"),{currentTeam:s}=(0,iC.useEnterprise)(),{route:a}=(0,er.useRouting)(),{user:n}=(0,ev.useSession)(),i="history"===a.page&&a.tab||"conversations";return s||"shared-with-me"!==i||(i="conversations"),(0,t.jsxs)("main",{className:(0,ee.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{}),n?(0,t.jsx)("div",{className:"max-w-[50rem] px-6 @lg:px-2 pt-16 @sm:pt-18 mx-auto w-full flex flex-col h-full items-center pb-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 w-full flex-1 min-h-0",children:[(0,t.jsx)("span",{className:"text-2xl font-semibold px-2.5",children:e("history.title","History")}),(0,t.jsxs)(n0.Tabs,{value:i,className:"flex flex-col flex-1 min-h-0",children:[(0,t.jsx)(n8.EnterpriseWrapper,{requireSelectedTeam:!0,children:(0,t.jsxs)(n0.TabsList,{className:"bg-transparent border-none relative w-full justify-start p-0 px-1 mt-4",children:[(0,t.jsx)(n0.TabsTrigger,{value:"conversations",variant:"underline",className:"px-2",asChild:!0,children:(0,t.jsx)(er.Link,{route:{page:"history",tab:"conversations"},className:"font-semibold",children:e("history.my-conversations","My Conversations")})}),(0,t.jsx)(n0.TabsTrigger,{value:"shared-with-me",variant:"underline",className:"px-2",asChild:!0,children:(0,t.jsx)(er.Link,{route:{page:"history",tab:"shared-with-me"},className:"font-semibold",children:e("history.shared-with-me","Shared with me")})}),(0,t.jsx)("div",{className:"absolute inset-x-1 bottom-0 border-b border-border-l2"})]})}),(0,t.jsx)(n0.TabsContent,{value:"conversations",className:"mt-4 flex-1 min-h-0 focus-visible:ring-0",children:(0,t.jsx)(i_,{})}),(0,t.jsx)(n8.EnterpriseWrapper,{requireSelectedTeam:!0,children:(0,t.jsx)(n0.TabsContent,{value:"shared-with-me",className:"mt-4 flex-1 min-h-0 focus-visible:ring-0",children:(0,t.jsx)(iO,{})})})]})]})}):(0,t.jsx)(iV,{})]})}var iK=e.i(524556),iQ=e.i(597733),iY=e.i(875969);let iX=e=>{let{template:s,isSelected:a,onClick:n,onDuplicate:i,onDelete:r}=e,{t:o}=(0,R.useTranslation)("base"),{user:c}=(0,ev.useSession)(),[d,u]=(0,l.useState)(!1),m=(0,l.useMemo)(()=>s.userId===(null==c?void 0:c.userId),[s.userId,null==c?void 0:c.userId]);return(0,t.jsxs)("div",{onClick:()=>{d||null==n||n()},className:(0,ee.cn)("p-3 flex items-center justify-between gap-1 cursor-pointer hover:bg-card-hover rounded-xl duration-100 group/template-card",{"bg-card-focus hover:bg-card-focus":a,"bg-card-hover":d}),children:[(0,t.jsxs)("div",{className:"flex flex-col flex-grow min-w-0 gap-1",children:[(0,t.jsx)("span",{className:"truncate font-semibold h-6",children:s.templateName||o("templates.values.name.placeholder","New Template")}),(0,t.jsx)("span",{className:"truncate font-medium text-sm text-fg-secondary h-[21px]",children:s.templateDescription||o("templates.values.description.placeholder","Description")})]}),(0,t.jsxs)(tx.DropdownMenu,{open:d,onOpenChange:u,children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(X.Button,{variant:"tertiary",size:"sm",shape:"square",className:(0,ee.cn)("hidden group-hover/template-card:flex aria-expanded:bg-button-ghost-hover rounded-lg flex-shrink-0",d&&"flex"),children:(0,t.jsx)(aL.EllipsisVertical,{size:14})})}),(0,t.jsxs)(tx.DropdownMenuContent,{hideWhenDetached:!0,side:"right",align:"start",sideOffset:6,alignOffset:-8,className:"min-w-36 space-y-0.5",children:[i&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:i,className:"flex items-center gap-2",children:[(0,t.jsx)(nc.Files,{size:18,className:"-ml-1"}),(0,t.jsx)("span",{children:o("templates.duplicate","Duplicate")})]}),r&&m&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:r,className:"flex items-center gap-2",children:[(0,t.jsx)(iY.Trash,{size:18,className:"text-fg-danger -ml-1"}),(0,t.jsx)("span",{children:o("templates.delete","Remove")})]})]})]})]})},i$=e=>{let{containerRef:s,loadMoreRef:a,tab:n,templates:i,orderBy:r,isCreatingTemplate:o,isFetchingNextPage:c,isLoading:d,isFetching:u,isError:m,isDebouncing:h,selectedTemplateId:p,searchQuery:f,onSearchQueryChange:x,onOrderByChange:g,onTabChange:v,onTemplateSelect:j,onTemplateDuplicate:y,onTemplateDelete:b,onAddNew:w,className:k}=e,{t:N}=(0,R.useTranslation)("base"),{push:C}=(0,er.useRouting)(),[S,I]=(0,l.useState)(!1),T=(0,l.useMemo)(()=>f.trim(),[f]),M=(0,l.useCallback)(()=>{C({page:"main"})},[C]);return(0,t.jsxs)("div",{className:(0,ee.cn)("flex flex-col h-full @container/template-list",k),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(X.Button,{size:"sm",variant:"secondary",shape:"circle",onClick:M,children:[(0,t.jsx)(iK.ChevronLeftIcon,{size:18}),(0,t.jsx)("span",{className:"sr-only",children:N("templates.back","Back")})]}),(0,t.jsx)("h1",{className:"text-xl font-semibold",children:N("templates.title","Templates")})]}),(0,t.jsxs)(X.Button,{size:"sm",variant:"secondary",shape:"rectangle",disabled:o,onClick:w,children:[(0,t.jsx)(ng.PopInOut,{children:o?(0,t.jsx)(t5.Spinner,{size:"xs",className:"-ml-0.5"}):(0,t.jsx)(sp.Plus,{size:18,className:"-ml-0.5"})},o?"spinner":"plus"),(0,t.jsx)("span",{className:"hidden @[280px]/template-list:block",children:N("templates.add-new","Add")})]})]}),(0,t.jsxs)(n0.Tabs,{value:n,onValueChange:e=>v(e),className:"flex flex-col flex-1 min-h-0",children:[(0,t.jsxs)(n0.TabsList,{className:"bg-transparent border-none relative w-full justify-start p-0 px-4 pt-4 flex-shrink-0",children:[(0,t.jsx)(n0.TabsTrigger,{"aria-controls":void 0,value:"personal",variant:"underline",className:"px-2",children:N("templates.tabs.personal","Personal")}),(0,t.jsx)(n0.TabsTrigger,{value:"shared-with-me",variant:"underline",className:"px-2","aria-controls":void 0,children:N("templates.tabs.shared-with-me","Shared with me")}),(0,t.jsx)("div",{className:"absolute inset-x-4 bottom-0 border-b border-border-l2"})]}),(0,t.jsxs)("div",{className:"flex-shrink-0 flex flex-col @[340px]/template-list:flex-row items-center gap-4  @[360px]/template-list:gap-2 mx-4 mt-4 mb-0.5",children:[(0,t.jsxs)("div",{className:"relative flex-grow w-full",children:[(0,t.jsx)(at.Input,{autoFocus:!0,value:f,onChange:e=>{x(e.target.value)},className:"bg-surface-l1 rounded-full h-10 text-sm px-9",placeholder:N("templates.search","Search")}),(0,t.jsx)(af.SearchIcon,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-fg-secondary"}),(0,t.jsx)(t1.AnimatePresence,{children:(d||u||h)&&T&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,t.jsx)(t5.Spinner,{size:"xs"})},"spinner")})]}),(0,t.jsx)("div",{className:"relative flex-shrink-0 self-start",children:(0,t.jsxs)(tx.DropdownMenu,{open:S,onOpenChange:I,children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{shape:"pill",size:"md",variant:"secondary",children:[(0,t.jsx)("span",{children:"createTime"===r?N("templates.order-by.create-time","Most recent"):N("templates.order-by.usage-count","Most used")}),(0,t.jsx)(s9.ChevronDownIcon,{className:(0,ee.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":S})})]})}),(0,t.jsxs)(tx.DropdownMenuContent,{children:[(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>g("createTime"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:N("templates.order-by.create-time","Most recent")}),"createTime"===r&&(0,t.jsx)(ae.CheckIcon,{className:"text-fg-primary size-4"})]})}),(0,t.jsx)(tx.DropdownMenuItem,{onSelect:()=>g("usageCount"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:N("templates.order-by.usage-count","Most used")}),"usageCount"===r&&(0,t.jsx)(ae.CheckIcon,{className:"text-fg-primary size-4"})]})})]})]})})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-4 bottom-0 h-4 bg-gradient-to-t from-background to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-4 top-0 h-4 bg-gradient-to-b from-background to-transparent z-10"}),(0,t.jsxs)("div",{ref:s,className:"py-4 h-full overflow-auto flex flex-col gap-1 px-4",children:[m?(0,t.jsxs)("div",{className:"h-[90px] w-full border border-border-l1 rounded-2xl flex flex-col gap-2 justify-center items-center",children:[(0,t.jsx)(iL.TriangleAlert,{size:18,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"text-fg-secondary text-xs",children:N("templates.failed-to-load","Failed to load templates")})]}):i.length>0?i.map(e=>(0,t.jsx)(iX,{template:e,isSelected:e.templateId===p,onClick:()=>null==j?void 0:j(e),onDelete:()=>e.templateId&&(null==b?void 0:b(e.templateId)),onDuplicate:()=>e.templateId&&(null==y?void 0:y(e))},e.templateId)):d&&!T?(0,t.jsx)("div",{className:"flex flex-col gap-1",children:Array.from({length:2}).map((e,s)=>(0,t.jsx)(eb.Skeleton,{className:"h-[73px] w-full rounded-2xl opacity-20"},s))}):!d&&!h&&(T?(0,t.jsx)("div",{className:"flex flex-col gap-1 pt-8",children:(0,t.jsx)("div",{className:"text-center text-sm text-fg-secondary px-4",children:N("templates.no-results","No templates found")})}):(0,t.jsxs)("div",{className:"h-[90px] w-full border border-border-l1 rounded-2xl flex flex-col gap-2 justify-center items-center",children:[(0,t.jsx)(iQ.LayoutIcon,{size:18,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"text-fg-secondary text-xs",children:N("templates.no-templates-yet","No templates yet")})]})),c&&(0,t.jsxs)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"flex w-full justify-center items-center gap-3 py-2",children:[(0,t.jsx)("p",{className:"text-fg-tertiary text-sm",children:N("templates.loading-more","Loading more")}),(0,t.jsx)(t5.Spinner,{size:"xs"})]},"loading-more"),(0,t.jsx)("div",{ref:a,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]})]})]})};var iZ=e.i(154580),iJ=e.i(179136);let i0=e=>{let{name:s,label:a,placeholder:n,maxRows:i,isFocused:r,readonly:o,value:c,onChange:d,onFocus:u,onBlur:m,inputClassName:h,textClassName:p,isLoading:f}=e,x=(0,l.useCallback)(e=>{d(e.target.value)},[d]);return f?(0,t.jsx)(eb.Skeleton,{className:"w-full",children:(0,t.jsx)("span",{className:(0,ee.cn)(p,"text-transparent"),children:"''"})}):r?(0,t.jsx)(eK.default,{id:s,autoFocus:!0,"aria-label":a,value:c,placeholder:n,onChange:x,minRows:1,maxRows:i,onBlur:m,className:(0,ee.cn)("bg-transparent resize-none focus-within:outline-none placeholder:text-fg-tertiary",h,{"cursor-default":o})}):(0,t.jsx)("div",{tabIndex:o?-1:0,onClick:u,onFocus:u,className:(0,ee.cn)("cursor-default focus-within:outline-none",p,{"text-fg-tertiary":!c}),children:c||n})};var i1=e.i(771348),i1=i1,i2=e.i(427935),i5=e.i(662245),i4=e.i(887510),i3=e.i(101042),i8=e.i(183580),i6=e.i(874789);let i9=e=>{let{onFileUpload:s,className:a}=e,{t:n}=(0,R.useTranslation)("files"),i=(0,l.useRef)(null),{data:{enableImageUploads:r}={}}=(0,e3.useFeatureControls)(),o=(0,l.useCallback)((e,t)=>{let a=t.items;if(!a||0===a.length||!a[0]||!("webkitGetAsEntry"in a[0]))return void e.forEach(e=>s(e));let i=e=>{".DS_Store"!==e.name&&s(e)},l=e=>{(0,D.logError)("template-file-drop-zone:file-upload",e),eB.toast.error(n("templates.file-processing-error","Error while processing file"))};for(let e=0;e<a.length;e++){let t=a[e];if(!t)continue;let s=t.webkitGetAsEntry();s&&(0,ar.extractFiles)(s,i,l)}},[n,s]),c=(0,al.useDropZone)({ref:i,onDrop:o,canDrop:e=>!(!r&&e.files.some(e=>null==e?void 0:e.type.startsWith("image/")))||(eB.toast.error(n("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1)});return(0,t.jsx)(ai.DropCard,{ref:i,dragState:c,title:n("templates.file-drop-zone-title","Drop files to upload"),className:a})};var i7=e.i(319073),le=e.i(488675);let lt=e=>{let{templateAssets:s,uploadingFiles:a,isReadonly:n,onFileUpload:i,onRemoveAsset:r}=e,{t:o}=(0,R.useTranslation)("base"),c=(0,eo.useAssetStore)(e=>e.fetchListAssets),{data:{enableFileUploads:d,enableImageUploads:u}={}}=(0,e3.useFeatureControls)(),{data:m}=(0,sc.useQuery)({queryKey:["listAssets",null==s?void 0:s.flatMap(e=>e.assetId)],queryFn:()=>c({assetIds:s.filter(e=>!!e.assetId).map(e=>e.assetId),isLatest:!0}),enabled:s.length>0,select:e=>e.assets||[]}),h=e=>{r(e.assetId)},p=(0,l.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=e=>{let t=e.target;if(!t.files)return;let s=Array.from(t.files),a=u?s:s.filter(e=>!e.type.startsWith("image/"));s.length!==a.length&&eB.toast.error(o("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),a.forEach(e=>i(e))},e.click()},[u,i,o]),f=(0,l.useMemo)(()=>a.length+((null==m?void 0:m.length)||0),[a,m]);return(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 overflow-x-auto",children:[d&&!n&&(0,t.jsx)(X.ButtonWithTooltip,{tooltipContent:o("templates.attach-files","Attach reference files (docs, transcripts, logs, etc.) that Grok can use alongside your instructions to generate better outputs"),tooltipContentProps:{align:"start",sideOffset:8},variant:"secondary",shape:"square",size:"md",className:"flex-shrink-0",onClick:p,children:(0,t.jsx)(i7.AttachmentIcon,{size:18})}),!!f&&(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsx)(X.Button,{variant:"secondary",shape:"rectangle",size:"md",className:"flex-shrink-0",children:o("templates.attached-files","Attached ({{count}})",{count:f})})},"more-button")}),(0,t.jsxs)(tx.DropdownMenuContent,{side:"top",alignOffset:12,children:[a.map((e,s)=>(0,t.jsx)(tx.DropdownMenuItem,{className:"cursor-default",children:(0,t.jsx)(le.FileChip,{file:e,metadata:void 0,variant:"list-item",labelClassName:"w-32"})},e.name+s)),null==m?void 0:m.map(e=>(0,t.jsx)(tx.DropdownMenuItem,{className:"cursor-default",children:(0,t.jsx)(s2.AssetMetadataChip,{asset:e,hideEdit:!0,variant:"list-item",labelClassName:"w-32",onRemoveAsset:h})},e.assetId))]})]})]})};var ls=e.i(926836);let la=e=>{let{values:s,isReadonly:a,isLoading:n,isErrorTemplate:i,lastEdited:r,isSaving:o,onChange:c,onDelete:d,onClose:u,onStartConversation:m,onShare:h,onDuplicate:p,onLoadRetry:f}=e,{t:x}=(0,R.useTranslation)("base"),{commandPrefix:g}=(0,ls.useOs)(),[v,j]=(0,l.useState)(a?null:"templateName"),[y,b]=(0,l.useState)([]),w=(0,l.useRef)(null),k=(0,l.useRef)(null),{data:{enableFileUploads:N}={}}=(0,e3.useFeatureControls)(),C=(0,l.useMemo)(()=>{if(!r)return null;let e=(0,i4.getTimeRangeFromTimestamp)(r),t=new Date(r);if("this-year"===e)return t.toLocaleDateString(i3.default.language,{day:"numeric",month:"short"});{if("older"===e)return t.toLocaleDateString(i3.default.language,{day:"numeric",month:"short",year:"numeric"});let s=(0,i8.intlFormatDistance)(r,new Date,{unit:"day",locale:"en"}),a="day";return"today"===s&&(a=void 0),"yesterday"===s&&(a="hour"),(0,i6.capitalizeFirstChar)((0,i8.intlFormatDistance)(r,new Date,{unit:a,locale:i3.default.language}))}},[r]),S=(0,l.useCallback)((e,t)=>{n||a||c({...s,[e]:t})},[c,s,a,n]),I=(0,l.useCallback)(e=>{var t,s;a||n||(j(e),"inputGuidance"===e?null==(t=w.current)||t.focus():"systemPrompt"===e&&(null==(s=k.current)||s.focus()))},[a,n]),T=(0,l.useCallback)(()=>{j(null)},[]),M=(0,l.useCallback)(async e=>{let s=await e.arrayBuffer(),a={name:e.name,mimeType:e.type,content:iJ.Buffer.from(s).toString("base64")};b(t=>[...t,e]);try{var n;let e=eo.useAssetStore.getState(),t=await e.fetchCreateAsset(a),s=null!=(n=t.rootAssetId)?n:t.assetId;if(s)c(e=>({...e,assets:[...e.assets,{assetId:s}]}));else throw Error("Invalid asset")}catch(e){eB.toast.error((0,t.jsx)(as.Trans,{ns:"files",i18nKey:"templates.file-upload-error",defaults:"Error while uploading file"}))}finally{b(t=>t.filter(t=>t!==e))}},[c]),P=(0,l.useCallback)(e=>{n||a||c(t=>({...t,assets:t.assets.filter(t=>t.assetId!==e)}))},[c,a,n]);return(0,a5.useHotkeys)(a2.KBD_SUBMIT,m,[m]),(0,t.jsxs)("div",{className:"@container/template-form flex flex-col h-full w-full relative",children:[N&&!a&&!i&&!n&&(0,t.jsx)(i9,{onFileUpload:M}),(0,t.jsxs)("div",{className:"w-full flex-shrink-0 flex items-center justify-between pb-6 h-16",children:[(0,t.jsx)("div",{children:a?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-fg-tertiary",children:[(0,t.jsx)(i5.Lock,{size:14}),x("templates.readonly","Read only")]}):(0,t.jsx)(t1.AnimatePresence,{mode:"wait",initial:!1,children:C&&(0,t.jsxs)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"text-sm text-fg-tertiary flex items-center gap-2",children:[x("templates.last-edited","Edited {{time}}",{time:C}),(0,t.jsx)(t1.AnimatePresence,{mode:"wait",initial:!1,children:o&&(0,t.jsx)(t2.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{delay:.2}},transition:{duration:.2},children:(0,t.jsx)(t5.Spinner,{size:"xs"})},o?"spinner":"")})]},C)})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!a&&!i&&(0,t.jsxs)(X.Button,{size:"sm",variant:"secondary",shape:"rectangle",disabled:n,onClick:h,children:[(0,t.jsx)(nV.ShareIcon,{size:18,className:"-ml-0.5"}),(0,t.jsx)("span",{children:x("templates.share","Share")})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[!i&&(0,t.jsxs)(tx.DropdownMenu,{children:[(0,t.jsx)(tx.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(X.Button,{variant:"textsecondary",shape:"circle",size:"md",disabled:n,children:[(0,t.jsx)(i1.default,{size:18}),(0,t.jsx)("span",{className:"sr-only",children:x("templates.more","More Options")})]})}),!n&&(0,t.jsxs)(tx.DropdownMenuContent,{children:[(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:p,className:"flex items-center gap-2",children:[(0,t.jsx)(nc.Files,{size:18,className:"-ml-1"}),(0,t.jsx)("span",{children:x("templates.duplicate","Duplicate")})]}),!a&&(0,t.jsxs)(tx.DropdownMenuItem,{onSelect:d,className:"flex items-center gap-2",children:[(0,t.jsx)(iY.Trash,{size:18,className:"text-fg-danger -ml-1"}),(0,t.jsx)("span",{children:x("templates.delete","Remove")})]})]})]}),u&&(0,t.jsxs)(X.Button,{variant:"textsecondary",shape:"circle",size:"md",onClick:u,children:[(0,t.jsx)(av.XIcon,{size:18}),(0,t.jsx)("span",{className:"sr-only",children:x("templates.close","Close")})]})]})]})]}),i?(0,t.jsx)("div",{className:"flex flex-col justify-center items-center mx-auto flex-1 max-w-3xl w-full min-h-0 overflow-hidden",children:(0,t.jsxs)("div",{className:"py-12 px-3 flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)("div",{className:"size-10 bg-surface-l1 rounded-full flex justify-center items-center",children:(0,t.jsx)(iL.TriangleAlert,{className:"size-5 text-fg-tertiary"})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-fg-primary text-sm font-semibold",children:x("templates.load-error.title","Failed to load template")}),(0,t.jsx)("span",{className:"text-fg-secondary text-center text-sm",children:x("templates.load-error.description","This template doesnt exist or you dont have access to it.")})]}),(0,t.jsx)(X.Button,{size:"sm",shape:"rectangle",variant:"secondary",onClick:f,children:x("templates.load-error.retry","Retry")})]})}):(0,t.jsxs)("form",{className:"flex flex-col gap-6 mx-auto flex-1 max-w-3xl w-full min-h-0 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 flex-shrink-0 w-full",children:[(0,t.jsx)(i0,{name:"templateName",label:x("templates.values.name.label","Name"),placeholder:x("templates.values.name.placeholder","New Template"),maxRows:2,isFocused:"templateName"===v,readonly:a||n,value:s.templateName,onChange:e=>S("templateName",e),onFocus:()=>I("templateName"),onBlur:T,inputClassName:"text-xl font-semibold",textClassName:"text-xl font-semibold line-clamp-2",isLoading:n}),(0,t.jsx)(i0,{name:"templateDescription",label:x("templates.values.description.label","Description"),placeholder:x("templates.values.description.placeholder","Description"),maxRows:2,isFocused:"templateDescription"===v,readonly:a||n,value:s.templateDescription,onChange:e=>S("templateDescription",e),onFocus:()=>I("templateDescription"),onBlur:T,inputClassName:"text-fg-secondary",textClassName:"text-fg-secondary line-clamp-2",isLoading:n})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-6 flex-1 min-h-0",children:[(0,t.jsxs)("div",{className:(0,ee.cn)("bg-surface-l1 border border-border-l2 rounded-2xl p-4 flex flex-col gap-2 flex-shrink-0 max-h-[20dvh]",{"animate-pulse":n}),onClick:()=>I("inputGuidance"),children:[(0,t.jsxs)(ih.Tooltip,{children:[(0,t.jsx)(ih.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("label",{htmlFor:"inputGuidance",className:"text-sm text-fg-secondary font-semibold flex-shrink-0 cursor-help w-fit",children:x("templates.values.input-guidance.label","User Instructions")})}),(0,t.jsx)(ih.TooltipContent,{align:"start",sideOffset:24,alignOffset:-16,children:x("templates.values.input-guidance.tooltip","This is the message shown to the template user when starting a conversation. Use it to explain what they need to enter, paste, or upload when sending a message to Grok")})]}),(0,t.jsx)(eK.default,{ref:w,name:"inputGuidance",placeholder:n?void 0:x("templates.values.input-guidance.placeholder","Describe what the user should provide"),readOnly:a||n,value:s.inputGuidance,maxRows:10,onChange:e=>S("inputGuidance",e.target.value),onFocus:()=>I("inputGuidance"),onBlur:T,className:"bg-transparent resize-none focus-within:outline-none placeholder:text-fg-tertiary"})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 flex-shrink-0 overflow-hidden",children:(0,t.jsxs)("div",{className:(0,ee.cn)("border border-border-l2 rounded-2xl p-4 flex flex-col gap-2 max-h-full",{"animate-pulse":n}),onClick:()=>I("systemPrompt"),children:[(0,t.jsxs)(ih.Tooltip,{children:[(0,t.jsx)(ih.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("label",{htmlFor:"systemPrompt",className:"text-sm text-fg-secondary font-semibold flex-shrink-0 cursor-help w-fit",children:x("templates.values.system-prompt.label","Grok Instructions")})}),(0,t.jsx)(ih.TooltipContent,{align:"start",sideOffset:24,alignOffset:-16,children:x("templates.values.system-prompt.tooltip","This is the instruction that guides Grok's behaviour. Use this to define Grok's responses, such as role, tone, and output format")})]}),(0,t.jsx)(eK.default,{ref:k,name:"systemPrompt",placeholder:n?void 0:x("templates.values.system-prompt.placeholder","Describe how Grok should respond"),readOnly:a||n,value:s.systemPrompt,onChange:e=>S("systemPrompt",e.target.value),onFocus:()=>I("systemPrompt"),onBlur:T,className:"bg-transparent resize-none focus-within:outline-none placeholder:text-fg-tertiary"})]})})]})]}),(0,t.jsxs)("div",{className:"w-full flex-shrink-0 flex justify-between items-center pt-6 h-16",children:[!i&&(0,t.jsx)(lt,{templateAssets:s.assets,uploadingFiles:y,onFileUpload:M,onRemoveAsset:P,isReadonly:a||n}),!i&&(0,t.jsxs)(X.ButtonWithTooltip,{variant:"primary",shape:"rectangle",size:"md",tooltipContentProps:{align:"start",sideOffset:8},tooltipContent:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:x("templates.start-conversation-tooltip","Start Conversation")}),g&&(0,t.jsx)("span",{className:"text-secondary",children:"".concat(g,"")})]}),onClick:m,disabled:n,children:[(0,t.jsx)(i2.SquarePenIcon,{size:18,className:"-ml-0.5"}),(0,t.jsx)("span",{className:"hidden @[500px]/template-form:block",children:x("templates.start-conversation","Start")})]})]})]})};var ln=e.i(407725),li=e.i(792869),ll=e.i(815628),lr=e.i(227881),lo=e.i(799477),lc=e.i(486647),ld=e.i(7390),lu=e.i(512122);let lm=e=>{let{isCreatingTemplate:s,onUsePreset:a,onNewTemplate:n}=e,{t:i}=(0,R.useTranslation)("base"),{presets:r}=(0,lu.useConversationTemplatePresets)(),o=(0,l.useCallback)(e=>{s||a(e)},[s,a]);return(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center @container/templates-empty-state",children:(0,t.jsxs)("div",{className:"flex flex-col justify-center items-center gap-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:i("templates.try-preset-templates","Try these templates")}),(0,t.jsx)("div",{className:"grid grid-cols-1 @sm/templates-empty-state:grid-cols-2 gap-4",children:r.slice(0,4).map(e=>(0,t.jsxs)("div",{onClick:()=>o(e),className:"p-3 flex flex-col gap-1 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative cursor-pointer hover:bg-surface-l2 w-[260px] h-[93px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{children:(0,t.jsx)(e.icon,{size:16,className:"text-fg-secondary"})}),(0,t.jsx)("span",{className:"text-fg-primary font-semibold text-sm truncate",children:e.name})]}),(0,t.jsx)("div",{className:"text-fg-secondary text-sm line-clamp-2",children:e.description})]},e.name))}),(0,t.jsxs)(X.Button,{size:"sm",variant:"secondary",shape:"rectangle",className:"w-fit",disabled:s,onClick:n,children:[(0,t.jsx)(ng.PopInOut,{children:s?(0,t.jsx)(t5.Spinner,{size:"xs",className:"-ml-0.5"}):(0,t.jsx)(ld.PlusIcon,{size:18,className:"-ml-0.5"})},s?"spinner":"plus"),(0,t.jsx)("span",{children:i("templates.add-new","Add")})]})]})})};var lh=e.i(794804);function lp(){let{teams:e}=(0,iC.useEnterprise)(),s=(0,n8.useIsActiveGrokBusinessSession)(),{route:a,replace:n}=(0,er.useRouting)(),i=(0,eh.useMobileSize)(),r=(0,iZ.useQueryClient)(),{t:o}=(0,R.useTranslation)("base"),{user:c}=(0,ev.useSession)(),{push:d}=(0,er.useRouting)(),u=(0,si.useLogEvent)(),[m,h]=(0,l.useState)({templateName:"",templateDescription:"",inputGuidance:"",systemPrompt:"",sharedWithTeam:!1,assets:[]}),[p,f]=(0,l.useState)(!1),[x,g]=(0,l.useState)(""),v=(0,l.useMemo)(()=>{var e;return null!=(e=null==x?void 0:x.trim())?e:""},[x]),[j,y]=(0,l.useState)("createTime"),b=(0,l.useMemo)(()=>"templates"===a.page&&a.templateId||null,[a]),w=(0,l.useMemo)(()=>"templates"===a.page&&a.tab?a.tab:"personal",[a]),{data:k,isLoading:N,isError:C,refetch:S}=(0,li.useGetConversationTemplate)({templateId:b});(0,l.useEffect)(()=>{!k||N||p||C||(f(!0),h({templateName:k.templateName||"",templateDescription:k.templateDescription||"",inputGuidance:k.inputGuidance||"",systemPrompt:k.systemPrompt||"",sharedWithTeam:!!k.sharedWithTeam,assets:k.assets||[]}))},[k,N,p,C]),(0,l.useEffect)(()=>{b||(f(!1),h({templateName:"",templateDescription:"",inputGuidance:"",systemPrompt:"",sharedWithTeam:!1,assets:[]}))},[b]);let{results:I,containerRef:T,loadMoreRef:M,isFetchingNextPage:P,isLoading:E,isDebouncing:z,isFetching:D,isError:A}=(0,ln.useListConversationTemplates)({orderBy:j,sharedWithMe:"shared-with-me"===w,query:v}),{mutate:L,isPending:F}=(0,sG.useMutation)({mutationFn:e=>sr.grokForTeamsApi.grokForTeamsTemplatesCreateTemplate({body:e})}),_=(0,l.useMemo)(()=>{let e=k||I.find(e=>e.templateId===b);return!!(e&&(null==e?void 0:e.userId)!==(null==c?void 0:c.userId))},[k,I,b,c]),{isSaving:B}=function(e){let{templateId:t,formValues:s,delay:a=500,enabled:n}=e,i=(0,iZ.useQueryClient)(),{t:r}=(0,R.useTranslation)("base"),o=(0,l.useRef)(new Map),{mutate:c}=(0,sG.useMutation)({mutationFn:e=>sr.grokForTeamsApi.grokForTeamsTemplatesUpdateTemplate({templateId:e.templateId,body:{template:{templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,sharedWithTeam:e.sharedWithTeam,assets:e.assets}}})}),d=(0,l.useCallback)(e=>o.current.get(e),[]),u=(0,l.useCallback)((e,t)=>{o.current.has(e)||o.current.set(e,{currentValues:{...t},lastSavedValues:{...t},timeoutRef:null,isSaving:!1,isInitialized:!1})},[]),m=(0,l.useCallback)(e=>{let t=d(e);return!!t&&Object.keys(t.currentValues).some(e=>t.currentValues[e]!==t.lastSavedValues[e])},[d]),h=(0,l.useCallback)(async e=>{let t=d(e);if(t&&!t.isSaving&&m(e)){t.isSaving=!0;try{await new Promise((s,a)=>{c({templateId:e,...t.currentValues},{onSuccess:()=>{i.invalidateQueries({queryKey:(0,ln.getConversationTemplatesQueryKey)({})}),i.invalidateQueries({queryKey:(0,li.getConversationTemplateQueryKey)(e)}),s()},onError:e=>{a(e)}})}),t.lastSavedValues={...t.currentValues},t.isSaving=!1}catch(e){throw t.isSaving=!1,eB.toast.error(r("templates.failed-to-update-template","Failed to update template")),t.currentValues={...t.lastSavedValues},e}}},[d,m,c,i,r]),p=(0,l.useCallback)(e=>{if(!n)return;let t=d(e);t&&(t.timeoutRef&&(clearTimeout(t.timeoutRef),t.timeoutRef=null),m(e)&&(t.timeoutRef=setTimeout(()=>{h(e),t.timeoutRef=null},a)))},[n,d,m,h,a]);(0,l.useEffect)(()=>{if(!t||!n)return;u(t,s);let e=d(t);e&&(e.isInitialized?(e.currentValues={...s},p(t)):(e.currentValues={...s},e.lastSavedValues={...s},e.isInitialized=!0))},[s,t,n,u,d,p]),(0,l.useEffect)(()=>{if(t)return u(t,s),()=>{let e=d(t);e&&(e.timeoutRef&&(clearTimeout(e.timeoutRef),e.timeoutRef=null),m(t)&&!e.isSaving&&n&&h(t).catch(e=>{console.error("Failed to save template ".concat(t," on switch:"),e)}))}},[t]),(0,l.useEffect)(()=>()=>{o.current.forEach((e,t)=>{e.timeoutRef&&(clearTimeout(e.timeoutRef),e.timeoutRef=null),m(t)&&!e.isSaving&&n&&h(t).catch(e=>{console.error("Failed to save template ".concat(t," on unmount:"),e)})}),o.current.clear()},[]);let f=t?d(t):void 0;return{hasUnsavedChanges:!!t&&m(t),isSaving:(null==f?void 0:f.isSaving)||!1}}({templateId:b,formValues:m,enabled:p&&!_}),G=(0,l.useMemo)(()=>{let e=k||I.find(e=>e.templateId===b);return null==e?void 0:e.modifyTime},[k,I,b]),W=(0,l.useCallback)(e=>{n({page:"templates",tab:e,templateId:b})},[n,b]),U=(0,l.useCallback)(e=>{let{templateName:t,templateDescription:s,inputGuidance:a,systemPrompt:i,assets:l}=e;return L({templateName:t||"",templateDescription:s||"",inputGuidance:a||"",systemPrompt:i||"",assets:l||[],sharedWithTeam:!1},{onSuccess:e=>{let{template:t}=e;if(t&&t.templateId)return n({page:"templates",tab:w,templateId:t.templateId}),f(!0),h({templateName:t.templateName||"",templateDescription:t.templateDescription||"",inputGuidance:t.inputGuidance||"",systemPrompt:t.systemPrompt||"",sharedWithTeam:!!t.sharedWithTeam,assets:t.assets||[]}),r.invalidateQueries({queryKey:(0,ln.getConversationTemplatesQueryKey)({})})},onError:()=>{eB.toast.error(o("templates.failed-to-create-template","Failed to create template"))}})},[n,w,L,r,o]),O=(0,l.useCallback)(e=>U({templateName:e.templateName?e.templateName+" "+o("template.copy-suffix","(Copy)"):"",templateDescription:e.templateDescription||"",inputGuidance:e.inputGuidance||"",systemPrompt:e.systemPrompt||"",assets:e.assets||[],sharedWithTeam:!1}),[U,o]),q=(0,l.useCallback)(async e=>sr.grokForTeamsApi.grokForTeamsTemplatesDeleteTemplate({templateId:e}).then(()=>(e===b&&n({page:"templates",tab:w,templateId:null}),r.invalidateQueries({queryKey:(0,ln.getConversationTemplatesQueryKey)({})}))).catch(()=>{eB.toast.error(o("templates.failed-to-delete-template","Failed to delete template"))}),[n,w,r,o,b]),V=(0,l.useCallback)(e=>{e.templateId&&(n({page:"templates",tab:w,templateId:e.templateId}),f(!0),h({templateName:e.templateName||"",templateDescription:e.templateDescription||"",inputGuidance:e.inputGuidance||"",systemPrompt:e.systemPrompt||"",sharedWithTeam:!!e.sharedWithTeam,assets:e.assets||[]}))},[n,w]),H=(0,l.useCallback)(()=>{n({page:"templates",tab:w,templateId:null})},[n,w]),K=(0,l.useCallback)(()=>{b&&function(e){let{templateId:t,title:s,disclaimer:a}=e,n=["share-template",t];lr.useShareStore.getState().openShareDialog({title:s,disclaimer:a,allowUserSpecificSharing:!1,onSave:async e=>sr.grokForTeamsApi.grokForTeamsTemplatesUpdateTemplate({templateId:t,body:{template:{...e.template,sharedWithTeam:e.sharedWithTeam}}}).then(()=>{let e=(0,sR.getQueryClient)();e.invalidateQueries({queryKey:n}),e.invalidateQueries({queryKey:(0,li.getConversationTemplateQueryKey)(t)})}).catch(e=>{throw e}),useFetchData:()=>(0,sc.useQuery)({queryKey:n,queryFn:async()=>{let e=(await sr.grokForTeamsApi.grokForTeamsTemplatesGetTemplate({templateId:t})).template||null;return e?{shareUrl:"".concat(window.location.origin,"/?templateId=").concat(e.templateId),sharedWithTeam:!!e.sharedWithTeam,template:e}:{shareUrl:"",sharedWithTeam:!1,template:{}}}})})}({templateId:b,title:o("templates.share-template","Share Template"),disclaimer:o("templates.share-template-disclaimer","When sharing a template, any attached files will also be shared and can't be deleted unless you unlink or delete the template")})},[b,o]),{startConversationWithTemplate:Q}=(0,ll.useConversationTemplate)({templateId:b}),Y=(0,l.useCallback)(()=>{if(b&&p)return Q()},[b,p,Q]);return(0,a5.useHotkeys)(a2.KBD_NEW_CHAT,e=>{e.preventDefault(),e.stopPropagation(),u("pressed_cmd_j",void 0,{location:"templates-page:useHotkeys"}),b?Y():d({page:"main",templateId:null})},[u,b,Y,d]),(0,t.jsxs)("main",{className:(0,ee.cn)("h-dvh w-full relative flex flex-col items-center @container"),children:[i&&(0,t.jsx)(e5.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(e4.CommandMenu,{}),s?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(na.PanelGroup,{direction:"horizontal",autoSaveId:"files-page-layout",style:{height:"100vh"},className:"w-full h-[100vh] overflow-hidden",tagName:"main",children:[(0,t.jsx)(na.Panel,{minSize:25,defaultSize:30,order:0,children:(0,t.jsx)(i$,{containerRef:T,loadMoreRef:M,tab:w,isCreatingTemplate:F,templates:I,selectedTemplateId:b||void 0,searchQuery:x,orderBy:j,isFetchingNextPage:P,isLoading:E,isDebouncing:z,isError:A,isFetching:D,onSearchQueryChange:g,onTabChange:W,onOrderByChange:y,onAddNew:()=>U({}),onTemplateSelect:V,onTemplateDelete:q,onTemplateDuplicate:e=>O({templateName:e.templateName,templateDescription:e.templateDescription,systemPrompt:e.systemPrompt,inputGuidance:e.inputGuidance,assets:e.assets})})}),i?(0,t.jsx)(lc.ResponsiveDialog,{open:!!b,setOpen:e=>{e||H()},children:(0,t.jsx)("div",{className:"h-[90dvh] w-dvw p-4",children:(0,t.jsx)(la,{values:m,isLoading:!p,isSaving:B,isReadonly:_,isErrorTemplate:C,lastEdited:G,onChange:h,onDelete:()=>b&&q(b),onStartConversation:Y,onShare:K,onDuplicate:()=>O(m),onLoadRetry:S},b)})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(lo.ResizeHandle,{}),(0,t.jsx)(na.Panel,{order:1,minSize:50,defaultSize:100,className:"p-4",children:b?(0,t.jsx)(la,{values:m,isLoading:!p,isSaving:B,isReadonly:_,isErrorTemplate:C,lastEdited:G,onChange:h,onDelete:()=>q(b),onClose:H,onStartConversation:Y,onShare:K,onDuplicate:()=>O(m),onLoadRetry:S},b):(0,t.jsx)(lm,{isCreatingTemplate:F,onNewTemplate:()=>U({}),onUsePreset:e=>U({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt})})})]})]})}):e[0]?(0,t.jsx)(lh.TeamSwitchPrompt,{teamId:e[0].teamId,attemptAutoSwitch:!1,description:o("templates.switch-to-team-to-access","Templates are only available in team workspaces. Switch to a team to access templates.")}):(0,t.jsx)(sa.default,{})]})}function lf(){(function(){let{route:e,push:t}=(0,er.useRouting)(),{user:s}=(0,ev.useSession)();(0,l.useEffect)(()=>a.useChatPageStore.subscribe((a,n)=>{if(!a.conversationId||a.conversationId===n.conversationId||"chat"===e.page&&e.conversationId!==a.conversationId||"main"!==e.page)return;let i=ef.useSettingsStore.getState().isIncognito||!s;t({page:"chat",conversationId:i?null:a.conversationId,temporary:i})}),[t,e,s])})(),function(){let{route:e}=(0,er.useRouting)();(0,l.useEffect)(()=>{let{conversationMode:t,voiceConnectionStatus:s,exitVoiceMode:n}=a.useChatPageStore.getState();"voice"!==t||"disconnecting"===s||["main","chat"].includes(e.page)||n("navigation").catch(e=>(0,D.logError)("page:handleVoiceModeExit",e))},[e.page])}(),(0,sK.useRoutingSlugComponent)();let{ENABLE_TEMPLATES:e}=(0,ep.useFeatureFlags)(),{route:i}=(0,er.useRouting)(),{teams:r}=(0,iC.useEnterprise)(),o=(0,n8.useIsActiveGrokBusinessSession)();switch((0,l.useEffect)(()=>{let e=(0,er.getCanonicalUrl)(i,window.location.origin),t=document.querySelector("head link[rel='canonical']");return t||((t=document.createElement("link")).rel="canonical",document.head.appendChild(t)),t.href=e,()=>{let e=document.querySelector("head link[rel='canonical']");e&&document.head.removeChild(e)}},[i]),i.page){case"main":case"chat":return(0,t.jsx)(s.default,{});case"history":return(0,t.jsx)(iH,{});case"workspace":return(0,t.jsx)(iM.WorkspacePageContent,{workspaceId:i.workspaceId});case"workspaces":return(0,t.jsx)(iP.WorkspacesPageContent,{});case"files":return(0,t.jsx)(ij,{});case"tasks":return(0,t.jsx)(sC,{});case"images":case"finance":case"unknown":default:return(0,t.jsx)(sa.default,{});case"plans":return(0,t.jsx)(iw,{});case"faq":return(0,t.jsx)(sY,{});case"changelog":return(0,t.jsx)(s0,{});case"share-links":return(0,t.jsx)(iT,{});case"deleted-conversations":return(0,t.jsx)(sO,{});case"imagine":return(0,t.jsx)(e6,{});case"imagine-favorites":return(0,t.jsx)(e6,{variant:"favorites"});case"imagine-post":return(0,t.jsx)(tW,{});case"imagine-carpet":return(0,t.jsx)(t4,{});case"clear-cache":return(0,t.jsx)(n.ClearCachePage,{});case"templates":if((o||r.length)&&e)return(0,t.jsx)(lp,{});return(0,t.jsx)(sa.default,{});case"code":return null}}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f44900e9-f214-5439-afad-d1705dc7d642")}catch(e){}}();
//# debugId=f44900e9-f214-5439-afad-d1705dc7d642
